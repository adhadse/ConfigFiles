(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[1597],{11597:(e,t,n)=>{"use strict";n.r(t);n.d(t,{FeatureManager:()=>js,ILSPAdapterManager:()=>a,ILSPCodeExtractorsManager:()=>c,ILSPCodeOverridesManager:()=>f,ILSPFeatureManager:()=>o,ILSPLogConsole:()=>d,ILSPVirtualEditorManager:()=>l,ILanguageServerManager:()=>r,LSPExtension:()=>Ss,PLUGIN_ID:()=>s,RegExpForeignCodeExtractor:()=>m,default:()=>Ls});var i=n(91100);var r;(function(e){e.URL_NS="lsp"})(r||(r={}));const s="@krassowski/jupyterlab-lsp";const o=new i.Token(s+":ILSPFeatureManager");const a=new i.Token(s+":ILSPAdapterManager");const l=new i.Token(s+":ILSPVirtualEditorManager");const c=new i.Token(s+":ILSPCodeExtractorsManager");const d=new i.Token(s+":ILSPLogConsole");function u(e,t){return t&&e.line===t.line&&e.ch===t.ch}function h(e,t){let n=0;let i=0;for(let r of t){if(r.length+1<=e){e-=r.length+1;n+=1}else{i=e;break}}return{line:n,column:i}}function g(e,t,n=false){let i=n?0:1;let r=0;for(let s=0;s<t.length;s++){let n=t[s];if(e.line>s){r+=n.length+i}else{r+=e.column;break}}return r}class p extends Error{}function _(e,t,n){let i=e.exec(t);if(i==null){console.warn(`No capture group found for ${e} in ${t}`);return-1}let r=0;let s=i[0];for(let o of i.slice(1)){if(typeof o==="undefined"){continue}if(o===n){r+=s.indexOf(o);break}let e=s.indexOf(o)+o.length;s=s.slice(e);r+=e}return r}class m{constructor(e){this.language=e.language;this.options=e;this.global_expression=new RegExp(e.pattern,"g");this.test_expression=new RegExp(e.pattern,"g");this.expression=new RegExp(e.pattern);this.standalone=this.options.is_standalone;this.file_extension=this.options.file_extension}has_foreign_code(e){let t=this.test_expression.test(e);this.test_expression.lastIndex=0;return t}extract_foreign_code(e){let t=e.split("\n");let n=new Array;let i=this.global_expression.lastIndex;let r=this.global_expression.exec(e);let s;let o;let a=false;if(typeof this.options.foreign_replacer!=="undefined"){o=this.options.foreign_replacer;a=true}else if(typeof this.options.foreign_capture_groups!=="undefined"){o="$"+this.options.foreign_capture_groups.join("$");a=true}else if(this.options.extract_to_foreign){o=this.options.extract_to_foreign}else{console.warn(`Foreign replacer not defined for extractor: {this.expression} - this is deprecated; use 'foreign_replacer' to define it`);return[]}while(r!=null){let l=r[0];let c=null;let d=l.replace(this.expression,o);let u="";if(typeof this.options.extract_arguments!=="undefined"){u=l.replace(this.expression,this.options.extract_arguments);c=h(u.length,u.split("\n"))}let g=this.global_expression.lastIndex;if(this.options.keep_in_host||this.options.keep_in_host==null){s=e.substring(i,g)}else{if(i===r.index){s=""}else{s=e.substring(i,r.index)+"\n"}}let p=d;if(a){p=l.replace(this.expression,"$"+Math.min(...this.options.foreign_capture_groups))}const m=_(this.expression,l,p);let f=r.index+m;let v=h(f,t);let A=h(f+d.length,t);n.push({host_code:s,foreign_code:u+d,range:{start:v,end:A},virtual_shift:c});i=this.global_expression.lastIndex;r=this.global_expression.exec(e)}if(i!==e.length){let t=e.substring(i,e.length);n.push({host_code:t,foreign_code:null,range:null,virtual_shift:null})}return n}}const f=new i.Token(s+":ILSPCodeOverridesManager");var v=n(20597);var A=n(70994);var w=n(36875);var b=n(70960);var y=n(15914);var C=n(29908);var E=n(33254);var x=n(67973);var k=n(80999);var j=n(74932);var S=n(18987);var M=n(93379);var I=n.n(M);var T=n(90763);var L={};L.insert="head";L.singleton=false;var B=I()(T.Z,L);const R=T.Z.locals||{};class D{constructor(e){this.shell=e;this.adapters=new Map;this.adapterChanged=new S.Signal(this);this.adapterDisposed=new S.Signal(this);this.adapterTypeAdded=new S.Signal(this);this.adapterTypes=[];e.currentChanged.connect(this.refreshAdapterFromCurrentWidget,this)}get types(){return this.adapterTypes}registerAdapterType(e){this.adapterTypes.push(e);this.adapterTypeAdded.emit(e)}connect(e,t){t.tracker.widgetAdded.connect(((n,i)=>{this.connectWidget(e,i,t)}));e.registerAdapterType(this,t)}registerExtension(e){for(let t of this.adapterTypes){this.connect(e,t)}this.adapterTypeAdded.connect(((t,n)=>{this.connect(e,n)}))}connectWidget(e,t,n){let i=new n.adapter(e,t);this.registerAdapter({adapter:i,id:n.get_id(t),re_connector:()=>{this.connectWidget(e,t,n)}});this.refreshAdapterFromCurrentWidget()}refreshAdapterFromCurrentWidget(){const e=this.shell.currentWidget;if(!e){return}let t=null;for(let n of this.adapterTypes){if(n.tracker.has(e)){let i=n.get_id(e);t=this.adapters.get(i)}}if(t!=null){this.currentAdapter=t;this.adapterChanged.emit(t)}}registerAdapter(e){let{id:t,adapter:n,re_connector:i}=e;let r=e.adapter.widget;if(this.adapters.has(t)){let e=this.adapters.get(t);console.warn(`Adapter with id ${t} was already registered (${n} vs ${e}) `)}this.adapters.set(t,n);const s=()=>{this.adapters.delete(t);r.disposed.disconnect(s);r.context.pathChanged.disconnect(o);n.dispose()};const o=()=>{s();i()};r.disposed.connect((()=>{s();this.adapterDisposed.emit(n)}));r.context.pathChanged.connect(o);this.refreshAdapterFromCurrentWidget()}isAnyActive(){return this.shell.currentWidget!==null&&this.adapterTypes.some((e=>e.tracker.currentWidget))&&this.adapterTypes.some((e=>e.tracker.currentWidget==this.shell.currentWidget))}}const P={id:s+":ILSPAdapterManager",activate:e=>{let t=e.shell;return new D(t)},provides:a,autoStart:true};var O=n(72193);class z{static lsp_to_cm(e){return{line:e.line,ch:e.character}}static cm_to_lsp(e){return{line:e.line,character:e.ch}}static lsp_to_ce(e){return{line:e.line,column:e.character}}static cm_to_ce(e){return{line:e.line,column:e.ch}}static ce_to_cm(e){return{line:e.line,ch:e.column}}}var $=n(49818);var F=n(76013);class U{constructor(e){this.on_new_connection=e=>{e.on("error",(t=>{this.console.warn(t);let n=t.length&&t.length>=1?t[0]:new Error;if(n.message.indexOf("code = 1005")!==-1){this.console.warn(`Connection failed for ${e}`);this.forEachDocumentOfConnection(e,(t=>{this.console.warn("disconnecting "+t.uri);this.closed.emit({connection:e,virtual_document:t});this.ignored_languages.add(t.language);this.console.warn(`Cancelling further attempts to connect ${t.uri} and other documents for this language (no support from the server)`)}))}else if(n.message.indexOf("code = 1006")!==-1){this.console.warn("Connection closed by the server")}else{this.console.error("Connection error:",t)}}));e.on("serverInitialized",(t=>{this.forEachDocumentOfConnection(e,(t=>{this.initialized.emit({connection:e,virtual_document:t})}));this.updateServerConfigurations(this.initial_configurations)}));e.on("close",(t=>{if(!t){this.console.warn("Connection unexpectedly disconnected")}else{this.console.warn("Connection closed");this.forEachDocumentOfConnection(e,(t=>{this.closed.emit({connection:e,virtual_document:t})}))}}))};this.connections=new Map;this.documents=new Map;this.ignored_languages=new Set;this.connected=new S.Signal(this);this.initialized=new S.Signal(this);this.disconnected=new S.Signal(this);this.closed=new S.Signal(this);this.documents_changed=new S.Signal(this);this.language_server_manager=e.language_server_manager;this.console=e.console;N.setLanguageServerManager(e.language_server_manager)}connect_document_signals(e){e.foreign_document_opened.connect(this.on_foreign_document_opened,this);e.foreign_document_closed.connect(this.on_foreign_document_closed,this);this.documents.set(e.uri,e);this.documents_changed.emit(this.documents)}disconnect_document_signals(e,t=true){e.foreign_document_opened.disconnect(this.on_foreign_document_opened,this);e.foreign_document_closed.disconnect(this.on_foreign_document_closed,this);this.documents.delete(e.uri);for(const n of e.foreign_documents.values()){this.disconnect_document_signals(n,false)}if(t){this.documents_changed.emit(this.documents)}}on_foreign_document_opened(e,t){this.console.log("ConnectionManager received foreign document: ",t.foreign_document.uri)}on_foreign_document_closed(e,t){const{foreign_document:n}=t;this.disconnect_document_signals(n)}async connect_socket(e){this.console.log("Connection Socket",e);let{virtual_document:t,language:n,capabilities:i}=e;this.connect_document_signals(t);const r=U.solve_uris(t,n);const s=this.language_server_manager.getMatchingServers({language:n});this.console.debug("Matching servers: ",s);const o=s.length===0?null:s[0];const a=await N.connection(n,o,r,this.on_new_connection,this.console,i);this.connections.set(t.uri,a);return a}updateConfiguration(e){this.language_server_manager.setConfiguration(e)}updateServerConfigurations(e){let t;for(t in e){if(!e.hasOwnProperty(t)){continue}const n=e[t];const i=(0,F.HY)(n.serverSettings||{});const r={settings:i};this.console.log("Server Update: ",t);this.console.log("Sending settings: ",r);N.updateServerConfiguration(t,r)}}forEachDocumentOfConnection(e,t){for(const[n,i]of this.connections.entries()){if(e!==i){continue}t(this.documents.get(n))}}async retry_to_connect(e,t,n=-1){let{virtual_document:i}=e;if(this.ignored_languages.has(i.language)){return}let r=t*1e3;let s=false;while(n!==0&&!s){await this.connect(e).then((()=>{s=true})).catch((e=>{this.console.warn(e)}));this.console.log("will attempt to re-connect in "+r/1e3+" seconds");await(0,F._v)(r);r=r<5*1e3?r+500:r}}async connect(e,t=30,n=5){this.console.log("connection requested",e);let i=await this.connect_socket(e);let{virtual_document:r,document_path:s}=e;if(!i.isReady){try{await(0,F.EU)((()=>i.isReady),Math.round(t*1e3/150),150)}catch(o){this.console.warn(`Connection to ${r.uri} timed out after ${t} seconds, will continue retrying for another ${n} minutes`);try{await(0,F.EU)((()=>i.isReady),60*n,1e3)}catch(a){this.console.warn(`Connection to ${r.uri} timed out again after ${n} minutes, giving up`);return}}}this.console.log(s,r.uri,"connected.");this.connected.emit({connection:i,virtual_document:r});return i}unregister_document(e){this.connections.delete(e.uri);this.documents_changed.emit(this.documents)}updateLogging(e,t){for(const n of this.connections.values()){n.logAllCommunication=e;if(t!==null){n.clientNotifications["$/setTrace"].emit({value:t})}}}}(function(e){function t(e,t){const n=$.PageConfig.getBaseUrl().replace(/^http/,"ws");const i=$.PageConfig.getOption("rootUri");const s=$.PageConfig.getOption("virtualDocumentsUri");const o=e.has_lsp_supported_file?i:s;const a=N.getLanguageServerManager().getMatchingServers({language:t});const l=a.length===0?null:a[0];if(l===null){throw`No language server installed for language ${t}`}let c=$.URLExt.join(o,e.uri);if(!c.startsWith("file:///")&&c.startsWith("file://")){c=c.replace("file://","file:///");if(c.startsWith("file:///users/")&&o.startsWith("file:///Users/")){c=c.replace("file:///users/","file:///Users/")}}return{base:o,document:c,server:$.URLExt.join("ws://jupyter-lsp",t),socket:$.URLExt.join(n,r.URL_NS,"ws",l)}}e.solve_uris=t})(U||(U={}));var N;(function(e){const t=new Map;let i;let r;function s(){return r}e.getLanguageServerManager=s;function o(e){r=e}e.setLanguageServerManager=o;async function a(e,r,s,o,a,l){if(i==null){i=n.e(8016).then(n.bind(n,96604))}const{LSPConnection:c}=await i;let d=t.get(r);if(d==null){const n=new WebSocket(s.socket);const i=new c({languageId:e,serverUri:s.server,rootUri:s.base,serverIdentifier:r,console:a,capabilities:l});i.setMaxListeners(999);t.set(r,i);i.connect(n);o(i)}d=t.get(r);return d}e.connection=a;function l(e,n){const i=t.get(e);if(i){i.sendConfigurationChange(n)}}e.updateServerConfiguration=l})(N||(N={}));class q extends Map{constructor(e){super(e.map((e=>[new RegExp(e.pattern),e.replacement])))}_override_for(e){for(let[t,n]of this){if(e.match(t)){return e.replace(t,n)}}return null}}class W extends q{constructor(e){super(e);this.overrides=e}get reverse(){return this.type(this.overrides.filter((e=>e.reverse!=null)).map((e=>e.reverse)))}type(e){return new W(e)}override_for(e){return super._override_for(e)}replace_all(e,t=this){let n=new Array;let i=new Array;for(let r=0;r<e.length;r++){let s=e[r];let o=t.override_for(s);n.push(o==null?s:o);i.push(o!=null)}return{lines:n,skip_inspect:i}}reverse_replace_all(e){return this.replace_all(e,this.reverse).lines}}var H=n(36020);var V={};V.insert="head";V.singleton=false;var K=I()(H.Z,V);const Z=H.Z.locals||{};function G(e){return e.map((e=>{let t;if(typeof e==="string"){return e}try{t=JSON.stringify({k:e}).slice(5,-1)}catch(n){t=""+e}return'<span class="lsp-code">'+t+"</span>"})).join(" ")}class Y{constructor(e=["LSP"],t=null){if(t){this.element=t}else{this.element=document.createElement("ul");this.element.className="lsp-floating-console";document.body.appendChild(this.element)}}bindThis(){return this}dispose(){this.element.remove()}append(e,t="log"){let n=document.createElement("li");n.innerHTML='<span class="lsp-kind">'+t+"</span>"+e;this.element.appendChild(n);this.element.scrollTop=this.element.scrollHeight}debug(...e){this.append(G(e),"debug")}log(...e){this.append(G(e),"log")}warn(...e){this.append(G(e),"warn")}error(...e){this.append(G(e),"error")}}class J{constructor(){this.debug=window.console.debug.bind(window.console);this.log=window.console.log.bind(window.console);this.warn=window.console.warn.bind(window.console);this.error=window.console.error.bind(window.console)}dispose(){return}scope(e){return this}bindThis(){return window.console}}class X{constructor(e=["LSP"],t){this.breadcrumbs=e;this._scope=this.breadcrumbs.join(".")+":";this.singleton=t;this.singleton.changed.connect(this._rebind_functions.bind(this));this._rebind_functions()}_rebind_functions(){const e=()=>{};const t=this.implementation.bindThis();if(this.verbosity==="debug"){this.debug=this.implementation.debug.bind(t,this._scope)}else{this.debug=e}if(this.verbosity==="debug"||this.verbosity==="log"){this.log=this.implementation.log.bind(t,this._scope)}else{this.log=e}if(this.verbosity==="debug"||this.verbosity==="log"||this.verbosity==="warn"){this.warn=this.implementation.warn.bind(t,this._scope)}else{this.warn=e}this.error=this.implementation.error.bind(t,this._scope)}get verbosity(){return this.singleton.verbosity}get implementation(){return this.singleton.implementation}debug(...e){return this.implementation.debug(this._scope,...e)}log(...e){return this.implementation.log(this._scope,...e)}warn(...e){return this.implementation.warn(this._scope,...e)}error(...e){return this.implementation.error(this._scope,...e)}scope(e){return new X([...this.breadcrumbs,e],this.singleton)}}class Q{constructor(e){this.verbosity="debug";this.implementation=new J;this.changed=new S.Signal(this);e.load(s+":plugin").then((e=>{this.updateSettings(e);e.changed.connect((()=>{this.updateSettings(e)}))})).catch(console.warn)}updateSettings(e){const t=e.composite;const n=t.loggingConsole;if(this.implementation){this.implementation.dispose()}if(n==="browser"){this.implementation=new J}else if(n==="floating"){this.implementation=new Y}else{console.warn("Unknown console type",n,"falling back to browser console");this.implementation=new J}this.verbosity=t.loggingLevel;this.changed.emit()}}const ee={id:s+":ILSPLogConsole",requires:[y.ISettingRegistry],activate:(e,t)=>{const n=new Q(t);return new X(["LSP"],n)},provides:d,autoStart:true};function te(e,t){if(t.start.line===t.end.line){return e.line===t.start.line&&e.column>=t.start.column&&e.column<=t.end.column}return e.line===t.start.line&&e.column>=t.start.column&&e.line<t.end.line||e.line>t.start.line&&e.column<=t.end.column&&e.line===t.end.line||e.line>t.start.line&&e.line<t.end.line}class ne{constructor(e){this.version=0;this._document=e}get text(){return this._document.value}get uri(){const e=U.solve_uris(this._document,this.languageId);return e.document}get languageId(){return this._document.language}}class ie{constructor(e){this.isDisposed=false;this.blank_lines_between_cells=2;this.options=e;this.path=e.path;this.console=e.console;this.file_extension=e.file_extension;this.has_lsp_supported_file=e.has_lsp_supported_file;this.parent=e.parent;this.language=e.language;let t=this.language in e.overrides_registry?e.overrides_registry[this.language]:null;this.cell_magics_overrides=new W(t?t.cell:[]);this.line_magics_overrides=new W(t?t.line:[]);this.foreign_extractors_registry=e.foreign_code_extractors;this.foreign_extractors=this.language in this.foreign_extractors_registry?this.foreign_extractors_registry[this.language]:[];this.virtual_lines=new Map;this.source_lines=new Map;this.foreign_documents=new Map;this.overrides_registry=e.overrides_registry;this.standalone=e.standalone||false;this.instance_id=ie.instances_count;ie.instances_count+=1;this.unused_standalone_documents=new F.Gl((()=>new Array));this._remaining_lifetime=6;this.foreign_document_closed=new S.Signal(this);this.foreign_document_opened=new S.Signal(this);this.changed=new S.Signal(this);this.unused_documents=new Set;this.document_info=new ne(this);this.update_manager=new se(this,e.console);this.clear()}dispose(){if(this.isDisposed){return}this.isDisposed=true;this.parent=null;for(const e of this.foreign_documents.values()){e.dispose()}this.close_all_foreign_documents();this.update_manager.dispose();this.foreign_documents.clear();this.source_lines.clear();this.unused_documents.clear();this.unused_standalone_documents.clear();this.virtual_lines.clear();this.cell_magics_overrides=null;this.document_info=null;this.foreign_extractors=null;this.foreign_extractors_registry=null;this.line_magics_overrides=null;this.line_blocks=null;this.overrides_registry=null}get remaining_lifetime(){if(!this.parent){return Infinity}return this._remaining_lifetime}set remaining_lifetime(e){if(this.parent){this._remaining_lifetime=e}}clear(){this.unused_standalone_documents.clear();for(let e of this.foreign_documents.values()){e.clear();if(e.standalone){let t=this.unused_standalone_documents.get(e.language);t.push(e)}}this.unused_documents=new Set(this.foreign_documents.values());this.virtual_lines.clear();this.source_lines.clear();this.last_virtual_line=0;this.last_source_line=0;this.line_blocks=[]}forward_closed_signal(e,t){this.foreign_document_closed.emit(t)}forward_opened_signal(e,t){this.foreign_document_opened.emit(t)}open_foreign(e,t,n){let i=new ie(Object.assign(Object.assign({},this.options),{parent:this,standalone:t,file_extension:n,language:e}));const r={foreign_document:i,parent_host:this};this.foreign_document_opened.emit(r);i.foreign_document_closed.connect(this.forward_closed_signal,this);i.foreign_document_opened.connect(this.forward_opened_signal,this);this.foreign_documents.set(i.virtual_id,i);return i}document_at_source_position(e){let t=this.source_lines.get(e.line);if(t==null){return this}let n={line:t.editor_line,column:e.ch};for(let[i,{virtual_document:r}]of t.foreign_documents_map){if(te(n,i)){let e={line:n.line-i.start.line,ch:n.column-i.start.column};return r.document_at_source_position(e)}}return this}is_within_foreign(e){let t=this.source_lines.get(e.line);let n={line:t.editor_line,column:e.ch};for(let[i]of t.foreign_documents_map){if(te(n,i)){return true}}return false}virtual_position_at_document(e){let t=this.source_lines.get(e.line);if(t==null){throw new p("Source line not mapped to virtual position")}let n=t.virtual_line;let i={line:t.editor_line,column:e.ch};for(let[r,{virtual_line:s,virtual_document:o}]of t.foreign_documents_map){if(te(i,r)){let e={line:i.line-r.start.line,ch:i.column-r.start.column};if(o.is_within_foreign(e)){return this.virtual_position_at_document(e)}else{e.line+=s;return e}}}return{ch:e.ch,line:n}}choose_foreign_document(e){let t;let n=this.foreign_documents.has(e.language);if(!e.standalone&&n){t=this.foreign_documents.get(e.language);this.unused_documents.delete(t)}else{let n=this.unused_standalone_documents.get(e.language);if(e.standalone&&n.length>0){t=n.pop();this.unused_documents.delete(t)}else{t=this.open_foreign(e.language,e.standalone,e.file_extension)}}return t}extract_foreign_code(e,t){let n=new Map;let i=e.value;for(let r of this.foreign_extractors){if(!r.has_foreign_code(i)){continue}let s=r.extract_foreign_code(i);let o="";for(let i of s){if(i.foreign_code!==null){if(i.range===null){this.console.warn("Failure in foreign code extraction: `range` is null but `foreign_code` is not!");continue}let s=this.choose_foreign_document(r);n.set(i.range,{virtual_line:s.last_virtual_line,virtual_document:s,editor:e.ce_editor});let o={line:t.line+i.range.start.line,column:t.column+i.range.start.column};s.append_code_block({value:i.foreign_code,ce_editor:e.ce_editor},o,i.virtual_shift)}if(i.host_code!=null){o+=i.host_code}}i=o}return{cell_code_kept:i,foreign_document_map:n}}decode_code_block(e){let t=this.cell_magics_overrides.reverse.override_for(e);if(t!=null){return t}else{let t=this.line_magics_overrides.reverse_replace_all(e.split("\n"));return t.join("\n")}}prepare_code_block(e,t={line:0,column:0}){let n;let i;let{cell_code_kept:r,foreign_document_map:s}=this.extract_foreign_code(e,t);let o=r;let a=this.cell_magics_overrides.override_for(o);if(a!=null){n=a.split("\n");i=n.map((e=>[this.id_path]))}else{let e=this.line_magics_overrides.replace_all(o.split("\n"));n=e.lines;i=e.skip_inspect.map((e=>e?[this.id_path]:[]))}return{lines:n,foreign_document_map:s,skip_inspect:i}}get foreign_document_maps(){let e=new Set;for(let t of this.source_lines.values()){e.add(t.foreign_documents_map)}return[...e.values()]}append_code_block(e,t={line:0,column:0},n){let i=e.value;let r=e.ce_editor;if(this.isDisposed){console.warn("Cannot append code block: document disposed");return}let s=i.split("\n");let{lines:o,foreign_document_map:a,skip_inspect:l}=this.prepare_code_block(e,t);for(let c=0;c<o.length;c++){this.virtual_lines.set(this.last_virtual_line+c,{skip_inspect:l[c],editor:r,source_line:this.last_source_line+c})}for(let c=0;c<s.length;c++){this.source_lines.set(this.last_source_line+c,{editor_line:c,editor_shift:{line:t.line-((n===null||n===void 0?void 0:n.line)||0),column:c===0?t.column-((n===null||n===void 0?void 0:n.column)||0):0},editor:r,foreign_documents_map:a,virtual_line:this.last_virtual_line+c})}this.last_virtual_line+=o.length;this.line_blocks.push(o.join("\n")+"\n");for(let c=0;c<this.blank_lines_between_cells;c++){this.virtual_lines.set(this.last_virtual_line+c,{skip_inspect:[this.id_path],editor:r,source_line:null})}this.last_virtual_line+=this.blank_lines_between_cells;this.last_source_line+=s.length}get value(){let e="\n".repeat(this.blank_lines_between_cells);return this.line_blocks.join(e)}get last_line(){const e=this.line_blocks[this.line_blocks.length-1].split("\n");return e[e.length-1]}close_expired_documents(){for(let e of this.unused_documents.values()){e.remaining_lifetime-=1;if(e.remaining_lifetime<=0){this.close_foreign(e)}}}close_foreign(e){console.log("LSP: closing document",e);this.foreign_document_closed.emit({foreign_document:e,parent_host:this});this.foreign_documents.delete(e.virtual_id);e.close_all_foreign_documents();e.foreign_document_closed.disconnect(this.forward_closed_signal,this);e.foreign_document_opened.disconnect(this.forward_opened_signal,this)}close_all_foreign_documents(){for(let e of this.foreign_documents.values()){this.close_foreign(e)}}get virtual_id(){return this.standalone?this.instance_id+"("+this.language+")":this.language}get ancestry(){if(!this.parent){return[this]}return this.parent.ancestry.concat([this])}get id_path(){if(!this.parent){return this.virtual_id}return this.parent.id_path+"-"+this.virtual_id}get uri(){const e=encodeURI(this.path);if(!this.parent){return e}return e+"."+this.id_path+"."+this.file_extension}transform_source_to_editor(e){let t=this.source_lines.get(e.line);let n=t.editor_line;let i=t.editor_shift;return{ch:e.ch+(n===0?i.column:0),line:n+i.line}}transform_virtual_to_editor(e){let t=this.transform_virtual_to_source(e);if(t==null){return null}return this.transform_source_to_editor(t)}transform_virtual_to_source(e){const t=this.virtual_lines.get(e.line).source_line;if(t==null){return null}return{ch:e.ch,line:t}}get root(){if(this.parent==null){return this}return this.parent.root}get_editor_at_virtual_line(e){let t=e.line;if(!this.virtual_lines.has(t)){t-=1}return this.virtual_lines.get(t).editor}get_editor_at_source_line(e){return this.source_lines.get(e.line).editor}maybe_emit_changed(){if(this.value!==this.previous_value){this.changed.emit(this)}this.previous_value=this.value;for(let e of this.foreign_documents.values()){e.maybe_emit_changed()}}}ie.instances_count=0;function re(e){let t=new Set;t.add(e);for(let n of e.foreign_documents.values()){let e=re(n);e.forEach(t.add,t)}return t}class se{constructor(e,t){this.virtual_document=e;this.is_update_in_progress=false;this.update_lock=false;this.isDisposed=false;this.update_done=new Promise((e=>{e()}));this.document_updated=new S.Signal(this);this.block_added=new S.Signal(this);this.update_began=new S.Signal(this);this.update_finished=new S.Signal(this);this.document_updated.connect(this.on_updated,this);this.console=t||new J}dispose(){if(this.isDisposed){return}this.document_updated.disconnect(this.on_updated,this)}on_updated(e,t){try{t.close_expired_documents()}catch(n){this.console.warn("Failed to close expired documents")}}can_update(){return!this.isDisposed&&!this.is_update_in_progress&&!this.update_lock}async with_update_lock(e){await(0,F.EU)((()=>this.can_update()),12,10).then((()=>{try{this.update_lock=true;e()}finally{this.update_lock=false}}))}async update_documents(e){let t=new Promise((async(t,n)=>{await(0,F.EU)((()=>this.can_update()),10,5).then((()=>{if(this.isDisposed||!this.virtual_document){t()}try{this.is_update_in_progress=true;this.update_began.emit(e);this.virtual_document.clear();for(let t of e){this.block_added.emit({block:t,virtual_document:this.virtual_document});this.virtual_document.append_code_block(t)}this.update_finished.emit(e);if(this.virtual_document){this.document_updated.emit(this.virtual_document);this.virtual_document.maybe_emit_changed()}t()}catch(i){this.console.warn("Documents update failed:",i);n(i)}finally{this.is_update_in_progress=false}}))}));this.update_done=t;return t}}var oe=n(35286);var ae=n.n(oe);class le{constructor(e,t,n=new Array,i){this.editor=e;this.virtual_document=t;this.isDisposed=false;this.editor.change.connect(this.saveChange,this);this.console=i.scope("EditorAdapter");this.features=new Map;for(let r of n){r.register();if(!r.is_registered){this.console.warn("The feature ",r,"was not registered properly")}this.features.set(r.feature.id,r)}}async updateAfterChange(){try{await(0,F.EU)((()=>this.last_change!=null),30,22)}catch(n){this.console.log("No change obtained from CodeMirror editor within the expected time of 0.66s");return}let e=this.last_change;let t;try{t=this.editor.get_cursor_position()}catch(n){this.console.log("Root position not found");return}try{let i=this.editor.document_at_root_position(t);if(this.virtual_document!==i){return true}if(!e||!e.text.length||!e.text[0].length){return true}for(let r of this.features.values()){try{if(r.afterChange){r.afterChange(e,t)}}catch(n){console.warn("afterChange of feature",r,"failed with",n)}}return true}catch(i){this.console.log("updateAfterChange failure");this.console.error(i)}this.invalidateLastChange();return undefined}invalidateLastChange(){this.last_change=null}saveChange(e,t){this.last_change=t}dispose(){if(this.isDisposed){return}for(let e of this.features.values()){e.remove()}this.features.clear();this.editor.change.disconnect(this.saveChange);this.editor=null;this.isDisposed=true}}var ce=A.Dialog.createButton;class de{constructor(){this.message="";this.changed=new S.Signal(this);this.timer=null}set(e,t=1e3*3){this.expire_timer();this.message=e;this.changed.emit();if(t!==-1){this.timer=window.setTimeout(this.clear.bind(this),t)}}clear(){this.message="";this.changed.emit()}expire_timer(){if(this.timer!==null){window.clearTimeout(this.timer);this.timer=0}}}const ue={"text/x-rsrc":"r","text/x-r-source":"r","text/x-ipython":"python"};class he{constructor(e,t){this.extension=e;this.widget=t;this.isDisposed=false;this.app=e.app;this.connection_manager=e.connection_manager;this.adapterConnected=new S.Signal(this);this.activeEditorChanged=new S.Signal(this);this.editorRemoved=new S.Signal(this);this.editorAdded=new S.Signal(this);this.adapters=new Map;this.status_message=new de;this.isConnected=false;this.console=e.console.scope("WidgetAdapter");this.trans=(e.translator||E.nullTranslator).load("jupyterlab-lsp");this.widget.context.saveState.connect(this.on_save_state,this);this.connection_manager.closed.connect(this.on_connection_closed,this);this.widget.disposed.connect(this.dispose,this)}get foreign_code_extractors(){return this.extension.foreign_code_extractors}get code_overrides(){return this.extension.code_overrides}on_connection_closed(e,{virtual_document:t}){var n;this.console.log("connection closed, disconnecting adapter",t.id_path);if(t!==((n=this.virtual_editor)===null||n===void 0?void 0:n.virtual_document)){return}this.dispose()}dispose(){var e,t;if(this.isDisposed){return}if((e=this.virtual_editor)===null||e===void 0?void 0:e.virtual_document){this.disconnect_adapter((t=this.virtual_editor)===null||t===void 0?void 0:t.virtual_document)}this.widget.context.saveState.disconnect(this.on_save_state,this);this.connection_manager.closed.disconnect(this.on_connection_closed,this);this.widget.disposed.disconnect(this.dispose,this);this.disconnect();this.virtual_editor=null;this.app=null;this.widget=null;this.connection_manager=null;this.widget=null;this.isDisposed=true}get widget_id(){return this.widget.id}get language(){if(ue.hasOwnProperty(this.mime_type)){return ue[this.mime_type]}else{let e=this.mime_type.split(";")[0];let[t,n]=e.split("/");if(t==="application"||t==="text"){if(n.startsWith("x-")){return n.substr(2)}else{return n}}else{return this.mime_type}}}disconnect(){this.connection_manager.unregister_document(this.virtual_editor.virtual_document);this.widget.context.model.contentChanged.disconnect(this.onContentChanged,this);for(let e of this.editors){this.editorRemoved.emit({editor:e})}for(let e of this.adapters.values()){e.dispose()}this.adapters.clear();this.virtual_editor.dispose()}reload_connection(){if(this.virtual_editor==null){return}this.disconnect();this.init_virtual();this.connect_document(this.virtual_editor.virtual_document,true).catch(this.console.warn)}on_save_state(e,t){if(this.virtual_editor==null){return}const n=t==="completed manually";if(t==="completed"||n){const e=[this.virtual_editor.virtual_document];for(let t of e){let n=this.connection_manager.connections.get(t.uri);this.console.log("Sending save notification for",t.uri,"to",n);n.sendSaved(t.document_info);for(let i of t.foreign_documents.values()){e.push(i)}}}}update_documents(){if(this.isDisposed){this.console.warn("Cannot update documents: adapter disposed");return}return this.virtual_editor.virtual_document.update_manager.update_documents(this.editors.map((e=>({ce_editor:e,value:this.virtual_editor.get_editor_value(e)}))))}get has_multiple_editors(){return this.editors.length>1}async on_connected(e){let{virtual_document:t}=e;this.connect_adapter(e.virtual_document,e.connection);this.adapterConnected.emit(e);this.isConnected=true;const n=this.update_documents();if(!n){this.console.warn("Could not update documents");return}await n.then((()=>{this.document_changed(t,t,true);this.console.log("virtual document(s) for",this.document_path,"have been initialized")}));const i=t.uri;let r;if(this.extension.user_console){const e=this.extension.user_console.getLogger(i);r=t=>{e.log({type:"text",data:t})}}else{r=e=>console.log(e)}e.connection.serverNotifications["$/logTrace"].connect(((n,i)=>{this.console.log(e.connection.serverIdentifier,"trace",t.uri,i)}));e.connection.serverNotifications["window/logMessage"].connect(((n,i)=>{this.console.log(e.connection.serverIdentifier,t.uri,i);r(n.serverIdentifier+": "+i.message)}));e.connection.serverNotifications["window/showMessage"].connect(((n,i)=>{this.console.log(e.connection.serverIdentifier,t.uri,i.message);void(0,A.showDialog)({title:this.trans.__("Message from ")+n.serverIdentifier,body:i.message})}));e.connection.serverRequests["window/showMessageRequest"].setHandler((async n=>{this.console.log(e.connection.serverIdentifier,t.uri,n);const i=n.actions;const r=i?i.map((e=>ce({label:e.title}))):[ce({label:this.trans.__("Dismiss")})];const s=await(0,A.showDialog)({title:this.trans.__("Message from ")+e.connection.serverIdentifier,body:n.message,buttons:r});const o=r.indexOf(s.button);if(o===-1){return null}if(i){return i[o]}return null}))}async connect_document(e,t=false){e.changed.connect(this.document_changed,this);e.foreign_document_opened.connect(this.on_foreign_document_opened,this);const n=await this.connect(e).catch(this.console.warn);if(!t){return}if(n&&n.connection){n.connection.sendOpenWhenReady(e.document_info)}else{this.console.warn(`Connection for ${e.path} was not opened`)}}create_virtual_editor(e){let t=this.extension.editor_type_manager.findBestImplementation(this.editors);if(t==null){return null}let n=t.implementation;return new n(e)}init_virtual(){let e=this.create_virtual_editor({adapter:this,virtual_document:this.create_virtual_document()});if(e==null){this.console.error("Could not initialize a VirtualEditor for adapter: ",this);return}this.virtual_editor=e;this.connect_contentChanged_signal()}async on_foreign_document_opened(e,t){const{foreign_document:n}=t;await this.connect_document(n,true);n.foreign_document_closed.connect(this.on_foreign_document_closed,this)}on_foreign_document_closed(e,t){const{foreign_document:n}=t;n.foreign_document_closed.disconnect(this.on_foreign_document_closed,this);n.foreign_document_opened.disconnect(this.on_foreign_document_opened,this);n.changed.disconnect(this.document_changed,this)}document_changed(e,t,n=false){if(this.isDisposed){this.console.warn("Cannot swap document: adapter disposed");return}let i=this.connection_manager.connections.get(e.uri);let r=this.adapters.get(e.id_path);if(!(i===null||i===void 0?void 0:i.isReady)){this.console.log("Skipping document update signal: connection not ready");return}if(r==null){this.console.log("Skipping document update signal: adapter not ready");return}i.sendFullTextChange(e.value,e.document_info);if(!n){this.virtual_editor.virtual_document.update_manager.with_update_lock((async()=>{await r.updateAfterChange()})).then().catch(this.console.warn)}}connect_adapter(e,t,n=null){let i=this.create_adapter(e,t,n);this.adapters.set(e.id_path,i);return i}disconnect_adapter(e){let t=this.adapters.get(e.id_path);this.adapters.delete(e.id_path);if(t!=null){t.dispose()}}get_features(e){let t=this.adapters.get(e.id_path);return t===null||t===void 0?void 0:t.features}async connect(e){let t=e.language;this.console.log(`will connect using language: ${t}`);let n={textDocument:{synchronization:{dynamicRegistration:true,willSave:false,didSave:true,willSaveWaitUntil:false}},workspace:{didChangeConfiguration:{dynamicRegistration:true}}};for(const s of this.extension.feature_manager.features){if(!s.capabilities){continue}n=ae()(n,s.capabilities)}let i={capabilities:n,virtual_document:e,language:t,document_path:this.document_path};let r=await this.connection_manager.connect(i);if(r){await this.on_connected({virtual_document:e,connection:r});return{connection:r,virtual_document:e}}else{return undefined}}connect_contentChanged_signal(){this.widget.context.model.contentChanged.connect(this.onContentChanged,this)}create_adapter(e,t,n=null){let i=new Array;if(n===null){n=this.extension.feature_manager.features}for(let s of n){let n=s.editorIntegrationFactory.get(this.virtual_editor.editor_name);let r=new n({feature:s,virtual_editor:this.virtual_editor,virtual_document:e,connection:t,status_message:this.status_message,settings:s.settings,adapter:this,trans:this.trans});i.push(r)}let r=new le(this.virtual_editor,e,i,this.console);this.console.log("Adapter for",this.document_path,"is ready.");t.sendOpenWhenReady(e.document_info);return r}async onContentChanged(e){const t=this.update_documents();if(!t){this.console.warn("Could not update documents");return}this.update_finished=t.catch(this.console.warn);await this.update_finished}get_position_from_context_menu(){let e=this.app.contextMenuHitTest((()=>true));if(!e){return null}let{left:t,top:n}=e.getBoundingClientRect();let i=this.app._contextMenuEvent;if(i!==undefined){t=i.clientX;n=i.clientY;i.stopPropagation()}return this.virtual_editor.window_coords_to_root_position({left:t,top:n})}get_context(e){if(!this.virtual_editor){return null}let t=this.virtual_editor.document_at_root_position(e);let n=this.virtual_editor.root_position_to_virtual_position(e);return{document:t,connection:this.connection_manager.connections.get(t.uri),virtual_position:n,root_position:e,features:this.get_features(t),editor:this.virtual_editor,app:this.app,adapter:this}}get_context_from_context_menu(){let e=this.get_position_from_context_menu();if(!e){return null}return this.get_context(e)}}class ge extends he{constructor(e,t){super(e,t);this.editor=t.content;this.initialized=new Promise(((e,t)=>{this.init_once_ready().then(e).catch(t)}))}get document_path(){return this.widget.context.path}get mime_type(){const e=this.editor.model.mimeType;const t=this.editor.context.contentsModel;if(e!="text/plain"){return e}else if(t){let e=this.extension.app.docRegistry.getFileTypeForModel(t);return e.mimeTypes[0]}else{return e}}get language_file_extension(){let e=this.document_path.split(".");return e[e.length-1]}get ce_editor(){return this.editor.editor}get activeEditor(){return this.editor.editor}async init_once_ready(){if(!this.editor.context.isReady){await this.editor.context.ready}this.init_virtual();this.console.log("file ready for connection:",this.path);this.connect_document(this.virtual_editor.virtual_document,false).catch(this.console.warn);this.editor.model.mimeTypeChanged.connect(this.reload_connection,this)}get_editor_index(e){return 0}get_editor_wrapper(e){return this.wrapper_element}get wrapper_element(){return this.widget.node}get path(){return this.widget.context.path}context_from_active_document(){if(!this.virtual_editor||!this.get_context){return null}let e=this.widget.content.editor;let t=e.getCursorPosition();let n=z.ce_to_cm(t);return this.get_context(n)}get_editor_index_at(e){return 0}get editors(){return[this.editor.editor]}create_virtual_document(){return new ie({language:this.language,file_extension:this.language_file_extension,path:this.document_path,overrides_registry:{},foreign_code_extractors:{},standalone:true,has_lsp_supported_file:true,console:this.console})}}const pe="file-editor-context-menu";const _e={id:s+":FileEditorAdapter",requires:[a],optional:[O.IEditorTracker],activate(e,t,n){if(n===null){console.warn("LSP: no fileEditorTracker - not registering file editor capabilities")}else{t.registerAdapterType({name:"file_editor",tracker:n,adapter:ge,entrypoint:pe,get_id(e){return e.id},context_menu:{selector:".jp-FileEditor",rank_group:0,rank_group_size:4}})}},autoStart:true};var me=n(60018);class fe extends he{constructor(e,t){super(e,t);this.type="code";this.is_ready=()=>{var e;return!this.widget.isDisposed&&this.widget.context.isReady&&this.widget.content.isVisible&&this.widget.content.widgets.length>0&&((e=this.widget.context.sessionContext.session)===null||e===void 0?void 0:e.kernel)!=null};this.ce_editor_to_cell=new Map;this.editor=t.content;this.known_editors_ids=new Set;this.initialized=new Promise(((e,t)=>{this.init_once_ready().then(e).catch(t)}))}async update_language_info(){var e,t,n,i;const r=(i=await((n=(t=(e=this.widget.context.sessionContext)===null||e===void 0?void 0:e.session)===null||t===void 0?void 0:t.kernel)===null||n===void 0?void 0:n.info))===null||i===void 0?void 0:i.language_info;if(r){this._language_info=r}else{throw new Error("Language info update failed (no session, kernel, or info available)")}}async on_kernel_changed(e,t){if(!t.newValue){this.console.log("Kernel was shut down");return}try{this.console.log("Changed kernel, will try to reconnect");const e=this._language_info;await(0,F.EU)(this.is_ready,-1);await this.update_language_info();const t=this._language_info;if((e===null||e===void 0?void 0:e.name)!=t.name||(e===null||e===void 0?void 0:e.mimetype)!=(t===null||t===void 0?void 0:t.mimetype)||(e===null||e===void 0?void 0:e.file_extension)!=(t===null||t===void 0?void 0:t.file_extension)){this.console.log(`Changed to ${this._language_info.name} kernel, reconnecting`);this.reload_connection()}else{this.console.log("Keeping old LSP connection as the new kernel uses the same langauge")}}catch(n){this.console.warn(n);this.reload_connection()}}dispose(){if(this.isDisposed){return}this.widget.context.sessionContext.kernelChanged.disconnect(this.on_kernel_changed,this);this.widget.content.activeCellChanged.disconnect(this.activeCellChanged,this);super.dispose();this.ce_editor_to_cell.clear()}get document_path(){return this.widget.context.path}language_info(){return this._language_info}get mime_type(){let e=this.language_info();if(!e||!e.mimetype){return this.widget.content.codeMimetype}return e.mimetype}get language_file_extension(){let e=this.language_info();if(!e||!e.file_extension){return}return e.file_extension.replace(".","")}get wrapper_element(){return this.widget.node}async init_once_ready(){this.console.log("waiting for",this.document_path,"to fully load");await this.widget.context.sessionContext.ready;await(0,F.EU)(this.is_ready,-1);await this.update_language_info();this.console.log(this.document_path,"ready for connection");this.init_virtual();this.connect_document(this.virtual_editor.virtual_document,false).catch(this.console.warn);this.widget.context.sessionContext.kernelChanged.connect(this.on_kernel_changed,this);this.widget.content.activeCellChanged.connect(this.activeCellChanged,this);this._connectModelSignals(this.widget);this.editor.modelChanged.connect((e=>{this.console.warn("Model changed, connecting cell change handler; this is not something we were expecting");this._connectModelSignals(e)}))}_connectModelSignals(e){if(e.model===null){this.console.warn(`Model is missing for notebook ${e}, cannot connet cell changed signal!`)}else{e.model.cells.changed.connect(this.handle_cell_change,this)}}async handle_cell_change(e,t){let n=[];let i=[];const r=this.type;if(t.type==="set"){let e=[];let s=[];if(t.newValues.length===t.oldValues.length){for(let n=0;n<t.newValues.length;n++){if(t.oldValues[n].type===r&&t.newValues[n].type!==r){e.push(t.newValues[n])}else if(t.oldValues[n].type!==r&&t.newValues[n].type===r){s.push(t.newValues[n])}}n=s;i=e}}else if(t.type=="add"){n=t.newValues.filter((e=>e.type===r))}if(i.length||n.length||t.type==="move"||t.type==="remove"){await this.update_documents()}for(let s of i){let e=this.widget.content.widgets.find((e=>e.model.id===s.id));if(!e){this.console.warn(`Widget for removed cell with ID: ${s.id} not found!`);continue}this.known_editors_ids.delete(e.editor.uuid);this.editorRemoved.emit({editor:e.editor})}for(let s of n){let e=this.widget.content.widgets.find((e=>e.model.id===s.id));if(!e){this.console.warn(`Widget for added cell with ID: ${s.id} not found!`);continue}this.known_editors_ids.add(e.editor.uuid);this.editorAdded.emit({editor:e.editor})}}get editors(){if(this.isDisposed){return[]}let e=this.widget.content;this.ce_editor_to_cell.clear();if(e.isDisposed){return[]}return e.widgets.filter((e=>e.model.type==="code")).map((e=>{this.ce_editor_to_cell.set(e.editor,e);return e.editor}))}create_virtual_document(){return new ie({language:this.language,path:this.document_path,overrides_registry:this.code_overrides,foreign_code_extractors:this.foreign_code_extractors,file_extension:this.language_file_extension,standalone:false,has_lsp_supported_file:false,console:this.console})}get activeEditor(){var e;return(e=this.widget.content.activeCell)===null||e===void 0?void 0:e.editor}activeCellChanged(e,t){if(t.model.type!==this.type){return}if(!this.known_editors_ids.has(t.editor.uuid)){this.known_editors_ids.add(t.editor.uuid);this.editorAdded.emit({editor:t.editor})}this.activeEditorChanged.emit({editor:t.editor})}context_from_active_document(){let e=this.widget.content.activeCell;if(e===null){return null}if(!this.virtual_editor||!this.get_context){return null}if(e.model.type!==this.type){return null}let t=e.editor;let n=t.getCursorPosition();let i=z.ce_to_cm(n);let r=this.virtual_editor;if(r==null){return null}let s=r.transform_from_editor_to_root(t,i);if(s==null){this.console.warn("Could not retrieve current context",r);return null}return this.get_context(s)}get_editor_index_at(e){let t=this.get_cell_at(e);let n=this.widget.content;return n.widgets.findIndex((e=>t===e))}get_editor_index(e){let t=this.ce_editor_to_cell.get(e);let n=this.widget.content;return n.widgets.findIndex((e=>t===e))}get_editor_wrapper(e){let t=this.ce_editor_to_cell.get(e);return t.node}get_cell_at(e){let t=this.virtual_editor.virtual_document.get_editor_at_virtual_line(e);return this.ce_editor_to_cell.get(t)}}const ve="notebook-cell-context-menu";const Ae={id:s+":NotebookAdapter",requires:[a,me.INotebookTracker],activate(e,t,n){t.registerAdapterType({name:"notebook",tracker:n,adapter:fe,entrypoint:ve,get_id(e){return e.content.id},context_menu:{selector:".jp-Notebook .jp-CodeCell .jp-Editor",rank_group:10+Number.EPSILON,rank_group_size:2+2,callback(e){e.add_context_separator(0)}}})},autoStart:true};function we(e){let t=e.get_position_from_context_menu();if(!t){return false}let n=e.virtual_editor.get_token_at(t);return n.value!==""}class be{constructor(e){this.add_to_palette=true;this.category="Language Server Protocol";this.adapter_manager=e.adapter_manager;this.app=e.app;this.palette=e.palette;this.tracker=e.tracker;this.suffix=e.suffix;this.entry_point=e.entry_point}get current_adapter(){return this.adapter_manager.currentAdapter}add(e){for(let t of e){let e=this.create_id(t);this.app.commands.addCommand(e,{execute:()=>this.execute(t),isEnabled:()=>this.is_enabled(t),isVisible:()=>this.is_visible(t),label:t.label,icon:t.icon});if(this.should_attach(t)){this.attach_command(t)}if(this.add_to_palette){this.palette.addItem({command:e,category:this.category})}}}should_attach(e){if(e.attach_to==null){return true}return e.attach_to.has(this.entry_point)}create_id(e){return"lsp:"+e.id+"-"+this.suffix}}class ye extends be{constructor(e){super(e);this.selector=e.selector;this.entry_point=e.entry_point;this.rank_group=e.rank_group;this.rank_group_size=e.rank_group_size;this.console=e.console;if(e.callback){e.callback(this)}}attach_command(e){this.app.contextMenu.addItem({selector:this.selector,command:this.create_id(e),rank:this.get_rank(e)})}add_context_separator(e){var t;this.app.contextMenu.addItem({type:"separator",selector:this.selector,rank:((t=this.rank_group)!==null&&t!==void 0?t:0)+e})}execute(e){let t=this.get_context();if(t){e.execute(t)}}get is_context_menu_open(){return this.app.contextMenu.menu.isAttached}get is_widget_current(){return this.tracker.currentWidget!=null&&this.tracker.currentWidget===this.app.shell.currentWidget}is_enabled(){if(this.is_context_menu_open){return we(this.current_adapter)}else{return this.is_widget_current}}get_context(){var e;let t=null;if(this.is_context_menu_open){try{t=this.current_adapter.get_context_from_context_menu()}catch(n){this.console.warn("contextMenu is attached, but could not get the context",n);t=null}}if(t==null){try{t=(e=this.current_adapter)===null||e===void 0?void 0:e.context_from_active_document()}catch(n){if(n instanceof p){this.console.log("Could not get context from active document: it is expected when restoring workspace with open files")}else{throw n}}}return t}is_visible(e){try{let t=this.get_context();return t!=null&&this.current_adapter&&t.connection!=null&&t.connection.isReady&&e.is_enabled(t)}catch(t){this.console.warn("is_visible failed",t);return false}}get_rank(e){let t=typeof e.is_rank_relative==="undefined"?true:e.is_rank_relative;if(t&&typeof this.rank_group!=="undefined"&&this.rank_group_size){let t=typeof e.rank!=="undefined"?e.rank:0;return this.rank_group+t/this.rank_group_size}else{return e.rank!=null?e.rank:Infinity}}}var Ce=n(16923);var Ee=n(77865);var xe=n.n(Ee);var ke=n(63636);var je={};je.insert="head";je.singleton=false;var Se=I()(ke.Z,je);const Me=ke.Z.locals||{};function Ie(e,t){return xe().createElement("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"lsp-external-link"},t)}const Te="https://jupyter-server.readthedocs.io/en/latest/operators/migrate-from-nbserver.html";const Le="https://github.com/jupyterhub/jupyterhub/pull/3329/files";const Be=xe().createElement("div",null,xe().createElement("p",null,"It appears that the required Jupyter server extension (",xe().createElement("code",null,"jupyter-lsp"),") is not installed (or not enabled) in this environment."),xe().createElement("h3",null,"What are the likely reasons?"),xe().createElement("ul",null,xe().createElement("li",null,"It might be that you just installed it and need to restart JupyterLab to make it available on startup."),xe().createElement("li",null,"Alternatively, you may be using an older ",xe().createElement("code",null,"notebook")," server instead of the new ",xe().createElement("code",null,"jupyter_server"),"; please refer to the"," ",Ie(Te,"migration guide")," or if you are a JupyterHub user please ensure that you start the JupyterLab using"," ",xe().createElement("code",null,"jupyter_server")," and not the old ",xe().createElement("code",null,"notebook"),", as documented in"," ",Ie(Le,"this pull request"),"."),xe().createElement("li",null,"There may be schema errors or language server errors preventing the extension from loading - please check the logs of JupyterLab (in the console where you execute ",xe().createElement("code",null,"jupyter lab"))),xe().createElement("h3",null,"How do I check if the extension is installed?"),xe().createElement("p",null,"Please ensure that ",xe().createElement("code",null,"jupyter server extension list")," includes jupyter-lsp and that it is enabled. If it is enabled please try to restart JupyterLab. If the server extension is installed but not enabled and all other suggestions listed above failed try the following:",xe().createElement("code",null,"jupyter server extension enable --user --py jupyter_lsp")));const Re='<svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24">\n  <g class="jp-icon3 jp-icon-selectable" fill="#616161" shape-rendering="geometricPrecision">\n    <path d="M6.59,3.41L2,8L6.59,12.6L8,11.18L4.82,8L8,4.82L6.59,3.41M12.41,3.41L11,4.82L14.18,8L11,11.18L12.41,12.6L17,8L12.41,3.41M21.59,11.59L13.5,19.68L9.83,16L8.42,17.41L13.5,22.5L23,13L21.59,11.59Z" />\n  </g>\n</svg>\n';const De='<svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24">\n  <g class="jp-icon3 jp-icon-selectable" fill="#616161" shape-rendering="geometricPrecision">\n    <path d="M6.59 3.41L2 8l4.59 4.6L8 11.18 4.82 8 8 4.82 6.59 3.41m5.82 0L11 4.82 14.18 8 11 11.18l1.41 1.42L17 8l-4.59-4.59M18.093 21.608a3.998 3.998 0 004.015-4.015 3.998 3.998 0 00-4.015-4.016 3.998 3.998 0 00-4.016 4.016 3.998 3.998 0 004.016 4.015m0-8.923c2.676 0 4.907 2.23 4.907 4.908 0 2.676-2.23 4.907-4.907 4.907s-4.908-2.23-4.908-4.907 2.23-4.908 4.908-4.908m2.498 5.89l-.348.624-2.588-1.428v-2.632h.75v2.141z" />\n  </g>\n</svg>\n';const Pe='<svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24">\n  <g class="jp-icon3 jp-icon-selectable" fill="#616161" shape-rendering="geometricPrecision">\n    <path d="M6.59 3.41L2 8l4.59 4.6L8 11.18 4.82 8 8 4.82 6.59 3.41m5.82 0L11 4.82 14.18 8 11 11.18l1.41 1.42L17 8l-4.59-4.59M16.95 12.05L10.9 22.5H23m-6.05-8.25l4.141 7.15h-8.283m3.592-4.95v2.2h1.1v-2.2m-1.1 3.3v1.1h1.1v-1.1"/>\n  </g>\n</svg>\n';const Oe=new Ce.LabIcon({name:"lsp:codeWarning",svgstr:Pe});const ze=new Ce.LabIcon({name:"lsp:codeClock",svgstr:De});const $e=new Ce.LabIcon({name:"lsp:codeCheck",svgstr:Re});function Fe(e,t,n,i=true){if(!n){n=E.nullTranslator.load("")}return e.ancestry.map((e=>{if(!e.parent){let t=e.path;if(!e.has_lsp_supported_file&&e.file_extension&&t.endsWith(e.file_extension)){t=t.slice(0,-e.file_extension.length-1)}const n=t;if(i){let e=t.split("/");if(e.length>2){t=e[0]+"/.../"+e[e.length-1]}}return xe().createElement("span",{key:e.uri,title:n},t)}if(!e.virtual_lines.size){return xe().createElement("span",{key:e.uri},"Empty document")}try{if(t.has_multiple_editors){let i=e.virtual_lines.get(0);let r=e.virtual_lines.get(e.last_virtual_line-1);let s=t.get_editor_index(i.editor);let o=t.get_editor_index(r.editor);let a=s===o?n.__("cell %1",s+1):n.__("cells: %1-%2",s+1,o+1);return xe().createElement("span",{key:e.uri},e.language," (",a,")")}}catch(r){console.warn("LSP: could not display document cell location",r)}return xe().createElement("span",{key:e.uri},e.language)}))}function Ue(e,t,n=true){return Fe(e,t,undefined,n)}function Ne(e){if(!e){return}e.scrollIntoView();e.focus()}function qe(e){let{document:t,adapter:n}=e;let i=null;if(n.has_multiple_editors){let e=t.virtual_lines.get(0);if(e){i=n.get_editor_wrapper(e.editor)}else{console.warn("Could not get first line of ",t)}}let r=Fe(t,n,e.trans);return xe().createElement("div",{className:"lsp-document-locator",onClick:()=>i?Ne(i):null},r)}var We=A.Dialog.okButton;function He(e){let t=e.server.spec.languages.map(((e,t)=>xe().createElement("li",{key:t},e)));return xe().createElement("div",{className:"lsp-server-status"},xe().createElement("h5",null,e.server.spec.display_name),xe().createElement("ul",null,t))}class Ve extends xe().Component{constructor(e){super(e);this.handleClick=()=>{this.setState((e=>({isCollapsed:!e.isCollapsed})))};this.state={isCollapsed:e.startCollapsed||false}}render(){const e=!this.state.isCollapsed?Ce.caretUpIcon:Ce.caretDownIcon;return xe().createElement("div",{className:"lsp-collapsible-list "+(this.state.isCollapsed?"lsp-collapsed":"")},xe().createElement("h4",{onClick:this.handleClick},xe().createElement(e.react,{tag:"span",className:"lsp-caret-icon"}),this.props.title,": ",this.props.list.length),xe().createElement("div",null,this.props.list))}}class Ke extends xe().Component{render(){const e=this.props.specs;const t=this.props.trans;return xe().createElement("div",null,xe().createElement("h3",null,e.display_name),xe().createElement("div",null,xe().createElement("ul",{className:"lsp-server-links-list"},Object.entries((e===null||e===void 0?void 0:e.urls)||{}).map((([e,t])=>xe().createElement("li",{key:this.props.serverId+"-url-"+e},e,":"," ",xe().createElement("a",{href:t,target:"_blank",rel:"noreferrer"},t))))),xe().createElement("h4",null,t.__("Troubleshooting")),xe().createElement("p",{className:"lsp-troubleshoot-section"},e.troubleshoot?e.troubleshoot:t.__("In case of issues with installation feel welcome to ask a question on GitHub.")),xe().createElement("h4",null,t.__("Installation")),xe().createElement("ul",null,(e===null||e===void 0?void 0:e.install)?Object.entries((e===null||e===void 0?void 0:e.install)||{}).map((([e,t])=>xe().createElement("li",{key:this.props.serverId+"-install-"+e},e,": ",xe().createElement("code",null,t)))):t.__("No installation instructions were provided with this specification."))))}}class Ze extends xe().Component{constructor(){super(...arguments);this.handleClick=()=>{const e=this.props.trans;(0,A.showDialog)({title:e.__("No language server for %1 detected",this.props.language),body:xe().createElement("div",null,this.props.servers.size?xe().createElement("div",null,xe().createElement("p",null,e._n("There is %1 language server you can easily install that supports %2.","There are %1 language servers you can easily install that supports %2.",this.props.servers.size,this.props.language)),[...this.props.servers.entries()].map((([t,n])=>xe().createElement(Ke,{specs:n,serverId:t,key:t,trans:e})))):xe().createElement("div",null,xe().createElement("p",null,e.__("We do not have an auto-detection ready for a language servers supporting %1 yet.",this.props.language)),xe().createElement("p",null,e.__("You may contribute a specification for auto-detection as described in our ")," ",xe().createElement("a",{href:"https://jupyterlab-lsp.readthedocs.io/en/latest/Contributing.html#specs"},e.__("documentation"))))),buttons:[We()]}).catch(console.warn)}}render(){return xe().createElement("button",{type:"button",className:"jp-Button lsp-help-button",onClick:this.handleClick},"?")}}class Ge extends A.VDomRenderer{constructor(e){super(e);this.addClass("lsp-popover")}render(){var e;if(!((e=this.model)===null||e===void 0?void 0:e.connection_manager)){return null}const t=this.model.servers_available_not_in_use.map(((e,t)=>xe().createElement(He,{key:t,server:e})));let n=new Array;let i=-1;for(let[o,a]of this.model.documents_by_server.entries()){i+=1;let e=new Array;for(let[t,n]of a){let r=n.map(((e,t)=>{let n=this.model.connection_manager.connections.get(e.uri);let i="";if(n===null||n===void 0?void 0:n.isInitialized){i="initialized"}else if(n===null||n===void 0?void 0:n.isConnected){i="connected"}else{i="not connected"}const r=i==="initialized"?Ce.circleIcon:Ce.circleEmptyIcon;return xe().createElement("li",{key:t},xe().createElement(qe,{document:e,adapter:this.model.adapter}),xe().createElement("span",{className:"lsp-document-status"},this.model.trans.__(i),xe().createElement(r.react,{tag:"span",className:"lsp-document-status-icon",elementSize:"small"})))}));e.push(xe().createElement("div",{key:i,className:"lsp-documents-by-language"},xe().createElement("h5",null,t," ",xe().createElement("span",{className:"lsp-language-server-name"},"(",o.spec.display_name,")")),xe().createElement("ul",null,r)))}n.push(xe().createElement("div",{key:i},e))}const r=this.model.missing_languages.map(((e,t)=>{const n=this.model.language_server_manager.getMatchingSpecs({language:e});return xe().createElement("div",{key:t,className:"lsp-missing-server"},e,n.size?xe().createElement(Ze,{language:e,servers:n,trans:this.model.trans}):"")}));const s=this.model.trans;return xe().createElement("div",{className:"lsp-popover-content"},xe().createElement("div",{className:"lsp-servers-menu"},xe().createElement("h3",{className:"lsp-servers-title"},s.__("LSP servers")),xe().createElement("div",{className:"lsp-servers-lists"},t.length?xe().createElement(Ve,{key:"available",title:s.__("Available"),list:t,startCollapsed:true}):"",n.length?xe().createElement(Ve,{key:"running",title:s.__("Running"),list:n}):"",r.length?xe().createElement(Ve,{key:"missing",title:s.__("Missing"),list:r}):"")),xe().createElement("div",{className:"lsp-popover-status"},s.__("Documentation:")," ",xe().createElement("a",{href:"https://jupyterlab-lsp.readthedocs.io/en/latest/Language%20Servers.html",target:"_blank",rel:"noreferrer"},s.__("Language Servers"))))}}const Ye="jp-mod-selected";class Je extends A.VDomRenderer{constructor(e,t=true,n){super(new Je.Model(e,n));this.displayText=t;this._popup=null;this.handleClick=()=>{if(this._popup){this._popup.dispose()}if(this.model.status.status=="no_server_extension"){(0,A.showDialog)({title:this.trans.__("LSP server extension not found"),body:Be,buttons:[We()]}).catch(console.warn)}else{this._popup=(0,C.showPopup)({body:new Ge(this.model),anchor:this,align:"left"})}};this.addClass(C.interactiveItem);this.addClass("lsp-statusbar-item");this.trans=n;this.title.caption=this.trans.__("LSP status");this.interactiveStateObserver=new MutationObserver((()=>{const e=this.node.classList.contains(Ye);if(!this.node.classList.contains(C.interactiveItem)){if(!e){this.addClass(Ye)}}else{if(e){this.removeClass(Ye)}}}))}onAfterAttach(e){super.onAfterAttach(e);this.interactiveStateObserver.observe(this.node,{attributes:true,attributeFilter:["class"]})}onBeforeDetach(e){super.onBeforeDetach(e);this.interactiveStateObserver.disconnect()}render(){const{model:e}=this;if(e==null){return null}return xe().createElement(C.GroupItem,{spacing:this.displayText?2:0,title:e.long_message,onClick:this.handleClick,className:"lsp-status-group"},xe().createElement(e.status_icon.react,{top:"2px",kind:"statusBar",title:this.trans.__("LSP Code Intelligence")}),this.displayText?xe().createElement(C.TextItem,{className:"lsp-status-message",source:e.short_message}):xe().createElement(xe().Fragment,null),xe().createElement(C.TextItem,{source:e.feature_message}))}}class Xe{constructor(e){this.options=e}createItem(e=true){const t=new Je(this.options.adapter_manager,e,this.options.translator_bundle);t.model.language_server_manager=this.options.language_server_manager;t.model.connection_manager=this.options.connection_manager;return t}createNew(e,t){const n=this.createItem(false);n.addClass("jp-ToolbarButton");e.toolbar.insertAfter("spacer","LSPStatus",n);return n}}function Qe(e){let t=re(e);return new Set([...t].map((e=>e.language.toLocaleLowerCase())))}const et={no_server_extension:"error",waiting:"inactive",initialized:"ready",initializing:"preparing",initialized_but_some_missing:"ready",connecting:"preparing"};const tt={no_server_extension:Oe,waiting:ze,initialized:$e,initializing:ze,initialized_but_some_missing:Oe,connecting:ze};const nt={no_server_extension:"Server extension missing",waiting:"Waiting...",initialized:"Fully initialized",initialized_but_some_missing:"Initialized (additional servers needed)",initializing:"Initializing...",connecting:"Connecting..."};(function(e){class t extends A.VDomModel{constructor(e,t){super();this.server_extension_status=null;this._onChange=()=>{this.stateChanged.emit(void 0)};this._adapter=null;this.trans=t;e.adapterChanged.connect(((e,t)=>{this.change_adapter(t)}),this);e.adapterDisposed.connect(((e,t)=>{if(this.adapter===t){this.change_adapter(null)}}),this)}get available_servers(){return this.language_server_manager.sessions}get supported_languages(){const e=new Set;for(let t of this.available_servers.values()){for(let n of t.spec.languages){e.add(n.toLocaleLowerCase())}}return e}is_server_running(e,t){for(const n of this.detected_languages){const t=this.language_server_manager.getMatchingServers({language:n});if(t.length&&t[0]===e){return true}}return false}get documents_by_server(){var e;let t=new Map;if(!((e=this.adapter)===null||e===void 0?void 0:e.virtual_editor)){return t}let n=this.adapter.virtual_editor.virtual_document;let i=re(n);for(let r of i.values()){let e=r.language.toLocaleLowerCase();let n=this._connection_manager.language_server_manager.getMatchingServers({language:r.language});if(n.length===0){continue}let i=this.language_server_manager.sessions.get(n[0]);if(!t.has(i)){t.set(i,new Map)}let s=t.get(i);if(!s.has(e)){s.set(e,new Array)}let o=s.get(e);o.push(r)}return t}get servers_available_not_in_use(){return[...this.available_servers.entries()].filter((([e,t])=>!this.is_server_running(e,t))).map((([e,t])=>t))}get detected_languages(){var e;if(!((e=this.adapter)===null||e===void 0?void 0:e.virtual_editor)){return new Set}let t=this.adapter.virtual_editor.virtual_document;return Qe(t)}get missing_languages(){return[...this.detected_languages].filter((e=>!this.supported_languages.has(e.toLocaleLowerCase())))}get status(){var e;let t;if(!((e=this.adapter)===null||e===void 0?void 0:e.virtual_editor)){t=new Map}else{let e=this.adapter.virtual_editor.virtual_document;const n=this._connection_manager.documents;const i=re(e);t=new Map([...n].filter((([e,t])=>i.has(t))))}let n=new Set;let i=new Set;let r=new Set;let s=new Set;let o=new Set;t.forEach(((e,t)=>{let a=this._connection_manager.connections.get(t);let l=this._connection_manager.language_server_manager.getMatchingServers({language:e.language});if(l.length!==0){o.add(e)}if(!a){r.add(e);return}else{s.add(e)}if(a.isConnected){n.add(e)}if(a.isInitialized){i.add(e)}}));let a=new Array;this._connection_manager.connections.forEach(((e,t)=>{if(e.isConnected){a.push(e)}}));let l;if(this.language_server_manager.statusCode===404){l="no_server_extension"}else if(t.size===0){l="waiting"}else if(i.size===t.size){l="initialized"}else if(i.size===s.size&&t.size>o.size){l="initialized_but_some_missing"}else if(n.size===s.size){l="initializing"}else{l="connecting"}return{open_connections:a,connected_documents:n,initialized_documents:i,detected_documents:new Set([...t.values()]),status:l}}get status_icon(){if(!this.adapter){return Ce.stopIcon}return tt[this.status.status].bindprops({className:"lsp-status-icon "+et[this.status.status]})}get short_message(){if(!this.adapter){return this.trans.__("not initialized")}return this.trans.__(nt[this.status.status])}get feature_message(){var e,t;return((t=(e=this.adapter)===null||e===void 0?void 0:e.status_message)===null||t===void 0?void 0:t.message)||""}get long_message(){if(!this.adapter){return this.trans.__("not initialized")}let e=this.status;let t="";if(e.status==="waiting"){t=this.trans.__("Waiting for documents initialization...")}else if(e.status==="initialized"){t=this.trans._n("Fully connected & initialized (%2 virtual document)","Fully connected & initialized (%2 virtual document)",e.detected_documents.size,e.detected_documents.size)}else if(e.status==="initializing"){const n=new Set(e.detected_documents);for(let t of e.initialized_documents.values()){n.delete(t)}t=this.trans._np("pluralized","Fully connected, but %2/%3 virtual document stuck uninitialized: %4","Fully connected, but %2/%3 virtual documents stuck uninitialized: %4",e.detected_documents.size,n.size,e.detected_documents.size,[...n].map((e=>e.id_path)).join(", "))}else{const n=new Set(e.detected_documents);for(let t of e.connected_documents.values()){n.delete(t)}t=this.trans._np("pluralized","%2/%3 virtual document connected (%4 connections; waiting for: %5)","%2/%3 virtual documents connected (%4 connections; waiting for: %5)",e.detected_documents.size,e.connected_documents.size,e.detected_documents.size,e.open_connections.length,[...n].map((e=>e.id_path)).join(", "))}return t}get adapter(){return this._adapter}change_adapter(e){if(this._adapter!=null){this._adapter.status_message.changed.disconnect(this._onChange)}if(e!=null){e.status_message.changed.connect(this._onChange)}this._adapter=e}get connection_manager(){return this._connection_manager}set connection_manager(e){if(this._connection_manager!=null){this._connection_manager.connected.disconnect(this._onChange);this._connection_manager.initialized.connect(this._onChange);this._connection_manager.disconnected.disconnect(this._onChange);this._connection_manager.closed.disconnect(this._onChange);this._connection_manager.documents_changed.disconnect(this._onChange)}if(e!=null){e.connected.connect(this._onChange);e.initialized.connect(this._onChange);e.disconnected.connect(this._onChange);e.closed.connect(this._onChange);e.documents_changed.connect(this._onChange)}this._connection_manager=e}}e.Model=t})(Je||(Je={}));class it{constructor(){this.registry={}}register(e,t){if(!this.registry.hasOwnProperty(t)){this.registry[t]=[]}this.registry[t].push(e)}}const rt={id:c.name,requires:[],activate:e=>new it,provides:c,autoStart:true};var st=n(22223);var ot=n(32603);var at=n(72947);const lt='<svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24">\n  <g class="jp-icon3 jp-icon-selectable" fill="#616161" shape-rendering="geometricPrecision">\n     <path d="M5,9.5L7.5,14H2.5L5,9.5M3,4H7V8H3V4M5,20A2,2 0 0,0 7,18A2,2 0 0,0 5,16A2,2 0 0,0 3,18A2,2 0 0,0 5,20M9,5V7H21V5H9M9,19H21V17H9V19M9,13H21V11H9V13Z" />\n  </g>\n</svg>\n';class ct{constructor(e,t){this.settingRegistry=e;this.changed=new S.Signal(this);if(!(t in e.plugins)){console.warn(`${t} settings schema could not be found and was not loaded`)}else{this.ready=new Promise((n=>{e.load(t).then((e=>{this.settings=e;n();this.changed.emit();e.changed.connect((()=>{this.settings=e;this.changed.emit()}))})).catch(console.warn)}))}}get composite(){return this.settings.composite}set(e,t){this.settings.set(e,t).catch(console.warn)}}var dt;(function(e){e[e["Error"]=1]="Error";e[e["Warning"]=2]="Warning";e[e["Information"]=3]="Information";e[e["Hint"]=4]="Hint"})(dt||(dt={}));var ut;(function(e){e[e["Unnecessary"]=1]="Unnecessary";e[e["Deprecated"]=2]="Deprecated"})(ut||(ut={}));var ht;(function(e){e[e["Deprecated"]=1]="Deprecated"})(ht||(ht={}));var gt;(function(e){e[e["Text"]=1]="Text";e[e["Method"]=2]="Method";e[e["Function"]=3]="Function";e[e["Constructor"]=4]="Constructor";e[e["Field"]=5]="Field";e[e["Variable"]=6]="Variable";e[e["Class"]=7]="Class";e[e["Interface"]=8]="Interface";e[e["Module"]=9]="Module";e[e["Property"]=10]="Property";e[e["Unit"]=11]="Unit";e[e["Value"]=12]="Value";e[e["Enum"]=13]="Enum";e[e["Keyword"]=14]="Keyword";e[e["Snippet"]=15]="Snippet";e[e["Color"]=16]="Color";e[e["File"]=17]="File";e[e["Reference"]=18]="Reference";e[e["Folder"]=19]="Folder";e[e["EnumMember"]=20]="EnumMember";e[e["Constant"]=21]="Constant";e[e["Struct"]=22]="Struct";e[e["Event"]=23]="Event";e[e["Operator"]=24]="Operator";e[e["TypeParameter"]=25]="TypeParameter"})(gt||(gt={}));var pt;(function(e){e[e["Text"]=1]="Text";e[e["Read"]=2]="Read";e[e["Write"]=3]="Write"})(pt||(pt={}));var _t;(function(e){e[e["Invoked"]=1]="Invoked";e[e["TriggerCharacter"]=2]="TriggerCharacter";e[e["TriggerForIncompleteCompletions"]=3]="TriggerForIncompleteCompletions"})(_t||(_t={}));var mt;(function(e){e[e["AutoInvoked"]=9999]="AutoInvoked"})(mt||(mt={}));var ft;(function(e){e["abap"]="ABAP";e["bat"]="Windows Bat";e["bibtex"]="BibTeX";e["clojure"]="Clojure";e["coffeescript"]="Coffeescript";e["c"]="C";e["cpp"]="C++";e["csharp"]="C#";e["css"]="CSS";e["diff"]="Diff";e["dart"]="Dart";e["dockerfile"]="Dockerfile";e["elixir"]="Elixir";e["erlang"]="Erlang";e["fsharp"]="F#";e["git-commit"]="Git (commit)";e["git-rebase"]="Git (rebase)";e["go"]="Go";e["groovy"]="Groovy";e["handlebars"]="Handlebars";e["html"]="HTML";e["ini"]="Ini";e["java"]="Java";e["javascript"]="JavaScript";e["javascriptreact"]="JavaScript React";e["json"]="JSON";e["latex"]="LaTeX";e["less"]="Less";e["lua"]="Lua";e["makefile"]="Makefile";e["markdown"]="Markdown";e["objective-c"]="Objective-C";e["objective-cpp"]="Objective-C++";e["perl"]="Perl";e["perl6"]="Perl 6";e["php"]="PHP";e["powershell"]="Powershell";e["jade"]="Pug";e["python"]="Python";e["r"]="R";e["razor"]="Razor (cshtml)";e["ruby"]="Ruby";e["rust"]="Rust";e["scss"]="SCSS (syntax using curly brackets)";e["sass"]="SCSS (indented syntax)";e["scala"]="Scala";e["shaderlab"]="ShaderLab";e["shellscript"]="Shell Script (Bash)";e["sql"]="SQL";e["swift"]="Swift";e["typescript"]="TypeScript";e["typescriptreact"]="TypeScript React";e["tex"]="TeX";e["vb"]="Visual Basic";e["xml"]="XML";e["xsl"]="XSL";e["yaml"]="YAML"})(ft||(ft={}));function vt(e){let t=[];for(let n of Object.keys(e)){t.push({textDocument:{uri:n},edits:e[n]})}return t}function At(e,t){return g(z.lsp_to_ce(e),t)}class wt{constructor(e){this.feature=e.feature;this.virtual_editor=e.virtual_editor;this.virtual_document=e.virtual_document;this.connection=e.connection;this.status_message=e.status_message;this.adapter=e.adapter;this.console=this.adapter.console.scope(e.feature.name);this.trans=e.trans;this.editor_handlers=new Map;this.connection_handlers=new Map;this.wrapper_handlers=new Map;this.is_registered=false}get settings(){return this.feature.settings}get lab_integration(){return this.feature.labIntegration}register(){for(let[e,t]of this.editor_handlers){this.virtual_editor.on(e,t)}for(let[e,t]of this.connection_handlers){this.connection.on(e,t)}this.wrapper=this.virtual_editor.getWrapperElement();for(let[e,t]of this.wrapper_handlers){this.wrapper.addEventListener(e,t)}this.is_registered=true}remove(){for(let[e,t]of this.editor_handlers){this.virtual_editor.off(e,t)}this.editor_handlers.clear();for(let[e,t]of this.connection_handlers){this.connection.off(e,t)}this.connection_handlers.clear();for(let[e,t]of this.wrapper_handlers){this.wrapper.removeEventListener(e,t)}this.wrapper_handlers.clear()}range_to_editor_range(e,t){let n=z.lsp_to_cm(e.start);let i=z.lsp_to_cm(e.end);if(t==null){let e=this.transform_virtual_position_to_root_position(n);let i=this.virtual_editor.get_editor_at_root_position(e);t=this.virtual_editor.ce_editor_to_cm_editor.get(i)}return{start:this.virtual_document.transform_virtual_to_editor(n),end:this.virtual_document.transform_virtual_to_editor(i),editor:t}}position_from_mouse(e){const t=this.virtual_editor.coordsChar({left:e.clientX,top:e.clientY},"window");if(t.line===-1&&t.ch===-1){return null}else{return t}}transform_virtual_position_to_root_position(e){let t=this.virtual_document.virtual_lines.get(e.line).editor;let n=this.virtual_document.transform_virtual_to_editor(e);return this.virtual_editor.transform_from_editor_to_root(t,n)}get_cm_editor(e){return this.virtual_editor.get_cm_editor(e)}get_language_at(e,t){return t.getModeAt(e).name}extract_last_character(e){if(e.origin==="paste"){let t=e.text[e.text.length-1];return t[t.length-1]}else{return e.text[0][0]}}highlight_range(e,t){return e.editor.getDoc().markText(e.start,e.end,{className:t})}is_whole_document_edit(e){let t=this.virtual_document.value;let n=t.split("\n");let i=e.range;let r=z.lsp_to_ce;return g(r(i.start),n)===0&&g(r(i.end),n)===t.length}async apply_edit(e){let t=this.virtual_document.document_info.uri;let n=e.documentChanges?e.documentChanges.map((e=>e)):vt(e.changes);let i=0;let r=0;let s=false;let o=[];for(let l of n){let e=l.textDocument.uri;if(!(0,F.Ei)(e,t)){o.push(`Workspace-wide edits not implemented: ${e} != ${t}`)}else{s=l.edits.length===1&&this.is_whole_document_edit(l.edits[0]);let e;if(!s){i=0;let t=this.virtual_document.value;let n=t.split("\n");let r=new Map;for(let e of l.edits){let t=At(e.range.start,n);if(r.has(t)){console.warn("Edits should not overlap, ignoring an overlapping edit")}else{r.set(t,e);i+=1}}let s=new F.Gl((()=>[]));let o="";let a=0;let c=0;let d=0;let u=[...r.keys()].sort(((e,t)=>e-t));for(let e of u){let i=r.get(e);let l=t.slice(a,e);for(let e=0;e<l.split("\n").length;e++){let e=s.get_or_create(c);e.push(d);c+=1;d+=1}o+=l+i.newText;let u=At(i.range.end,n);let h=t.slice(e,u);for(let e=0;e<i.newText.split("\n").length;e++){if(e<h.length){c+=1}d+=1;let t=s.get_or_create(c);t.push(d)}a=u}o+=t.slice(a,t.length);e={range:{start:{line:0,character:0},end:{line:n.length-1,character:n[n.length-1].length}},newText:o};console.assert(this.is_whole_document_edit(e))}else{e=l.edits[0];i+=1}r=this.apply_single_edit(e)}}const a=n.every((e=>e.edits.length===0));return{appliedChanges:i,modifiedCells:r,wasGranular:!s&&!a,errors:o}}replace_fragment(e,t,n,i,r,s,o=false){let a=this.virtual_document;let l=e.split("\n").slice(n.line-r.line,i.line-r.line).join("\n");if(l.endsWith("\n")){l=l.slice(0,-1)}let c=this.virtual_editor.ce_editor_to_cm_editor.get(t).getDoc();let d=c.getValue("\n");let{lines:u}=a.prepare_code_block({value:d,ce_editor:t});let h=u.join("\n");if(o){let t=z.cm_to_ce;let n=g(t(r),u);let i=g(t(s),u);l=h.slice(0,n)+e+h.slice(i)}if(h===l){return 0}let p=a.decode_code_block(l);let _=c.getCursor();c.replaceRange(p,{line:0,ch:0},{line:i.line-n.line+1,ch:0});try{c.setCursor(_,_.ch,{scroll:false})}catch(m){console.log("Could not place the cursor back",m)}return 1}afterChange(e,t){}apply_single_edit(e){let t=this.virtual_document;let n=0;let i=z.lsp_to_cm(e.range.start);let r=z.lsp_to_cm(e.range.end);let s=t.get_editor_at_virtual_line(i);let o=t.get_editor_at_virtual_line(r);if(s!==o){let o=s;let a=i;let l=Object.assign({},i);let c=i.line;let d=false;while(c<=r.line){c++;let s=t.get_editor_at_virtual_line({line:c,ch:0});if(s===o){l.line=c;l.ch=0;d=false}else{n+=this.replace_fragment(e.newText,o,a,l,i,r);d=true;a={line:c,ch:0};l={line:c,ch:0};o=s}}if(!d){n+=this.replace_fragment(e.newText,o,a,l,i,r)}}else{n+=this.replace_fragment(e.newText,s,i,r,i,r)}return n}}var bt;(function(e){function t(e){return typeof e==="string"}e.is=t})(bt||(bt={}));var yt;(function(e){function t(e){return typeof e==="string"}e.is=t})(yt||(yt={}));var Ct;(function(e){e.MIN_VALUE=-2147483648;e.MAX_VALUE=2147483647;function t(t){return typeof t==="number"&&e.MIN_VALUE<=t&&t<=e.MAX_VALUE}e.is=t})(Ct||(Ct={}));var Et;(function(e){e.MIN_VALUE=0;e.MAX_VALUE=2147483647;function t(t){return typeof t==="number"&&e.MIN_VALUE<=t&&t<=e.MAX_VALUE}e.is=t})(Et||(Et={}));var xt;(function(e){function t(e,t){if(e===Number.MAX_VALUE){e=Et.MAX_VALUE}if(t===Number.MAX_VALUE){t=Et.MAX_VALUE}return{line:e,character:t}}e.create=t;function n(e){var t=e;return Vn.objectLiteral(t)&&Vn.uinteger(t.line)&&Vn.uinteger(t.character)}e.is=n})(xt||(xt={}));var kt;(function(e){function t(e,t,n,i){if(Vn.uinteger(e)&&Vn.uinteger(t)&&Vn.uinteger(n)&&Vn.uinteger(i)){return{start:xt.create(e,t),end:xt.create(n,i)}}else if(xt.is(e)&&xt.is(t)){return{start:e,end:t}}else{throw new Error("Range#create called with invalid arguments[".concat(e,", ").concat(t,", ").concat(n,", ").concat(i,"]"))}}e.create=t;function n(e){var t=e;return Vn.objectLiteral(t)&&xt.is(t.start)&&xt.is(t.end)}e.is=n})(kt||(kt={}));var jt;(function(e){function t(e,t){return{uri:e,range:t}}e.create=t;function n(e){var t=e;return Vn.objectLiteral(t)&&kt.is(t.range)&&(Vn.string(t.uri)||Vn.undefined(t.uri))}e.is=n})(jt||(jt={}));var St;(function(e){function t(e,t,n,i){return{targetUri:e,targetRange:t,targetSelectionRange:n,originSelectionRange:i}}e.create=t;function n(e){var t=e;return Vn.objectLiteral(t)&&kt.is(t.targetRange)&&Vn.string(t.targetUri)&&kt.is(t.targetSelectionRange)&&(kt.is(t.originSelectionRange)||Vn.undefined(t.originSelectionRange))}e.is=n})(St||(St={}));var Mt;(function(e){function t(e,t,n,i){return{red:e,green:t,blue:n,alpha:i}}e.create=t;function n(e){var t=e;return Vn.objectLiteral(t)&&Vn.numberRange(t.red,0,1)&&Vn.numberRange(t.green,0,1)&&Vn.numberRange(t.blue,0,1)&&Vn.numberRange(t.alpha,0,1)}e.is=n})(Mt||(Mt={}));var It;(function(e){function t(e,t){return{range:e,color:t}}e.create=t;function n(e){var t=e;return Vn.objectLiteral(t)&&kt.is(t.range)&&Mt.is(t.color)}e.is=n})(It||(It={}));var Tt;(function(e){function t(e,t,n){return{label:e,textEdit:t,additionalTextEdits:n}}e.create=t;function n(e){var t=e;return Vn.objectLiteral(t)&&Vn.string(t.label)&&(Vn.undefined(t.textEdit)||Ft.is(t))&&(Vn.undefined(t.additionalTextEdits)||Vn.typedArray(t.additionalTextEdits,Ft.is))}e.is=n})(Tt||(Tt={}));var Lt;(function(e){e.Comment="comment";e.Imports="imports";e.Region="region"})(Lt||(Lt={}));var Bt;(function(e){function t(e,t,n,i,r,s){var o={startLine:e,endLine:t};if(Vn.defined(n)){o.startCharacter=n}if(Vn.defined(i)){o.endCharacter=i}if(Vn.defined(r)){o.kind=r}if(Vn.defined(s)){o.collapsedText=s}return o}e.create=t;function n(e){var t=e;return Vn.objectLiteral(t)&&Vn.uinteger(t.startLine)&&Vn.uinteger(t.startLine)&&(Vn.undefined(t.startCharacter)||Vn.uinteger(t.startCharacter))&&(Vn.undefined(t.endCharacter)||Vn.uinteger(t.endCharacter))&&(Vn.undefined(t.kind)||Vn.string(t.kind))}e.is=n})(Bt||(Bt={}));var Rt;(function(e){function t(e,t){return{location:e,message:t}}e.create=t;function n(e){var t=e;return Vn.defined(t)&&jt.is(t.location)&&Vn.string(t.message)}e.is=n})(Rt||(Rt={}));var Dt;(function(e){e.Error=1;e.Warning=2;e.Information=3;e.Hint=4})(Dt||(Dt={}));var Pt;(function(e){e.Unnecessary=1;e.Deprecated=2})(Pt||(Pt={}));var Ot;(function(e){function t(e){var t=e;return Vn.objectLiteral(t)&&Vn.string(t.href)}e.is=t})(Ot||(Ot={}));var zt;(function(e){function t(e,t,n,i,r,s){var o={range:e,message:t};if(Vn.defined(n)){o.severity=n}if(Vn.defined(i)){o.code=i}if(Vn.defined(r)){o.source=r}if(Vn.defined(s)){o.relatedInformation=s}return o}e.create=t;function n(e){var t;var n=e;return Vn.defined(n)&&kt.is(n.range)&&Vn.string(n.message)&&(Vn.number(n.severity)||Vn.undefined(n.severity))&&(Vn.integer(n.code)||Vn.string(n.code)||Vn.undefined(n.code))&&(Vn.undefined(n.codeDescription)||Vn.string((t=n.codeDescription)===null||t===void 0?void 0:t.href))&&(Vn.string(n.source)||Vn.undefined(n.source))&&(Vn.undefined(n.relatedInformation)||Vn.typedArray(n.relatedInformation,Rt.is))}e.is=n})(zt||(zt={}));var $t;(function(e){function t(e,t){var n=[];for(var i=2;i<arguments.length;i++){n[i-2]=arguments[i]}var r={title:e,command:t};if(Vn.defined(n)&&n.length>0){r.arguments=n}return r}e.create=t;function n(e){var t=e;return Vn.defined(t)&&Vn.string(t.title)&&Vn.string(t.command)}e.is=n})($t||($t={}));var Ft;(function(e){function t(e,t){return{range:e,newText:t}}e.replace=t;function n(e,t){return{range:{start:e,end:e},newText:t}}e.insert=n;function i(e){return{range:e,newText:""}}e.del=i;function r(e){var t=e;return Vn.objectLiteral(t)&&Vn.string(t.newText)&&kt.is(t.range)}e.is=r})(Ft||(Ft={}));var Ut;(function(e){function t(e,t,n){var i={label:e};if(t!==undefined){i.needsConfirmation=t}if(n!==undefined){i.description=n}return i}e.create=t;function n(e){var t=e;return Vn.objectLiteral(t)&&Vn.string(t.label)&&(Vn.boolean(t.needsConfirmation)||t.needsConfirmation===undefined)&&(Vn.string(t.description)||t.description===undefined)}e.is=n})(Ut||(Ut={}));var Nt;(function(e){function t(e){var t=e;return Vn.string(t)}e.is=t})(Nt||(Nt={}));var qt;(function(e){function t(e,t,n){return{range:e,newText:t,annotationId:n}}e.replace=t;function n(e,t,n){return{range:{start:e,end:e},newText:t,annotationId:n}}e.insert=n;function i(e,t){return{range:e,newText:"",annotationId:t}}e.del=i;function r(e){var t=e;return Ft.is(t)&&(Ut.is(t.annotationId)||Nt.is(t.annotationId))}e.is=r})(qt||(qt={}));var Wt;(function(e){function t(e,t){return{textDocument:e,edits:t}}e.create=t;function n(e){var t=e;return Vn.defined(t)&&en.is(t.textDocument)&&Array.isArray(t.edits)}e.is=n})(Wt||(Wt={}));var Ht;(function(e){function t(e,t,n){var i={kind:"create",uri:e};if(t!==undefined&&(t.overwrite!==undefined||t.ignoreIfExists!==undefined)){i.options=t}if(n!==undefined){i.annotationId=n}return i}e.create=t;function n(e){var t=e;return t&&t.kind==="create"&&Vn.string(t.uri)&&(t.options===undefined||(t.options.overwrite===undefined||Vn.boolean(t.options.overwrite))&&(t.options.ignoreIfExists===undefined||Vn.boolean(t.options.ignoreIfExists)))&&(t.annotationId===undefined||Nt.is(t.annotationId))}e.is=n})(Ht||(Ht={}));var Vt;(function(e){function t(e,t,n,i){var r={kind:"rename",oldUri:e,newUri:t};if(n!==undefined&&(n.overwrite!==undefined||n.ignoreIfExists!==undefined)){r.options=n}if(i!==undefined){r.annotationId=i}return r}e.create=t;function n(e){var t=e;return t&&t.kind==="rename"&&Vn.string(t.oldUri)&&Vn.string(t.newUri)&&(t.options===undefined||(t.options.overwrite===undefined||Vn.boolean(t.options.overwrite))&&(t.options.ignoreIfExists===undefined||Vn.boolean(t.options.ignoreIfExists)))&&(t.annotationId===undefined||Nt.is(t.annotationId))}e.is=n})(Vt||(Vt={}));var Kt;(function(e){function t(e,t,n){var i={kind:"delete",uri:e};if(t!==undefined&&(t.recursive!==undefined||t.ignoreIfNotExists!==undefined)){i.options=t}if(n!==undefined){i.annotationId=n}return i}e.create=t;function n(e){var t=e;return t&&t.kind==="delete"&&Vn.string(t.uri)&&(t.options===undefined||(t.options.recursive===undefined||Vn.boolean(t.options.recursive))&&(t.options.ignoreIfNotExists===undefined||Vn.boolean(t.options.ignoreIfNotExists)))&&(t.annotationId===undefined||Nt.is(t.annotationId))}e.is=n})(Kt||(Kt={}));var Zt;(function(e){function t(e){var t=e;return t&&(t.changes!==undefined||t.documentChanges!==undefined)&&(t.documentChanges===undefined||t.documentChanges.every((function(e){if(Vn.string(e.kind)){return Ht.is(e)||Vt.is(e)||Kt.is(e)}else{return Wt.is(e)}})))}e.is=t})(Zt||(Zt={}));var Gt=function(){function e(e,t){this.edits=e;this.changeAnnotations=t}e.prototype.insert=function(e,t,n){var i;var r;if(n===undefined){i=Ft.insert(e,t)}else if(Nt.is(n)){r=n;i=qt.insert(e,t,n)}else{this.assertChangeAnnotations(this.changeAnnotations);r=this.changeAnnotations.manage(n);i=qt.insert(e,t,r)}this.edits.push(i);if(r!==undefined){return r}};e.prototype.replace=function(e,t,n){var i;var r;if(n===undefined){i=Ft.replace(e,t)}else if(Nt.is(n)){r=n;i=qt.replace(e,t,n)}else{this.assertChangeAnnotations(this.changeAnnotations);r=this.changeAnnotations.manage(n);i=qt.replace(e,t,r)}this.edits.push(i);if(r!==undefined){return r}};e.prototype.delete=function(e,t){var n;var i;if(t===undefined){n=Ft.del(e)}else if(Nt.is(t)){i=t;n=qt.del(e,t)}else{this.assertChangeAnnotations(this.changeAnnotations);i=this.changeAnnotations.manage(t);n=qt.del(e,i)}this.edits.push(n);if(i!==undefined){return i}};e.prototype.add=function(e){this.edits.push(e)};e.prototype.all=function(){return this.edits};e.prototype.clear=function(){this.edits.splice(0,this.edits.length)};e.prototype.assertChangeAnnotations=function(e){if(e===undefined){throw new Error("Text edit change is not configured to manage change annotations.")}};return e}();var Yt=function(){function e(e){this._annotations=e===undefined?Object.create(null):e;this._counter=0;this._size=0}e.prototype.all=function(){return this._annotations};Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:false,configurable:true});e.prototype.manage=function(e,t){var n;if(Nt.is(e)){n=e}else{n=this.nextId();t=e}if(this._annotations[n]!==undefined){throw new Error("Id ".concat(n," is already in use."))}if(t===undefined){throw new Error("No annotation provided for id ".concat(n))}this._annotations[n]=t;this._size++;return n};e.prototype.nextId=function(){this._counter++;return this._counter.toString()};return e}();var Jt=function(){function e(e){var t=this;this._textEditChanges=Object.create(null);if(e!==undefined){this._workspaceEdit=e;if(e.documentChanges){this._changeAnnotations=new Yt(e.changeAnnotations);e.changeAnnotations=this._changeAnnotations.all();e.documentChanges.forEach((function(e){if(Wt.is(e)){var n=new Gt(e.edits,t._changeAnnotations);t._textEditChanges[e.textDocument.uri]=n}}))}else if(e.changes){Object.keys(e.changes).forEach((function(n){var i=new Gt(e.changes[n]);t._textEditChanges[n]=i}))}}else{this._workspaceEdit={}}}Object.defineProperty(e.prototype,"edit",{get:function(){this.initDocumentChanges();if(this._changeAnnotations!==undefined){if(this._changeAnnotations.size===0){this._workspaceEdit.changeAnnotations=undefined}else{this._workspaceEdit.changeAnnotations=this._changeAnnotations.all()}}return this._workspaceEdit},enumerable:false,configurable:true});e.prototype.getTextEditChange=function(e){if(en.is(e)){this.initDocumentChanges();if(this._workspaceEdit.documentChanges===undefined){throw new Error("Workspace edit is not configured for document changes.")}var t={uri:e.uri,version:e.version};var n=this._textEditChanges[t.uri];if(!n){var i=[];var r={textDocument:t,edits:i};this._workspaceEdit.documentChanges.push(r);n=new Gt(i,this._changeAnnotations);this._textEditChanges[t.uri]=n}return n}else{this.initChanges();if(this._workspaceEdit.changes===undefined){throw new Error("Workspace edit is not configured for normal text edit changes.")}var n=this._textEditChanges[e];if(!n){var i=[];this._workspaceEdit.changes[e]=i;n=new Gt(i);this._textEditChanges[e]=n}return n}};e.prototype.initDocumentChanges=function(){if(this._workspaceEdit.documentChanges===undefined&&this._workspaceEdit.changes===undefined){this._changeAnnotations=new Yt;this._workspaceEdit.documentChanges=[];this._workspaceEdit.changeAnnotations=this._changeAnnotations.all()}};e.prototype.initChanges=function(){if(this._workspaceEdit.documentChanges===undefined&&this._workspaceEdit.changes===undefined){this._workspaceEdit.changes=Object.create(null)}};e.prototype.createFile=function(e,t,n){this.initDocumentChanges();if(this._workspaceEdit.documentChanges===undefined){throw new Error("Workspace edit is not configured for document changes.")}var i;if(Ut.is(t)||Nt.is(t)){i=t}else{n=t}var r;var s;if(i===undefined){r=Ht.create(e,n)}else{s=Nt.is(i)?i:this._changeAnnotations.manage(i);r=Ht.create(e,n,s)}this._workspaceEdit.documentChanges.push(r);if(s!==undefined){return s}};e.prototype.renameFile=function(e,t,n,i){this.initDocumentChanges();if(this._workspaceEdit.documentChanges===undefined){throw new Error("Workspace edit is not configured for document changes.")}var r;if(Ut.is(n)||Nt.is(n)){r=n}else{i=n}var s;var o;if(r===undefined){s=Vt.create(e,t,i)}else{o=Nt.is(r)?r:this._changeAnnotations.manage(r);s=Vt.create(e,t,i,o)}this._workspaceEdit.documentChanges.push(s);if(o!==undefined){return o}};e.prototype.deleteFile=function(e,t,n){this.initDocumentChanges();if(this._workspaceEdit.documentChanges===undefined){throw new Error("Workspace edit is not configured for document changes.")}var i;if(Ut.is(t)||Nt.is(t)){i=t}else{n=t}var r;var s;if(i===undefined){r=Kt.create(e,n)}else{s=Nt.is(i)?i:this._changeAnnotations.manage(i);r=Kt.create(e,n,s)}this._workspaceEdit.documentChanges.push(r);if(s!==undefined){return s}};return e}();var Xt;(function(e){function t(e){return{uri:e}}e.create=t;function n(e){var t=e;return Vn.defined(t)&&Vn.string(t.uri)}e.is=n})(Xt||(Xt={}));var Qt;(function(e){function t(e,t){return{uri:e,version:t}}e.create=t;function n(e){var t=e;return Vn.defined(t)&&Vn.string(t.uri)&&Vn.integer(t.version)}e.is=n})(Qt||(Qt={}));var en;(function(e){function t(e,t){return{uri:e,version:t}}e.create=t;function n(e){var t=e;return Vn.defined(t)&&Vn.string(t.uri)&&(t.version===null||Vn.integer(t.version))}e.is=n})(en||(en={}));var tn;(function(e){function t(e,t,n,i){return{uri:e,languageId:t,version:n,text:i}}e.create=t;function n(e){var t=e;return Vn.defined(t)&&Vn.string(t.uri)&&Vn.string(t.languageId)&&Vn.integer(t.version)&&Vn.string(t.text)}e.is=n})(tn||(tn={}));var nn;(function(e){e.PlainText="plaintext";e.Markdown="markdown";function t(t){var n=t;return n===e.PlainText||n===e.Markdown}e.is=t})(nn||(nn={}));var rn;(function(e){function t(e){var t=e;return Vn.objectLiteral(e)&&nn.is(t.kind)&&Vn.string(t.value)}e.is=t})(rn||(rn={}));var sn;(function(e){e.Text=1;e.Method=2;e.Function=3;e.Constructor=4;e.Field=5;e.Variable=6;e.Class=7;e.Interface=8;e.Module=9;e.Property=10;e.Unit=11;e.Value=12;e.Enum=13;e.Keyword=14;e.Snippet=15;e.Color=16;e.File=17;e.Reference=18;e.Folder=19;e.EnumMember=20;e.Constant=21;e.Struct=22;e.Event=23;e.Operator=24;e.TypeParameter=25})(sn||(sn={}));var on;(function(e){e.PlainText=1;e.Snippet=2})(on||(on={}));var an;(function(e){e.Deprecated=1})(an||(an={}));var ln;(function(e){function t(e,t,n){return{newText:e,insert:t,replace:n}}e.create=t;function n(e){var t=e;return t&&Vn.string(t.newText)&&kt.is(t.insert)&&kt.is(t.replace)}e.is=n})(ln||(ln={}));var cn;(function(e){e.asIs=1;e.adjustIndentation=2})(cn||(cn={}));var dn;(function(e){function t(e){var t=e;return t&&(Vn.string(t.detail)||t.detail===undefined)&&(Vn.string(t.description)||t.description===undefined)}e.is=t})(dn||(dn={}));var un;(function(e){function t(e){return{label:e}}e.create=t})(un||(un={}));var hn;(function(e){function t(e,t){return{items:e?e:[],isIncomplete:!!t}}e.create=t})(hn||(hn={}));var gn;(function(e){function t(e){return e.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")}e.fromPlainText=t;function n(e){var t=e;return Vn.string(t)||Vn.objectLiteral(t)&&Vn.string(t.language)&&Vn.string(t.value)}e.is=n})(gn||(gn={}));var pn;(function(e){function t(e){var t=e;return!!t&&Vn.objectLiteral(t)&&(rn.is(t.contents)||gn.is(t.contents)||Vn.typedArray(t.contents,gn.is))&&(e.range===undefined||kt.is(e.range))}e.is=t})(pn||(pn={}));var _n;(function(e){function t(e,t){return t?{label:e,documentation:t}:{label:e}}e.create=t})(_n||(_n={}));var mn;(function(e){function t(e,t){var n=[];for(var i=2;i<arguments.length;i++){n[i-2]=arguments[i]}var r={label:e};if(Vn.defined(t)){r.documentation=t}if(Vn.defined(n)){r.parameters=n}else{r.parameters=[]}return r}e.create=t})(mn||(mn={}));var fn;(function(e){e.Text=1;e.Read=2;e.Write=3})(fn||(fn={}));var vn;(function(e){function t(e,t){var n={range:e};if(Vn.number(t)){n.kind=t}return n}e.create=t})(vn||(vn={}));var An;(function(e){e.File=1;e.Module=2;e.Namespace=3;e.Package=4;e.Class=5;e.Method=6;e.Property=7;e.Field=8;e.Constructor=9;e.Enum=10;e.Interface=11;e.Function=12;e.Variable=13;e.Constant=14;e.String=15;e.Number=16;e.Boolean=17;e.Array=18;e.Object=19;e.Key=20;e.Null=21;e.EnumMember=22;e.Struct=23;e.Event=24;e.Operator=25;e.TypeParameter=26})(An||(An={}));var wn;(function(e){e.Deprecated=1})(wn||(wn={}));var bn;(function(e){function t(e,t,n,i,r){var s={name:e,kind:t,location:{uri:i,range:n}};if(r){s.containerName=r}return s}e.create=t})(bn||(bn={}));var yn;(function(e){function t(e,t,n,i){return i!==undefined?{name:e,kind:t,location:{uri:n,range:i}}:{name:e,kind:t,location:{uri:n}}}e.create=t})(yn||(yn={}));var Cn;(function(e){function t(e,t,n,i,r,s){var o={name:e,detail:t,kind:n,range:i,selectionRange:r};if(s!==undefined){o.children=s}return o}e.create=t;function n(e){var t=e;return t&&Vn.string(t.name)&&Vn.number(t.kind)&&kt.is(t.range)&&kt.is(t.selectionRange)&&(t.detail===undefined||Vn.string(t.detail))&&(t.deprecated===undefined||Vn.boolean(t.deprecated))&&(t.children===undefined||Array.isArray(t.children))&&(t.tags===undefined||Array.isArray(t.tags))}e.is=n})(Cn||(Cn={}));var En;(function(e){e.Empty="";e.QuickFix="quickfix";e.Refactor="refactor";e.RefactorExtract="refactor.extract";e.RefactorInline="refactor.inline";e.RefactorRewrite="refactor.rewrite";e.Source="source";e.SourceOrganizeImports="source.organizeImports";e.SourceFixAll="source.fixAll"})(En||(En={}));var xn;(function(e){e.Invoked=1;e.Automatic=2})(xn||(xn={}));var kn;(function(e){function t(e,t,n){var i={diagnostics:e};if(t!==undefined&&t!==null){i.only=t}if(n!==undefined&&n!==null){i.triggerKind=n}return i}e.create=t;function n(e){var t=e;return Vn.defined(t)&&Vn.typedArray(t.diagnostics,zt.is)&&(t.only===undefined||Vn.typedArray(t.only,Vn.string))&&(t.triggerKind===undefined||t.triggerKind===xn.Invoked||t.triggerKind===xn.Automatic)}e.is=n})(kn||(kn={}));var jn;(function(e){function t(e,t,n){var i={title:e};var r=true;if(typeof t==="string"){r=false;i.kind=t}else if($t.is(t)){i.command=t}else{i.edit=t}if(r&&n!==undefined){i.kind=n}return i}e.create=t;function n(e){var t=e;return t&&Vn.string(t.title)&&(t.diagnostics===undefined||Vn.typedArray(t.diagnostics,zt.is))&&(t.kind===undefined||Vn.string(t.kind))&&(t.edit!==undefined||t.command!==undefined)&&(t.command===undefined||$t.is(t.command))&&(t.isPreferred===undefined||Vn.boolean(t.isPreferred))&&(t.edit===undefined||Zt.is(t.edit))}e.is=n})(jn||(jn={}));var Sn;(function(e){function t(e,t){var n={range:e};if(Vn.defined(t)){n.data=t}return n}e.create=t;function n(e){var t=e;return Vn.defined(t)&&kt.is(t.range)&&(Vn.undefined(t.command)||$t.is(t.command))}e.is=n})(Sn||(Sn={}));var Mn;(function(e){function t(e,t){return{tabSize:e,insertSpaces:t}}e.create=t;function n(e){var t=e;return Vn.defined(t)&&Vn.uinteger(t.tabSize)&&Vn.boolean(t.insertSpaces)}e.is=n})(Mn||(Mn={}));var In;(function(e){function t(e,t,n){return{range:e,target:t,data:n}}e.create=t;function n(e){var t=e;return Vn.defined(t)&&kt.is(t.range)&&(Vn.undefined(t.target)||Vn.string(t.target))}e.is=n})(In||(In={}));var Tn;(function(e){function t(e,t){return{range:e,parent:t}}e.create=t;function n(t){var n=t;return Vn.objectLiteral(n)&&kt.is(n.range)&&(n.parent===undefined||e.is(n.parent))}e.is=n})(Tn||(Tn={}));var Ln;(function(e){e["namespace"]="namespace";e["type"]="type";e["class"]="class";e["enum"]="enum";e["interface"]="interface";e["struct"]="struct";e["typeParameter"]="typeParameter";e["parameter"]="parameter";e["variable"]="variable";e["property"]="property";e["enumMember"]="enumMember";e["event"]="event";e["function"]="function";e["method"]="method";e["macro"]="macro";e["keyword"]="keyword";e["modifier"]="modifier";e["comment"]="comment";e["string"]="string";e["number"]="number";e["regexp"]="regexp";e["operator"]="operator";e["decorator"]="decorator"})(Ln||(Ln={}));var Bn;(function(e){e["declaration"]="declaration";e["definition"]="definition";e["readonly"]="readonly";e["static"]="static";e["deprecated"]="deprecated";e["abstract"]="abstract";e["async"]="async";e["modification"]="modification";e["documentation"]="documentation";e["defaultLibrary"]="defaultLibrary"})(Bn||(Bn={}));var Rn;(function(e){function t(e){var t=e;return Vn.objectLiteral(t)&&(t.resultId===undefined||typeof t.resultId==="string")&&Array.isArray(t.data)&&(t.data.length===0||typeof t.data[0]==="number")}e.is=t})(Rn||(Rn={}));var Dn;(function(e){function t(e,t){return{range:e,text:t}}e.create=t;function n(e){var t=e;return t!==undefined&&t!==null&&kt.is(t.range)&&Vn.string(t.text)}e.is=n})(Dn||(Dn={}));var Pn;(function(e){function t(e,t,n){return{range:e,variableName:t,caseSensitiveLookup:n}}e.create=t;function n(e){var t=e;return t!==undefined&&t!==null&&kt.is(t.range)&&Vn.boolean(t.caseSensitiveLookup)&&(Vn.string(t.variableName)||t.variableName===undefined)}e.is=n})(Pn||(Pn={}));var On;(function(e){function t(e,t){return{range:e,expression:t}}e.create=t;function n(e){var t=e;return t!==undefined&&t!==null&&kt.is(t.range)&&(Vn.string(t.expression)||t.expression===undefined)}e.is=n})(On||(On={}));var zn;(function(e){function t(e,t){return{frameId:e,stoppedLocation:t}}e.create=t;function n(e){var t=e;return Vn.defined(t)&&kt.is(e.stoppedLocation)}e.is=n})(zn||(zn={}));var $n;(function(e){e.Type=1;e.Parameter=2;function t(e){return e===1||e===2}e.is=t})($n||($n={}));var Fn;(function(e){function t(e){return{value:e}}e.create=t;function n(e){var t=e;return Vn.objectLiteral(t)&&(t.tooltip===undefined||Vn.string(t.tooltip)||rn.is(t.tooltip))&&(t.location===undefined||jt.is(t.location))&&(t.command===undefined||$t.is(t.command))}e.is=n})(Fn||(Fn={}));var Un;(function(e){function t(e,t,n){var i={position:e,label:t};if(n!==undefined){i.kind=n}return i}e.create=t;function n(e){var t=e;return Vn.objectLiteral(t)&&xt.is(t.position)&&(Vn.string(t.label)||Vn.typedArray(t.label,Fn.is))&&(t.kind===undefined||$n.is(t.kind))&&t.textEdits===undefined||Vn.typedArray(t.textEdits,Ft.is)&&(t.tooltip===undefined||Vn.string(t.tooltip)||rn.is(t.tooltip))&&(t.paddingLeft===undefined||Vn.boolean(t.paddingLeft))&&(t.paddingRight===undefined||Vn.boolean(t.paddingRight))}e.is=n})(Un||(Un={}));var Nn;(function(e){function t(e){var t=e;return Vn.objectLiteral(t)&&yt.is(t.uri)&&Vn.string(t.name)}e.is=t})(Nn||(Nn={}));var qn=null&&["\n","\r\n","\r"];var Wn;(function(e){function t(e,t,n,i){return new Hn(e,t,n,i)}e.create=t;function n(e){var t=e;return Vn.defined(t)&&Vn.string(t.uri)&&(Vn.undefined(t.languageId)||Vn.string(t.languageId))&&Vn.uinteger(t.lineCount)&&Vn.func(t.getText)&&Vn.func(t.positionAt)&&Vn.func(t.offsetAt)?true:false}e.is=n;function i(e,t){var n=e.getText();var i=r(t,(function(e,t){var n=e.range.start.line-t.range.start.line;if(n===0){return e.range.start.character-t.range.start.character}return n}));var s=n.length;for(var o=i.length-1;o>=0;o--){var a=i[o];var l=e.offsetAt(a.range.start);var c=e.offsetAt(a.range.end);if(c<=s){n=n.substring(0,l)+a.newText+n.substring(c,n.length)}else{throw new Error("Overlapping edit")}s=l}return n}e.applyEdits=i;function r(e,t){if(e.length<=1){return e}var n=e.length/2|0;var i=e.slice(0,n);var s=e.slice(n);r(i,t);r(s,t);var o=0;var a=0;var l=0;while(o<i.length&&a<s.length){var c=t(i[o],s[a]);if(c<=0){e[l++]=i[o++]}else{e[l++]=s[a++]}}while(o<i.length){e[l++]=i[o++]}while(a<s.length){e[l++]=s[a++]}return e}})(Wn||(Wn={}));var Hn=function(){function e(e,t,n,i){this._uri=e;this._languageId=t;this._version=n;this._content=i;this._lineOffsets=undefined}Object.defineProperty(e.prototype,"uri",{get:function(){return this._uri},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"languageId",{get:function(){return this._languageId},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"version",{get:function(){return this._version},enumerable:false,configurable:true});e.prototype.getText=function(e){if(e){var t=this.offsetAt(e.start);var n=this.offsetAt(e.end);return this._content.substring(t,n)}return this._content};e.prototype.update=function(e,t){this._content=e.text;this._version=t;this._lineOffsets=undefined};e.prototype.getLineOffsets=function(){if(this._lineOffsets===undefined){var e=[];var t=this._content;var n=true;for(var i=0;i<t.length;i++){if(n){e.push(i);n=false}var r=t.charAt(i);n=r==="\r"||r==="\n";if(r==="\r"&&i+1<t.length&&t.charAt(i+1)==="\n"){i++}}if(n&&t.length>0){e.push(t.length)}this._lineOffsets=e}return this._lineOffsets};e.prototype.positionAt=function(e){e=Math.max(Math.min(e,this._content.length),0);var t=this.getLineOffsets();var n=0,i=t.length;if(i===0){return xt.create(0,e)}while(n<i){var r=Math.floor((n+i)/2);if(t[r]>e){i=r}else{n=r+1}}var s=n-1;return xt.create(s,e-t[s])};e.prototype.offsetAt=function(e){var t=this.getLineOffsets();if(e.line>=t.length){return this._content.length}else if(e.line<0){return 0}var n=t[e.line];var i=e.line+1<t.length?t[e.line+1]:this._content.length;return Math.max(Math.min(n+e.character,i),n)};Object.defineProperty(e.prototype,"lineCount",{get:function(){return this.getLineOffsets().length},enumerable:false,configurable:true});return e}();var Vn;(function(e){var t=Object.prototype.toString;function n(e){return typeof e!=="undefined"}e.defined=n;function i(e){return typeof e==="undefined"}e.undefined=i;function r(e){return e===true||e===false}e.boolean=r;function s(e){return t.call(e)==="[object String]"}e.string=s;function o(e){return t.call(e)==="[object Number]"}e.number=o;function a(e,n,i){return t.call(e)==="[object Number]"&&n<=e&&e<=i}e.numberRange=a;function l(e){return t.call(e)==="[object Number]"&&-2147483648<=e&&e<=2147483647}e.integer=l;function c(e){return t.call(e)==="[object Number]"&&0<=e&&e<=2147483647}e.uinteger=c;function d(e){return t.call(e)==="[object Function]"}e.func=d;function u(e){return e!==null&&typeof e==="object"}e.objectLiteral=u;function h(e,t){return Array.isArray(e)&&e.every(t)}e.typedArray=h})(Vn||(Vn={}));class Kn{constructor(e,t,n,i,r){this.type=e;this.icon=t;this.match=n;this.connector=i;this.uri=r;this.label=n.label;this._setDocumentation(n.documentation);this._requested_resolution=false;this._resolved=false;this._detail=n.detail;this.self=this}get isDocumentationMarkdown(){return this._is_documentation_markdown}_setDocumentation(e){if(rn.is(e)){this._documentation=e.value;this._is_documentation_markdown=e.kind==="markdown"}else{this._documentation=e;this._is_documentation_markdown=false}}get insertText(){return this._currentInsertText||this.match.insertText||this.match.label}set insertText(e){this._currentInsertText=e}get sortText(){return this.match.sortText||this.match.label}get filterText(){return this.match.filterText}supportsResolution(){const e=this.connector.get_connection(this.uri);return e!=null&&e.isCompletionResolveProvider()}get detail(){return this._detail}needsResolution(){if(this.documentation){return false}if(this._resolved){return false}if(this._requested_resolution){return false}return this.supportsResolution()}isResolved(){return this._resolved}resolve(){if(this._resolved){return Promise.resolve(this)}if(!this.supportsResolution()){return Promise.resolve(this)}if(this._requested_resolution){return(0,F.EU)((()=>this._resolved),100,50).then((()=>this))}const e=this.connector.get_connection(this.uri);this._requested_resolution=true;return e.getCompletionResolve(this.match).then((e=>{if(e===null){return e}this._setDocumentation(e===null||e===void 0?void 0:e.documentation);this._detail=e===null||e===void 0?void 0:e.detail;this._resolved=true;return this}))}get documentation(){if(!this.connector.should_show_documentation){return undefined}if(this._documentation){return this._documentation}return undefined}get deprecated(){if(this.match.deprecated){return this.match.deprecated}return this.match.tags!=null&&this.match.tags.some((e=>e==an.Deprecated))}}var Zn=st.CompletionHandler.ICompletionItemsResponseType;class Gn{constructor(e){this.options=e;this.isDisposed=false;this.responseType=Zn;this._editor=e.editor;this._connections=e.connections;this.virtual_editor=e.virtual_editor;this._context_connector=new st.ContextConnector({editor:e.editor});if(e.session){let t={editor:e.editor,session:e.session};this._kernel_connector=new st.KernelConnector(t);this._kernel_and_context_connector=new st.CompletionConnector(t)}this.lab_integration=e.labIntegration;this.console=e.console}get kernel_completions_first(){return this.options.settings.composite.kernelCompletionsFirst}get use_lsp_completions(){return this.options.settings.composite.disableCompletionsFrom.indexOf("LSP")==-1}get use_kernel_completions(){return this.options.settings.composite.disableCompletionsFrom.indexOf("Kernel")==-1}get suppress_continuous_hinting_in(){return this.options.settings.composite.suppressContinuousHintingIn}get suppress_trigger_character_in(){return this.options.settings.composite.suppressTriggerCharacterIn}get should_show_documentation(){return this.options.settings.composite.showDocumentation}dispose(){if(this.isDisposed){return}this._connections=null;this.virtual_editor=null;this._context_connector=null;this._kernel_connector=null;this._kernel_and_context_connector=null;this.options=null;this._editor=null;this.isDisposed=true}get _has_kernel(){var e;return((e=this.options.session)===null||e===void 0?void 0:e.kernel)!=null}get _is_kernel_idle(){var e,t;return((t=(e=this.options.session)===null||e===void 0?void 0:e.kernel)===null||t===void 0?void 0:t.status)=="idle"}get _should_wait_for_busy_kernel(){return this.lab_integration.settings.composite.waitForBusyKernel}async _kernel_language(){return(await this.options.session.kernel.info).language_info.name}get _kernel_timeout(){return this.lab_integration.settings.composite.kernelResponseTimeout}get fallback_connector(){return this._kernel_and_context_connector?this._kernel_and_context_connector:this._context_connector}transform_from_editor_to_root(e){let t=z.ce_to_cm(e);return this.virtual_editor.transform_from_editor_to_root(this._editor,t)}async fetch(e){let t=this._editor;const n=t.getCursorPosition();const i=t.getTokenForPosition(n);if(this.trigger_kind==mt.AutoInvoked){if(i.type&&this.suppress_continuous_hinting_in.indexOf(i.type)!==-1){this.console.debug("Suppressing completer auto-invoke in",i.type);this.trigger_kind=_t.Invoked;return}}else if(this.trigger_kind==_t.TriggerCharacter){if(i.type&&this.suppress_trigger_character_in.indexOf(i.type)!==-1){this.console.debug("Suppressing completer auto-invoke in",i.type);this.trigger_kind=_t.Invoked;return}}const r=t.getPositionAt(i.offset);const s=t.getPositionAt(i.offset+i.value.length);let o=n.column-r.column-1;const a=i.value[n.column-r.column-1];let l=this.transform_from_editor_to_root(r);let c=this.transform_from_editor_to_root(s);let d=this.transform_from_editor_to_root(n);let u=this.virtual_editor;let h=u.document_at_root_position(l);let g=u.root_position_to_virtual_position(l);let p=u.root_position_to_virtual_position(c);let _=u.root_position_to_virtual_position(d);const m=this.use_lsp_completions?this.fetch_lsp(i,a,g,p,_,h,o):Promise.resolve(undefined);let f=null;try{const t=this._kernel_timeout;if(this.use_kernel_completions&&this._kernel_connector&&this._has_kernel&&(this._is_kernel_idle||this._should_wait_for_busy_kernel)&&t!=0){const n=await this._kernel_language();if(h.language.toLocaleLowerCase()===n.toLowerCase()){let n=this._kernel_connector.fetch(e);let i;if(t==-1){i=n}else{i=Promise.race([n,new Promise((e=>setTimeout((()=>e({start:0,end:0,matches:[],metadata:{}})),t)))])}f=Promise.all([i.catch((e=>e)),m.catch((e=>e))]).then((([e,t])=>{let n=[];if(e!=null){n.push(this.transform_reply(e))}if(t!=null){n.push(t)}return this.merge_replies(n,this._editor)}))}}if(!f){f=m.catch((t=>{this.console.warn("hint failed",t);return this.fallback_connector.fetch(e).then(this.transform_reply)}))}}catch(v){this.console.warn("kernel completions failed",v);f=this.fallback_connector.fetch(e).then(this.transform_reply)}this.console.debug("All promises set up and ready.");return f.then((e=>{e=this.suppress_if_needed(e,i,n);if(e){this.items=e.items}this.trigger_kind=_t.Invoked;return e}))}get_connection(e){return this._connections.get(e)}async fetch_lsp(e,t,n,i,r,s,o){let a=this.get_connection(s.uri);this.console.debug("Fetching");this.console.debug("Token:",e,n,i);const l=this.trigger_kind==mt.AutoInvoked?_t.Invoked:this.trigger_kind;let c=await a.getCompletion(r,{start:n,end:i,text:e.value},s.document_info,false,t,l)||[];this.console.debug("Transforming");let d=e.value.slice(0,o+1);let u=true;let h=[];c.forEach((t=>{let n=t.kind?gt[t.kind]:"";let i=t.insertText?t.insertText:t.label;if(i.toLowerCase().startsWith(d.toLowerCase())){u=false;if(d!==e.value){if(i.toLowerCase().startsWith(e.value.toLowerCase())){d=e.value}}}else if(e.type==="string"&&d.includes("/")){const e=d.split("/");if(i.toLowerCase().startsWith(e[e.length-1].toLowerCase())){let n=e.slice(0,-1).join("/")+"/";t.insertText=n+t.insertText;if(n.startsWith("'")||n.startsWith('"')){n=n.substr(1)}t.label=n+t.label;u=false}}let r=new Kn(n,this.icon_for(n),t,this,s.uri);h.push(r)}));this.console.debug("Transformed");let g=e.value.length;if(u&&g>d.length){g=d.length}let p={start:e.offset+(u?g:0),end:e.offset+d.length,items:h,source:{name:"LSP",priority:2}};if(p.start>p.end){console.warn("Response contains start beyond end; this should not happen!",p)}return p}icon_for(e){if(typeof e==="undefined"){e=at.OC}return this.options.themeManager.get_icon(e)||undefined}transform_reply(e){this.console.log("Transforming kernel reply:",e);let t;const n=e.metadata||{};const i=n._jupyter_types_experimental;if(i){t=i.map((e=>({label:e.text,insertText:e.text,type:e.type==="<unknown>"?undefined:e.type,icon:this.icon_for(e.type),sortText:this.kernel_completions_first?"a":"z"})))}else{t=e.matches.map((e=>({label:e,insertText:e,sortText:this.kernel_completions_first?"a":"z"})))}return{start:e.start,end:e.end,source:{name:"Kernel",priority:1,fallbackIcon:this.icon_for("Kernel")},items:t}}merge_replies(e,t){this.console.debug("Merging completions:",e);e=e.filter((e=>{if(e instanceof Error){this.console.warn(`Caught ${e.source.name} completions error`,e);return false}if(!e.items.length){return false}return true}));e.sort(((e,t)=>t.source.priority-e.source.priority));this.console.debug("Sorted replies:",e);const n=Math.min(...e.map((e=>e.end)));const i=Math.min(...e.map((e=>e.start)));const r=Math.max(...e.map((e=>e.start)));if(i!=r){const n=t.getCursorPosition();const i=t.getLine(n.line);if(i==null){this.console.warn(`Could not remove prefixes: line is undefined`,n.line)}else{e=e.map((e=>{if(e.start==r){return e}let t=i.substring(e.start,r);this.console.debug(`Removing ${e.source.name} prefix: `,t);return Object.assign(Object.assign({},e),{items:e.items.map((e=>{e.insertText=e.insertText.startsWith(t)?e.insertText.substr(t.length):e.insertText;return e}))})}))}}const s=new Set;const o=new Array;for(const a of e){a.items.forEach((e=>{let t=e.insertText.trim();if(s.has(t)){return}s.add(t);let n=e;if(a.source){n.source=a.source;if(!n.icon){n.icon=a.source.fallbackIcon}}o.push(n)}))}this.console.debug("Merged: ",o);return{start:r,end:n,source:null,items:o}}list(e){return Promise.resolve(undefined)}remove(e){return Promise.resolve(undefined)}save(e,t){return Promise.resolve(undefined)}suppress_if_needed(e,t,n){if(e==null){return e}if(!this._editor.hasFocus()){this.console.debug("Ignoring completion response: the corresponding editor lost focus");return{start:e.start,end:e.end,items:[]}}const i=this._editor.getCursorPosition();if(n.line!=i.line||i.column<n.column){this.console.debug("Ignoring completion response: cursor has receded or changed line");return{start:e.start,end:e.end,items:[]}}if(this.trigger_kind==mt.AutoInvoked){if(e.start==e.end||e.items.length===1&&e.items[0].insertText===t.value){return{start:e.start,end:e.end,items:[]}}}return e}}var Yn=n(54522);function Jn(e){let t=document.createElement("span");t.textContent=e;return t.innerHTML}class Xn extends st.CompleterModel{constructor(e={}){super();this.settings=Object.assign(Object.assign({},Xn.defaultOptions),e)}completionItems(){let e=this.query;this.query="";let t=super.completionItems();this.query=e;return this._sortAndFilter(e,t)}setCompletionItems(e){super.setCompletionItems(e);if(this.settings.preFilterMatches&&this.current&&this.cursor){const{start:e,end:t}=this.cursor;let n=this.current.text.substring(e,t).trim();if(n.startsWith('"')||n.startsWith("'")){n=n.substring(1)}if(n.endsWith('"')||n.endsWith("'")){n=n.substring(0,-1)}this.query=n}}_markFragment(e){return`<mark>${e}</mark>`}getFilterText(e){return this.getHighlightableLabelRegion(e)}getHighlightableLabelRegion(e){const t=e.label.indexOf("(");return t>-1?e.label.substring(0,t):e.label}_sortAndFilter(e,t){let n=[];for(let i of t){let t;let r=null;let s=null;let o=e.toLowerCase();if(e){r=this.getFilterText(i);if(this.settings.caseSensitive){s=Yn.StringExt.matchSumOfSquares(r,e)}else{s=Yn.StringExt.matchSumOfSquares(r.toLowerCase(),o)}t=!!s;if(!this.settings.includePerfectMatches){t=t&&r!=e}}else{t=true}if(t){let t=null;if(e){let n=Jn(this.getHighlightableLabelRegion(i));if(n==r){t=s}else{t=Yn.StringExt.matchSumOfSquares(n,e)}}let o;let a;if(t){let e=Yn.StringExt.highlight(Jn(i.label),t.indices,this._markFragment);o=e.join("");a=t.score}else{o=Jn(i.label);a=0}const l=Object.create(Object.getPrototypeOf(i),Object.getOwnPropertyDescriptors(i));l.label=o;l.insertText=i.insertText?i.insertText:i.label;n.push({item:l,score:a})}}n.sort(this.compareMatches);return n.map((e=>e.item))}compareMatches(e,t){var n,i,r;const s=e.score-t.score;if(s!==0){return s}return(r=(n=e.item.insertText)===null||n===void 0?void 0:n.localeCompare((i=t.item.insertText)!==null&&i!==void 0?i:""))!==null&&r!==void 0?r:0}}(function(e){e.defaultOptions={caseSensitive:true,includePerfectMatches:true,preFilterMatches:true}})(Xn||(Xn={}));class Qn extends Xn{getFilterText(e){if(e.filterText){return e.filterText}return super.getFilterText(e)}compareMatches(e,t){const n=e.score-t.score;if(n!==0){return n}return e.item.sortText.localeCompare(t.item.sortText)}}class ei extends st.Completer.Renderer{constructor(e){super();this.options=e;this.ITEM_PLACEHOLDER_CLASS="lsp-detail-placeholder";this.EXTRA_INFO_CLASS="jp-Completer-typeExtended";this.activeChanged=new S.Signal(this);this.itemShown=new S.Signal(this);this.elementToItem=new WeakMap;this.wasActivated=new WeakMap;this.visibilityObserver=new IntersectionObserver((e=>{e.forEach((e=>{if(!e.isIntersecting){return}let t=e.target;let n=this.elementToItem.get(t);this.itemShown.emit({item:n,element:t})}))}),{threshold:.25});this.activityObserver=new MutationObserver((e=>{e.forEach((e=>{let t=e.target;if(!(t instanceof HTMLLIElement)){return}let n=!this.wasActivated.get(t);if(t.classList.contains("jp-mod-active")){if(n){this.wasActivated.set(t,true);let e=this.elementToItem.get(t);this.activeChanged.emit({item:e,element:t})}}else{this.wasActivated.set(t,false)}}))}))}getExtraInfo(e){var t,n,i,r,s,o;const a=this.options.integrator.settings.composite.labelExtra;switch(a){case"detail":return(e===null||e===void 0?void 0:e.detail)||"";case"type":return(n=(t=e===null||e===void 0?void 0:e.type)===null||t===void 0?void 0:t.toLowerCase)===null||n===void 0?void 0:n.call(t);case"source":return(i=e===null||e===void 0?void 0:e.source)===null||i===void 0?void 0:i.name;case"auto":return[(e===null||e===void 0?void 0:e.detail)||"",(s=(r=e===null||e===void 0?void 0:e.type)===null||r===void 0?void 0:r.toLowerCase)===null||s===void 0?void 0:s.call(r),(o=e===null||e===void 0?void 0:e.source)===null||o===void 0?void 0:o.name].filter((e=>!!e))[0];default:this.options.console.warn("labelExtra does not match any of the expected values",a);return""}}updateExtraInfo(e,t){const n=this.getExtraInfo(e);if(n){const e=t.getElementsByClassName(this.EXTRA_INFO_CLASS)[0];e.textContent=n}}createCompletionItemNode(e,t){const n=super.createCompletionItemNode(e,t);const i=e.self;if(i){i.element=n;this.elementToItem.set(n,i);this.activityObserver.observe(n,{attributes:true,attributeFilter:["class"]});this.visibilityObserver.observe(n);this.updateExtraInfo(i,n)}else{this.updateExtraInfo(e,n)}return n}createDocumentationNode(e){if(e.isDocumentationMarkdown&&this.options.markdownRenderer){let t=e.documentation;this.options.markdownRenderer.renderModel({data:{"text/markdown":t},trusted:false,metadata:{},setData(e){}}).then((()=>{if(this.options.markdownRenderer&&this.options.latexTypesetter&&t&&t.includes("$")){this.options.latexTypesetter.typeset(this.options.markdownRenderer.node)}})).catch(this.options.console.warn);return this.options.markdownRenderer.node}else{let t=document.createElement("pre");if(e.documentation){t.textContent=e.documentation}return t}}}const ti=".jp-Completer-docpanel";const ni="lsp-completer-placeholder";class ii extends wt{get settings(){return super.settings}get completionCharacters(){if(this._completionCharacters==null||!this._completionCharacters.length){this._completionCharacters=this.connection.getLanguageCompletionCharacters()}return this._completionCharacters}afterChange(e){let t=this.extract_last_character(e);if(this.completionCharacters.indexOf(t)>-1){this.virtual_editor.console.log("Will invoke completer after",t);this.feature.labIntegration.invoke_completer(_t.TriggerCharacter).catch(this.console.warn);return}if(e.text&&e.text[0].length==1&&this.settings.composite.continuousHinting){this.feature.labIntegration.invoke_completer(mt.AutoInvoked).catch(this.console.warn)}}}class ri{constructor(e,t,n,i,r,s,o){this.app=e;this.completionManager=t;this.settings=n;this.adapterManager=i;this.completionThemeManager=r;this.console=s;this.renderMimeRegistry=o;this.current_adapter=null;this._latestActiveItem=null;const a=this.renderMimeRegistry.createRenderer("text/markdown");this.renderer=new ei({integrator:this,markdownRenderer:a,latexTypesetter:this.renderMimeRegistry.latexTypesetter,console:s.scope("renderer")});this.renderer.activeChanged.connect(this.active_completion_changed,this);this.renderer.itemShown.connect(this.resolve_and_update,this);n.ready.then((()=>{if(!n.composite.disable){i.adapterChanged.connect(this.swap_adapter,this)}})).catch(s.warn);n.changed.connect((()=>{r.set_theme(this.settings.composite.theme);r.set_icons_overrides(this.settings.composite.typesMap);if(!n.composite.disable){document.body.dataset.lspCompleterLayout=this.settings.composite.layout}if(this.current_completion_handler){this.model.settings.caseSensitive=this.settings.composite.caseSensitive;this.model.settings.includePerfectMatches=this.settings.composite.includePerfectMatches;this.model.settings.preFilterMatches=this.settings.composite.preFilterMatches}}))}fetchDocumentation(e){if(!e){return}e.resolve().then((t=>{if(e.self!==this._latestActiveItem.self){return}this.set_doc_panel_placeholder(false);if(t===null){return}this.refresh_doc_panel(e)})).catch((t=>{if(e.self===this._latestActiveItem.self){this.set_doc_panel_placeholder(false)}this.console.warn(t)}))}active_completion_changed(e,t){let{item:n}=t;this._latestActiveItem=n;if(!n.supportsResolution()){if(n.isDocumentationMarkdown){this.refresh_doc_panel(n)}return}if(n.needsResolution()){this.set_doc_panel_placeholder(true);this.fetchDocumentation(n)}else if(n.isResolved()){this.refresh_doc_panel(n)}else{this.fetchDocumentation(n)}const i=this.current_index;const r=this.current_items;if(i-1>=0){const e=r[i-1];this.resolve_and_update_from_item(e===null||e===void 0?void 0:e.self)}if(i+1<r.length){const e=r[i+1];this.resolve_and_update_from_item(e===null||e===void 0?void 0:e.self)}}resolve_and_update_from_item(e){if(!e){return}this.resolve_and_update(this.renderer,{item:e,element:e.element})}resolve_and_update(e,t){let{item:n,element:i}=t;if(!n.supportsResolution()){this.renderer.updateExtraInfo(n,i);return}if(n.isResolved()){this.renderer.updateExtraInfo(n,i)}else{n.resolve().then((e=>{this.renderer.updateExtraInfo(n,i)})).catch((e=>{this.console.warn(e)}))}}swap_adapter(e,t){if(this.current_adapter){this.current_adapter.activeEditorChanged.disconnect(this.set_connector,this);this.current_adapter.adapterConnected.disconnect(this.connect_completion,this)}this.current_adapter=t;if(this.current_adapter.isConnected){this.connect_completion(this.current_adapter);this.set_connector(t,{editor:t.activeEditor})}this.current_adapter.activeEditorChanged.connect(this.set_connector,this);this.current_adapter.adapterConnected.connect(this.connect_completion,this)}connect_completion(e,t){let n=e.activeEditor;if(n==null){return}this.set_completion_connector(e,n);this.current_completion_handler=this.completionManager.register({connector:this.current_completion_connector,editor:n,parent:e.widget},this.renderer);let i=this.completer;i.addClass("lsp-completer");i.model=new Qn({caseSensitive:this.settings.composite.caseSensitive,includePerfectMatches:this.settings.composite.includePerfectMatches,preFilterMatches:this.settings.composite.preFilterMatches})}get completer(){return this.current_completion_handler.completer}get model(){return this.completer.model}invoke_completer(e){let t;this.current_completion_connector.trigger_kind=e;if(this.adapterManager.currentAdapter instanceof fe){t="completer:invoke-notebook"}else{t="completer:invoke-file"}return this.app.commands.execute(t).catch((()=>{this.current_completion_connector.trigger_kind=_t.Invoked}))}set_connector(e,t){if(!this.current_completion_handler){this.connect_completion(e)}this.set_completion_connector(e,t.editor);this.current_completion_handler.editor=t.editor;this.current_completion_handler.connector=this.current_completion_connector}get current_items(){return this.model.completionItems()}get current_index(){let e=this.current_completion_handler.completer;return e._activeIndex}refresh_doc_panel(e){let t=this.current_completion_handler.completer;const n=this.current_items[this.current_index];if(!e||!n||n.insertText!=e.insertText){return}const i=t.node.querySelector(ti);if(!i){this.console.warn("Could not find completer panel to refresh");return}i.classList.remove(ni);if(e.documentation){i.textContent="";const t=this.renderer.createDocumentationNode(e);i.appendChild(t);i.setAttribute("style","")}else{i.setAttribute("style","display: none")}}set_doc_panel_placeholder(e){let t=this.current_completion_handler.completer;const n=t.node.querySelector(ti);if(!n){this.console.warn("Could not find completer panel for placeholder");return}if(e){n.setAttribute("style","");n.classList.add(ni)}else if(n.classList.contains(ni)){n.setAttribute("style","display: none");n.classList.remove(ni)}}set_completion_connector(e,t){var n,i;this.current_completion_connector=new Gn({editor:t,themeManager:this.completionThemeManager,connections:this.current_adapter.connection_manager.connections,virtual_editor:this.current_adapter.virtual_editor,settings:this.settings,labIntegration:this,session:(i=(n=this.current_adapter.widget)===null||n===void 0?void 0:n.sessionContext)===null||i===void 0?void 0:i.session,console:this.console})}}const si=new Ce.LabIcon({name:"lsp:completion",svgstr:lt});const oi=s+":completion";const ai={id:oi,requires:[o,y.ISettingRegistry,st.ICompletionManager,a,at.kZ,d,ot.IRenderMimeRegistry],autoStart:true,activate:(e,t,n,i,r,s,o,a)=>{const l=new ct(n,oi);const c=new ri(e,i,l,r,s,o.scope("CompletionLab"),a);t.register({feature:{editorIntegrationFactory:new Map([["CodeMirrorEditor",ii]]),id:oi,name:"LSP Completion",labIntegration:c,settings:l,capabilities:{textDocument:{completion:{dynamicRegistration:true,completionItem:{snippetSupport:false,commitCharactersSupport:true,documentationFormat:["markdown","plaintext"],deprecatedSupport:true,preselectSupport:false,tagSupport:{valueSet:[ht.Deprecated]}},contextSupport:false}}}}})}};var li=n(40746);const ci='<svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24">\n  <g class="jp-icon3 jp-icon-selectable" fill="#616161" shape-rendering="geometricPrecision">\n    <path d="M19 8c.56 0 1 .43 1 1a1 1 0 01-1 1c-.57 0-1-.45-1-1 0-.57.43-1 1-1M2 2v9c0 2.96 2.19 5.5 5.14 5.91.62 3.01 3.28 5.09 6.36 5.09a6.5 6.5 0 006.5-6.5v-3.69c1.16-.42 2-1.52 2-2.81a3 3 0 00-3-3 3 3 0 00-3 3c0 1.29.84 2.4 2 2.81v3.6c0 2.5-2 4.5-4.5 4.5-2 0-3.68-1.21-4.28-3.01C12 16.3 14 13.8 14 11V2h-4v3h2v6a4 4 0 01-4 4 4 4 0 01-4-4V5h2V2H2z"/>\n  </g>\n</svg>\n';var di=n(83881);var ui=n(32995);const hi='<svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24">\n  <g class="jp-icon3 jp-icon-selectable" fill="#616161" shape-rendering="geometricPrecision">\n    <path d="M12 14a2 2 0 012 2 2 2 0 01-2 2 2 2 0 01-2-2 2 2 0 012-2m11.46-5.14l-1.59 6.89L15 14.16l3.8-2.38A7.972 7.972 0 0012 8c-3.95 0-7.23 2.86-7.88 6.63l-1.97-.35C2.96 9.58 7.06 6 12 6c3.58 0 6.73 1.89 8.5 4.72l2.96-1.86z"/>\n  </g>\n</svg>\n';const gi=new Ce.LabIcon({name:"lsp:jump-to",svgstr:hi});const pi=new Ce.LabIcon({name:"lsp:jump-back",svgstr:hi.replace("jp-icon3","lsp-icon-flip-x jp-icon3")});const _i=s+":jump_to";let mi;class fi extends wt{get jumper(){return this.feature.labIntegration.jumper}get settings(){return super.settings}get modifierKey(){return this.settings.composite.modifierKey}register(){this.editor_handlers.set("mousedown",((e,t)=>{const{button:n}=t;if(n===0&&(0,F.nE)(t,this.modifierKey)){let n=this.position_from_mouse(t);if(n==null){this.console.warn("Could not retrieve root position from mouse event to jump to definition");return}let i=e.document_at_root_position(n);let r=e.root_position_to_virtual_position(n);this.connection.getDefinition(r,i.document_info,false).then((e=>{this.handle_jump(e,i.document_info.uri).catch(this.console.warn)})).catch(this.console.warn);t.preventDefault();t.stopPropagation()}}));super.register()}get_uri_and_range(e){if(e==null){return undefined}const t=Array.isArray(e)?e:[e];if(t.length===0){return undefined}this.console.log("Will jump to the first of suggested locations:",t);const n=t[0];if("targetUri"in n){return{uri:n.targetUri,range:n.targetRange}}else if("uri"in n){return{uri:n.uri,range:n.range}}else{this.console.warn("Returned jump location is incorrect (no uri or targetUri):",n);return undefined}}async handle_jump(e,t){const n=this.get_uri_and_range(e);if(!n){this.status_message.set(mi.__("No jump targets found"),2*1e3);return}let{uri:i,range:r}=n;let s=z.lsp_to_cm(r.start);if((0,F.Ei)(i,t)){let e=this.adapter.get_editor_index_at(s);let t=this.virtual_editor.transform_virtual_to_editor(s);if(t===null){this.console.warn("Could not jump: conversion from virtual position to editor position failed",s);return}let n=z.cm_to_ce(t);this.console.log(`Jumping to ${e}th editor of ${i}`);this.console.log("Jump target within editor:",n);let r=this.adapter.widget.context.path;this.jumper.global_jump({line:n.line,column:t.ch,editor_index:e,is_symlink:false,contents_path:r})}else{let e=z.cm_to_ce(s);this.console.log(`Jumping to external file: ${i}`);this.console.log("Jump target (source location):",e);let t={editor_index:0,line:e.line,column:e.column};let n=(0,F.lj)(i);if(n==null){if(i.startsWith("file://")){n=decodeURIComponent(i.slice(7))}else{n=decodeURIComponent(i)}}if(n===null){this.console.warn("contents_path could not be resolved");return}try{await this.jumper.document_manager.services.contents.get(n,{content:false});this.jumper.global_jump(Object.assign(Object.assign({contents_path:n},t),{is_symlink:false}));return}catch(o){this.console.warn(o)}this.jumper.global_jump(Object.assign(Object.assign({contents_path:$.URLExt.join(".lsp_symlink",n)},t),{is_symlink:true}))}}}class vi{constructor(e,t,n,i,r){this.settings=e;this.adapterManager=t;this.jumpers=new Map;if(r!==null){r.widgetAdded.connect(((e,t)=>{let n=t.content;if(n.editor instanceof di.CodeMirrorEditor){let e=new ui.FileEditorJumper(t,i);this.jumpers.set(t.id,e)}}))}n.widgetAdded.connect((async(e,t)=>{let n=new ui.NotebookJumper(t,i);this.jumpers.set(t.id,n)}))}get jumper(){let e=this.adapterManager.currentAdapter.widget.id;return this.jumpers.get(e)}}const Ai=e=>[{id:"jump-to-definition",execute:async({connection:e,virtual_position:t,document:n,features:i})=>{const r=i.get(_i);const s=await(e===null||e===void 0?void 0:e.getDefinition(t,n.document_info,false));await r.handle_jump(s,n.document_info.uri)},is_enabled:({connection:e})=>e?e.isDefinitionSupported():false,label:e.__("Jump to definition"),icon:gi},{id:"jump-back",execute:async({connection:e,virtual_position:t,document:n,features:i})=>{const r=i.get(_i);r.jumper.global_jump_back()},is_enabled:({connection:e})=>e?e.isDefinitionSupported():false,label:e.__("Jump back"),icon:pi,attach_to:new Set}];const wi={id:_i,requires:[o,y.ISettingRegistry,a,me.INotebookTracker,w.IDocumentManager,E.ITranslator],optional:[O.IEditorTracker],autoStart:true,activate:(e,t,n,i,r,s,o,a)=>{const l=new ct(n,_i);mi=o.load("jupyterlab-lsp");let c=new vi(l,i,r,s,a);t.register({feature:{editorIntegrationFactory:new Map([["CodeMirrorEditor",fi]]),commands:Ai(mi),id:_i,name:"Jump to definition",labIntegration:c,settings:l,capabilities:{textDocument:{declaration:{dynamicRegistration:true,linkSupport:true},definition:{dynamicRegistration:true,linkSupport:true},typeDefinition:{dynamicRegistration:true,linkSupport:true},implementation:{dynamicRegistration:true,linkSupport:true}}}}})}};var bi=n(2660);var yi={};yi.insert="head";yi.singleton=false;var Ci=I()(bi.Z,yi);const Ei=bi.Z.locals||{};const xi="lsp-diagnostics-listing";const ki="lsp-diagnostics-placeholder";class ji extends Map{get all(){return[].concat.apply([],this.values())}}class Si{constructor(e){this.options=e;this.is_visible=true}render_cell(e,t){return this.options.render_cell(e,t)}sort(e,t){return this.options.sort(e,t)}get id(){return this.options.id}is_available(e){if(this.options.is_available!=null){return this.options.is_available(e)}return true}render_header(e){return xe().createElement(Mi,{label:this.options.label,id:this.id,listing:e,key:this.id})}}function Mi(e){const t=e.id===e.listing.sort_key;const n=!t||e.listing.sort_direction===1?Ce.caretUpIcon:Ce.caretDownIcon;return xe().createElement("th",{key:e.id,onClick:()=>e.listing.sort(e.id),className:t?"lsp-sorted-header":undefined,"data-id":e.id},xe().createElement("div",null,xe().createElement("label",null,e.label),xe().createElement(n.react,{tag:"span",className:"lsp-sort-icon"})))}function Ii(e){let t=e.message;let n=""+e.code;if(e.code!=null&&e.code!==""&&t.startsWith(n+"")){return t.slice(n.length).trim()}return t}class Ti extends A.VDomRenderer{constructor(e){super(e);this.sort_key="Severity";this.sort_direction=1;const t=e.trans;this.trans=t;this.severityTranslations={Error:t.__("Error"),Warning:t.__("Warning"),Information:t.__("Information"),Hint:t.__("Hint")};this.columns=[new Si({id:"Virtual Document",label:this.trans.__("Virtual Document"),render_cell:(e,t)=>xe().createElement("td",{key:0},xe().createElement(qe,{document:e.document,adapter:t.adapter,trans:this.trans})),sort:(e,t)=>e.document.id_path.localeCompare(t.document.id_path),is_available:e=>e.db.size>1}),new Si({id:"Message",label:this.trans.__("Message"),render_cell:e=>{let t=Ii(e.data.diagnostic);return xe().createElement("td",{key:1},t)},sort:(e,t)=>e.data.diagnostic.message.localeCompare(t.data.diagnostic.message)}),new Si({id:"Code",label:this.trans.__("Code"),render_cell:e=>xe().createElement("td",{key:2},e.data.diagnostic.code),sort:(e,t)=>(e.data.diagnostic.code+"").localeCompare(t.data.diagnostic.source+"")}),new Si({id:"Severity",label:this.trans.__("Severity"),render_cell:e=>{const t=dt[e.data.diagnostic.severity||1];return xe().createElement("td",{key:3},this.severityTranslations[t]||t)},sort:(e,t)=>{if(!e.data.diagnostic.severity){return+1}if(!t.data.diagnostic.severity){return-1}return e.data.diagnostic.severity>t.data.diagnostic.severity?1:-1}}),new Si({id:"Source",label:this.trans.__("Source"),render_cell:e=>xe().createElement("td",{key:4},e.data.diagnostic.source),sort:(e,t)=>{if(!e.data.diagnostic.source){return+1}if(!t.data.diagnostic.source){return-1}return e.data.diagnostic.source.localeCompare(t.data.diagnostic.source)}}),new Si({id:"Cell",label:this.trans.__("Cell"),render_cell:e=>xe().createElement("td",{key:5},e.cell_number),sort:(e,t)=>e.cell_number-t.cell_number||e.data.range.start.line-t.data.range.start.line||e.data.range.start.ch-t.data.range.start.ch,is_available:e=>e.adapter.has_multiple_editors}),new Si({id:"Line:Ch",label:this.trans.__("Line:Ch"),render_cell:e=>xe().createElement("td",{key:6},e.data.range.start.line,":",e.data.range.start.ch),sort:(e,t)=>e.data.range.start.line-t.data.range.start.line||e.data.range.start.ch-t.data.range.start.ch})]}sort(e){if(e===this.sort_key){this.sort_direction=this.sort_direction*-1}else{this.sort_key=e;this.sort_direction=1}this.update()}render(){let e=this.model.diagnostics;const t=this.model.virtual_editor;const n=this.model.adapter;if(e==null||t==null||!n){return xe().createElement("div",{className:ki},this.trans.__("Diagnostics are not available"))}if(e.size===0){return xe().createElement("div",{className:ki},this.trans.__("No issues detected, great job!"))}let i=Array.from(e).map((([e,i])=>{if(e.isDisposed){return[]}return i.map(((i,r)=>{let s=null;if(n.has_multiple_editors){let{index:e}=t.find_editor(i.editor);s=e+1}return{data:i,key:e.uri+","+r,document:e,cell_number:s,editor:t}}))}));let r=[].concat.apply([],i);this._diagnostics=new Map(r.map((e=>[e.key,e])));let s=this.columns.filter((e=>e.id===this.sort_key))[0];let o=s.sort.bind(s);let a=r.sort(((e,t)=>o(e,t)*this.sort_direction));let l={db:e,editor:t,adapter:n};let c=this.columns.filter((e=>e.is_available(l)&&e.is_visible));let d=a.map((e=>{let t=c.map((t=>t.render_cell(e,l)));return xe().createElement("tr",{key:e.key,"data-key":e.key,onClick:()=>{this.jump_to(e)}},t)}));let u=c.map((e=>e.render_header(this)));return xe().createElement("table",{className:xi},xe().createElement("thead",null,xe().createElement("tr",null,u)),xe().createElement("tbody",null,d))}get_diagnostic(e){if(!this._diagnostics.has(e)){console.warn("Could not find the diagnostics row with key",e);return}return this._diagnostics.get(e)}jump_to(e){const t=e.data.editor;Ne(t.getWrapperElement());t.getDoc().setCursor(e.data.range.start);t.focus()}}(function(e){class t extends A.VDomModel{constructor(e){super();this.trans=e}}e.Model=t})(Ti||(Ti={}));const Li=new Ce.LabIcon({name:"lsp:diagnostics",svgstr:ci});const Bi="lsp-set-column-visibility";const Ri="lsp-jump-to-diagnostic";const Di="lsp-copy-diagnostic";const Pi="lsp-ignore-diagnostic-code";const Oi="lsp-ignore-diagnostic-message";function zi(e){return e.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}class $i{constructor(e){this._content=null;this._widget=null;this.is_registered=false;this.trans=e}get widget(){if(this._widget==null||this._widget.content.model==null){if(this._widget&&!this._widget.isDisposed){this._widget.dispose()}this._widget=this.initWidget()}return this._widget}get content(){return this.widget.content}initWidget(){this._content=new Ti(new Ti.Model(this.trans));this._content.model.diagnostics=new ji;this._content.addClass("lsp-diagnostics-panel-content");const e=new A.MainAreaWidget({content:this._content});e.id="lsp-diagnostics-panel";e.title.label=this.trans.__("Diagnostics Panel");e.title.closable=true;e.title.icon=Li;return e}update(){if(!this.widget.isAttached){return}this.widget.content.update()}register(e){const t=this.widget;let n=e=>{for(let n of t.content.columns){if(n.id===e){return n}}return undefined};let i=new li.Menu({commands:e.commands});i.title.label=this.trans.__("Panel columns");e.commands.addCommand(Bi,{execute:e=>{let i=n(e["id"]);i.is_visible=!i.is_visible;t.update()},label:e=>this.trans.__(e["id"]),isToggled:e=>{let t=n(e["id"]);return t?t.is_visible:false}});for(let o of t.content.columns){i.addItem({command:Bi,args:{id:o.id}})}e.contextMenu.addItem({selector:"."+xi+" th",submenu:i,type:"submenu"});let r=new li.Menu({commands:e.commands});r.title.label=this.trans.__("Ignore diagnostics like this");let s=()=>{let t=e.contextMenuHitTest((e=>e.tagName.toLowerCase()=="tr"));if(!t){return}return this.widget.content.get_diagnostic(t.dataset.key)};r.addItem({command:Pi});r.addItem({command:Oi});e.commands.addCommand(Pi,{execute:()=>{const e=s();if(!e){console.warn("LPS: diagnostics row not found for ignore code execute()");return}const t=e.data.diagnostic;let n=this.content.model.settings.composite.ignoreCodes;this.content.model.settings.set("ignoreCodes",[...n,t.code]);this.feature.refreshDiagnostics()},isVisible:()=>{const e=s();if(!e){return false}const t=e.data.diagnostic;return!!t.code},label:()=>{const e=s();if(!e){return""}const t=e.data.diagnostic;return this.trans.__('Ignore diagnostics with "%1" code',t.code)}});e.commands.addCommand(Oi,{execute:()=>{const e=s();if(!e){console.warn("LPS: diagnostics row not found for ignore message execute()");return}const t=e.data.diagnostic;let n=this.content.model.settings.composite.ignoreMessagesPatterns;this.content.model.settings.set("ignoreMessagesPatterns",[...n,zi(t.message)]);this.feature.refreshDiagnostics()},isVisible:()=>{const e=s();if(!e){return false}const t=e.data.diagnostic;return!!t.message},label:()=>{const e=s();if(!e){return""}const t=e.data.diagnostic;return this.trans.__('Ignore diagnostics with "%1" message',t.message)}});e.commands.addCommand(Ri,{execute:()=>{const e=s();if(!e){console.warn("LPS: diagnostics row not found for jump execute()");return}this.widget.content.jump_to(e)},label:this.trans.__("Jump to location"),icon:gi});e.commands.addCommand(Di,{execute:()=>{const e=s();if(!e){console.warn("LPS: diagnostics row not found for copy execute()");return}const t=e.data.diagnostic.message;navigator.clipboard.writeText(t).then((()=>{this.content.model.status_message.set(this.trans.__('Successfully copied "%1" to clipboard',t))})).catch((()=>{console.warn("Could not copy with clipboard.writeText interface, falling back");window.prompt(this.trans.__("Your browser protects clipboard from write operations; please copy the message manually"),t)}))},label:this.trans.__("Copy diagnostics' message"),icon:Ce.copyIcon});e.contextMenu.addItem({selector:"."+xi+" tbody tr",command:Di});e.contextMenu.addItem({selector:"."+xi+" tbody tr",command:Ri});e.contextMenu.addItem({selector:"."+xi+" tbody tr",submenu:r,type:"submenu"});this.is_registered=true}}const Fi=new $i(E.nullTranslator.load("jupyterlab_lsp"));const Ui=new WeakMap;class Ni extends wt{constructor(){super(...arguments);this.marked_diagnostics=new Map;this.switchDiagnosticsPanelSource=()=>{Fi.trans=this.adapter.trans;if(Fi.content.model.virtual_editor===this.virtual_editor&&Fi.content.model.diagnostics==this.diagnostics_db){return}Fi.content.model.diagnostics=this.diagnostics_db;Fi.content.model.virtual_editor=this.virtual_editor;Fi.content.model.adapter=this.adapter;Fi.content.model.settings=this.settings;Fi.content.model.status_message=this.status_message;Fi.feature=this;Fi.update()};this.handleDiagnostic=(e,t)=>{var n,i;if(!(0,F.Ei)(t.uri,(i=(n=this.virtual_document)===null||n===void 0?void 0:n.document_info)===null||i===void 0?void 0:i.uri)){return}if(this.virtual_document.last_virtual_line===0){return}try{this.last_response=t;this.setDiagnostics(t);Fi.update()}catch(r){this.console.warn(r)}}}get settings(){return super.settings}register(){this.connection.serverNotifications["textDocument/publishDiagnostics"].connect(this.handleDiagnostic);this.wrapper_handlers.set("focusin",this.switchDiagnosticsPanelSource);this.unique_editor_ids=new F.Gl((()=>this.unique_editor_ids.size));this.settings.changed.connect(this.refreshDiagnostics,this);this.adapter.adapterConnected.connect((()=>this.switchDiagnosticsPanelSource()));this.virtual_document.foreign_document_closed.connect(((e,t)=>{this.clearDocumentDiagnostics(t.foreign_document)}));super.register()}clearDocumentDiagnostics(e){this.diagnostics_db.set(e,[])}get diagnostics_db(){if(!Ui.has(this.virtual_editor)){Ui.set(this.virtual_editor,new ji)}return Ui.get(this.virtual_editor)}collapseOverlappingDiagnostics(e){const t=new Map;const n=new Map;function i(e){return e.start.line+","+e.start.character+","+e.end.line+","+e.end.character}e.forEach((e=>{let r=e.range;let s=i(r);t.set(s,r);if(n.has(s)){let t=n.get(s);t.push(e)}else{n.set(s,[e])}}));let r=new Map;n.forEach(((e,n)=>{let i=t.get(n);r.set(i,e)}));return r}get defaultSeverity(){return dt[this.settings.composite.defaultSeverity]}filterDiagnostics(e){const t=new Set(this.settings.composite.ignoreCodes);const n=this.settings.composite.ignoreMessagesPatterns.map((e=>new RegExp(e)));return e.filter((e=>{let i=e.code;if(typeof i!=="undefined"&&i!==null&&t.has(i.toString())){return false}let r=e.message;if(r&&n.some((e=>e.test(r)))){return false}return true}))}setDiagnostics(e){let t=[];const n=new Set;let i=this.collapseOverlappingDiagnostics(this.filterDiagnostics(e.diagnostics));i.forEach(((i,r)=>{const s=z.lsp_to_cm(r.start);const o=z.lsp_to_cm(r.end);const a=this.virtual_document.last_virtual_line-this.virtual_document.blank_lines_between_cells;if(s.line>a){this.console.log(`Out of range diagnostic (${s.line} line > ${a}) was skipped `,i);return}else{let e=this.virtual_document.last_line;if(s.line==a&&s.ch>e.length){this.console.log(`Out of range diagnostic (${s.ch} character > ${e.length} at line ${a}) was skipped `,i);return}}let l;try{let e=this.transform_virtual_position_to_root_position(s);l=this.virtual_editor.document_at_root_position(e)}catch(_){this.console.warn(`Could not place inspections from ${e.uri}`,` inspections: `,i,"error: ",_);return}if(this.virtual_document!==l){this.console.log(`Ignoring inspections from ${e.uri}`,` (this region is covered by a another virtual document: ${l.uri})`,` inspections: `,i);return}if(l.virtual_lines.get(s.line).skip_inspect.indexOf(l.id_path)!==-1){this.console.log("Ignoring inspections silenced for this document:",i);return}let c=l.get_editor_at_virtual_line(s);let d=this.virtual_editor.ce_editor_to_cm_editor.get(c);let u=l.transform_virtual_to_editor(s);let h;if(u===null){this.console.warn("Start in editor could not be be determined for",i);return}try{h=l.transform_virtual_to_editor(o)}catch(m){this.console.warn("Malformed range for diagnostic",o);h=Object.assign(Object.assign({},u),{ch:u.ch+1})}if(h===null){this.console.warn("End in editor could not be be determined for",i);return}let g={start:u,end:h};let p=JSON.stringify({diagnostics:i.map((e=>[e.severity,e.message,e.code,e.source,e.relatedInformation])),range:g,editor:this.unique_editor_ids.get(d)});for(let e of i){t.push({diagnostic:e,editor:d,range:g})}n.add(p);if(!this.marked_diagnostics.has(p)){const e=i.map((e=>e.severity||this.defaultSeverity)).sort()[0];const t=dt[e];const n=["cm-lsp-diagnostic","cm-lsp-diagnostic-"+t];const r=[];for(let a of i){if(a.tags){r.push(...a.tags)}}for(const i of new Set(r)){n.push("cm-lsp-diagnostic-tag-"+ut[i])}let s={title:i.map((e=>e.message+(e.source?" ("+e.source+")":""))).join("\n"),className:n.join(" ")};let o;try{o=d.getDoc().markText(u,h,s)}catch(_){this.console.warn("Marking inspection (diagnostic text) failed:",i,_);return}this.marked_diagnostics.set(p,o)}}));this.removeUnusedDiagnosticMarkers(n);this.diagnostics_db.set(this.virtual_document,t)}refreshDiagnostics(){if(this.last_response){this.setDiagnostics(this.last_response)}Fi.update()}removeUnusedDiagnosticMarkers(e){this.marked_diagnostics.forEach(((t,n)=>{if(!e.has(n)){this.marked_diagnostics.delete(n);t.clear()}}))}remove(){this.settings.changed.disconnect(this.refreshDiagnostics,this);this.removeUnusedDiagnosticMarkers(new Set);this.diagnostics_db.clear();Ui.delete(this.virtual_editor);this.unique_editor_ids.clear();if(Fi.content.model.virtual_editor===this.virtual_editor){Fi.content.model.virtual_editor=null;Fi.content.model.diagnostics=null;Fi.content.model.adapter=null}Fi.update();super.remove()}}const qi=s+":diagnostics";const Wi=e=>[{id:"show-diagnostics-panel",execute:({app:t,features:n,adapter:i})=>{let r=n.get(qi);r.switchDiagnosticsPanelSource();if(!Fi.is_registered){Fi.trans=e;Fi.register(t)}const s=Fi.widget;if(!s.isAttached){t.shell.add(s,"main",{ref:i.widget_id,mode:"split-bottom"})}t.shell.activateById(s.id)},is_enabled:e=>e.app.name!="JupyterLab Classic",label:e.__("Show diagnostics panel"),rank:3,icon:Li}];const Hi={id:qi,requires:[o,y.ISettingRegistry,E.ITranslator],autoStart:true,activate:(e,t,n,i)=>{const r=new ct(n,qi);const s=i.load("jupyterlab_lsp");t.register({feature:{editorIntegrationFactory:new Map([["CodeMirrorEditor",Ni]]),id:qi,capabilities:{textDocument:{publishDiagnostics:{tagSupport:{valueSet:[ut.Deprecated,ut.Unnecessary]}}}},name:"LSP Diagnostics",settings:r,commands:Wi(s)}})}};var Vi=n(6625);const Ki='<svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24">\n  <g class="jp-icon3 jp-icon-selectable" fill="#616161" shape-rendering="geometricPrecision">\n    <path d="M18.5 1.15c-.53 0-1.04.19-1.43.58l-5.81 5.82 5.65 5.65 5.82-5.81c.77-.78.77-2.04 0-2.83l-2.84-2.83c-.39-.39-.89-.58-1.39-.58M10.3 8.5l-5.96 5.96c-.78.78-.78 2.04.02 2.85C3.14 18.54 1.9 19.77.67 21h5.66l.86-.86c.78.76 2.03.75 2.81-.02l5.95-5.96M18 16v2h2v8h2v-8h2v-2h-6z"/>\n  </g>\n</svg>\n';const Zi='<svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24">\n  <g class="jp-icon3 jp-icon-selectable" fill="#616161" shape-rendering="geometricPrecision">\n    <path d="M18.5 1.15c-.53 0-1.04.19-1.43.58l-5.81 5.82 5.65 5.65 5.82-5.81c.77-.78.77-2.04 0-2.83l-2.84-2.83c-.39-.39-.89-.58-1.39-.58M10.3 8.5l-5.96 5.96c-.78.78-.78 2.04.02 2.85C3.14 18.54 1.9 19.77.67 21h5.66l.86-.86c.78.76 2.03.75 2.81-.02l5.95-5.96"/>\n  </g>\n</svg>\n';const Gi=new Ce.LabIcon({name:"lsp:highlight",svgstr:Zi});const Yi=new Ce.LabIcon({name:"lsp:highlight-type",svgstr:Ki});const Ji=e=>[{id:"highlight-references",execute:({connection:e,virtual_position:t,document:n})=>e===null||e===void 0?void 0:e.getReferences(t,n.document_info),is_enabled:({connection:e})=>e?e.isReferencesSupported():false,label:e.__("Highlight references"),icon:Gi},{id:"highlight-type-definition",execute:({connection:e,virtual_position:t,document:n})=>e===null||e===void 0?void 0:e.getTypeDefinition(t,n.document_info),is_enabled:({connection:e})=>e?e.isTypeDefinitionSupported():false,label:e.__("Highlight type definition"),icon:Yi}];class Xi extends wt{constructor(){super(...arguments);this.highlight_markers=[];this.last_token=null;this.onBlur=()=>{if(this.settings.composite.removeOnBlur){this.clear_markers();this.last_token=null}else{this.onCursorActivity().catch(console.warn)}};this.handleHighlight=e=>{this.clear_markers();if(!e){return}for(let t of e){let e=this.range_to_editor_range(t.range);let n=t.kind?"cm-lsp-highlight-"+pt[t.kind]:"";let i=this.highlight_range(e,"cm-lsp-highlight "+n);this.highlight_markers.push(i)}};this.on_cursor_activity=async()=>{this.sent_version=this.virtual_document.document_info.version;return await this.connection.getDocumentHighlights(this.virtual_position,this.virtual_document.document_info,false)};this.onCursorActivity=async()=>{var e,t;if(!((t=(e=this.virtual_editor)===null||e===void 0?void 0:e.virtual_document)===null||t===void 0?void 0:t.document_info)){return}let n;await this.virtual_editor.virtual_document.update_manager.update_done;try{n=this.virtual_editor.getDoc().getCursor("start")}catch(s){this.console.warn("no root position available");return}if(n==null){this.console.warn("no root position available");return}const i=this.virtual_editor.get_token_at(n);if(this.last_token&&i.value===this.last_token.value&&i.value!==""){this.console.log("not requesting highlights (token did not change)",i);return}let r;try{r=this.virtual_editor.document_at_root_position(n)}catch(o){this.console.warn("Could not obtain virtual document from position",n);return}if(r!==this.virtual_document){return}try{let e=this.virtual_editor.root_position_to_virtual_position(n);this.virtual_position=e;Promise.all([this.debounced_get_highlight.invoke(),async()=>{this.clear_markers();this.last_token=null}]).then((([t])=>{if(this.virtual_document.isDisposed){return}let n=this.virtual_document.document_info.version;if(n!==this.sent_version){this.console.log("skipping highlights response delayed by "+(n-this.sent_version)+" document versions");return}if(e!==this.virtual_position){this.console.log("skipping highlights response: cursor moved since it was requested");return}this.handleHighlight(t);this.last_token=i})).catch(this.console.warn)}catch(o){this.console.warn("Could not get highlights:",o)}}}get settings(){return super.settings}register(){this.debounced_get_highlight=this.create_debouncer();this.settings.changed.connect((()=>{this.debounced_get_highlight=this.create_debouncer()}));this.editor_handlers.set("cursorActivity",this.onCursorActivity);this.editor_handlers.set("blur",this.onBlur);this.editor_handlers.set("focus",this.onCursorActivity);super.register()}remove(){this.clear_markers();super.remove()}clear_markers(){for(let e of this.highlight_markers){e.clear()}this.highlight_markers=[]}create_debouncer(){return new Vi.Debouncer(this.on_cursor_activity,this.settings.composite.debouncerDelay)}}const Qi=s+":highlights";const er={id:Qi,requires:[o,y.ISettingRegistry,E.ITranslator],autoStart:true,activate:(e,t,n,i)=>{const r=new ct(n,Qi);const s=i.load("jupyterlab_lsp");t.register({feature:{editorIntegrationFactory:new Map([["CodeMirrorEditor",Xi]]),id:Qi,name:"LSP Highlights",settings:r,commands:Ji(s)}})}};const tr='<svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24">\n  <g class="jp-icon3 jp-icon-selectable" fill="#616161" shape-rendering="geometricPrecision">\n    <path d="M11 18h2v-2h-2v2m1-12a4 4 0 00-4 4h2a2 2 0 012-2 2 2 0 012 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5a4 4 0 00-4-4M5 3h14a2 2 0 012 2v14a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2z"/>\n  </g>\n</svg>\n';var nr=n(37034);const ir=20;const rr=250;const sr="lsp-tooltip";class or extends nr.Tooltip{constructor(e){super(e);this.options=e;this._setGeometry();const t=new ot.MimeModel({data:e.bundle});const n=this._content;n.renderModel(t).then((()=>this._setGeometry())).catch(console.warn)}handleEvent(e){if(this.isHidden||this.isDisposed){return}const{node:t}=this;const n=e.target;switch(e.type){case"keydown":{const i=e.keyCode;if(t.contains(n)||!this.options.hideOnKeyPress&&i!=27&&i!=8){return}this.dispose();break}default:super.handleEvent(e);break}}_setGeometry(){const e=this._editor;const t=this.options.position==null?e.getCursorPosition():this.options.position;const n=e.getOffsetAt(t);const i=e.getLine(t.line);if(!i){return}let r;switch(this.options.alignment){case"start":{const t=i.substring(0,n).split(/\W+/);const s=t[t.length-1];const o=s?n-s.length:n;r=e.getPositionAt(o);break}case"end":{const t=i.substring(0,n).split(/\W+/);const s=t[t.length-1];const o=s?n-s.length:n;r=e.getPositionAt(o);break}default:{r=t;break}}if(!r){return}const s=e.getCoordinateForPosition(r);const o=window.getComputedStyle(this.node);const a=parseInt(o.paddingLeft,10)||0;A.HoverBox.setGeometry({anchor:s,host:e.host,maxHeight:rr,minHeight:ir,node:this.node,offset:{horizontal:-1*a},privilege:this.options.privilege||"below",style:o})}}class ar{constructor(e){this.rendermime_registry=e;this.currentTooltip=null}create(e){this.remove();this.currentOptions=e;let{markup:t,position:n,adapter:i}=e;let r=i.widget;const s=t.kind==="plaintext"?{"text/plain":t.value}:{"text/markdown":t.value};const o=new or(Object.assign(Object.assign({},e.tooltip||{}),{anchor:r.content,bundle:s,editor:e.ce_editor,rendermime:this.rendermime_registry,position:z.cm_to_ce(n)}));o.addClass(sr);if(e.className){o.addClass(e.className)}li.Widget.attach(o,document.body);this.currentTooltip=o;return o}get position(){return this.currentOptions.position}isShown(e){var t;if(e&&this.currentOptions&&((t=this.currentOptions)===null||t===void 0?void 0:t.id)!==e){return false}return this.currentTooltip!==null&&!this.currentTooltip.isDisposed&&this.currentTooltip.isVisible}remove(){if(this.currentTooltip!==null){this.currentTooltip.dispose();this.currentTooltip=null}}}const lr=new Ce.LabIcon({name:"lsp:hover",svgstr:tr});function cr(e,t,n=50){const i=t.type==="mouseleave"?t.relatedTarget:t.target;if(e===i||e.contains(i)){return true}const r=e.getBoundingClientRect();return!(t.x<r.left-n||t.x>r.right+n||t.y<r.top-n||t.y>r.bottom+n)}class dr{constructor(e){this.maxSize=e;this._data=[]}get data(){return this._data}store(e){const t=this._data.findIndex((t=>t.document===e.document&&u(t.editor_range.start,e.editor_range.start)&&u(t.editor_range.end,e.editor_range.end)&&t.editor_range.editor===e.editor_range.editor));if(t!==-1){this._data[t]=e;return}if(this._data.length>=this.maxSize){this._data.shift()}this._data.push(e)}clean(){this._data=[]}}function ur(e){if(typeof e==="string"){return{kind:"markdown",value:e}}else{return{kind:"markdown",value:"```"+e.language+"\n"+e.value+"\n```"}}}class hr extends wt{constructor(e){super(e);this.last_hover_character=null;this.hover_marker=null;this._previousHoverRequest=null;this.onKeyDown=e=>{if((0,F.nE)(e,this.modifierKey)&&this.last_hover_character!==null){if(this.tooltip&&this.tooltip.isVisible&&!this.tooltip.isDisposed){return}const t=this.virtual_editor.document_at_root_position(this.last_hover_character);let n=this.restore_from_cache(t,this.virtual_position);if(n==null){return}e.stopPropagation();this.handleResponse(n,this.last_hover_character,true)}};this.onMouseLeave=e=>{this.remove_range_highlight();this.maybeHideTooltip(e)};this.on_hover=async()=>{var e;if(!(this.connection.isReady&&((e=this.connection.serverCapabilities)===null||e===void 0?void 0:e.hoverProvider))){return}let t=this.virtual_position;return await this.connection.clientRequests["textDocument/hover"].request({textDocument:{uri:this.virtual_document.document_info.uri},position:{line:t.line,character:t.ch}})};this.handleResponse=(e,t,n)=>{let i=e.response;if(this.last_hover_response!=i){this.remove_range_highlight();this.hover_marker=this.highlight_range(e.editor_range,"cm-lsp-hover-available")}this.last_hover_response=i;if(n){this.lab_integration.tooltip.remove();const n=hr.get_markup_for_hover(i);let r=this.virtual_editor.root_position_to_editor(t);this.tooltip=this.lab_integration.tooltip.create({markup:n,position:r,ce_editor:e.ce_editor,adapter:this.adapter,className:"lsp-hover"});return true}return false};this.updateUnderlineAndTooltip=e=>{try{return this._updateUnderlineAndTooltip(e)}catch(t){if(!(t.message==="Cell not found in cell_line_map"||t.message==="Cannot read property 'string' of undefined")){this.console.warn(t)}return undefined}};this.remove_range_highlight=()=>{if(this.hover_marker){this.hover_marker.clear();this.hover_marker=null;this.last_hover_response=null;this.last_hover_character=null}}}get modifierKey(){return this.settings.composite.modifierKey}get lab_integration(){return super.lab_integration}get settings(){return super.settings}restore_from_cache(e,t){const{line:n,ch:i}=t;const r=this.cache.data.filter((t=>{if(t.document!==e){return false}let r=t.response.range;return n>=r.start.line&&n<=r.end.line&&(n!=r.start.line||i>r.start.character)&&(n!=r.end.line||i<=r.end.character)}));if(r.length>1){this.console.warn("Potential hover cache malfunction: ",t,r)}return r.length!=0?r[0]:null}register(){this.cache=new dr(this.settings.composite.cacheSize);this.wrapper_handlers.set("mousemove",(e=>{var t;(t=this.updateUnderlineAndTooltip(e))===null||t===void 0?void 0:t.then((t=>{if(!t){this.maybeHideTooltip(e)}})).catch(this.console.warn)}));this.wrapper_handlers.set("mouseleave",this.onMouseLeave);this.wrapper_handlers.set("keydown",this.onKeyDown);this.editor_handlers.set("keydown",((e,t)=>this.onKeyDown(t)));this.debounced_get_hover=this.create_throttler();this.settings.changed.connect((()=>{this.cache.maxSize=this.settings.composite.cacheSize;this.debounced_get_hover=this.create_throttler()}));super.register()}maybeHideTooltip(e){if(typeof this.tooltip!=="undefined"&&!cr(this.tooltip.node,e)){this.tooltip.dispose()}}create_throttler(){return new Vi.Throttler(this.on_hover,{limit:this.settings.composite.throttlerDelay,edge:"trailing"})}afterChange(e,t){super.afterChange(e,t);this.cache.clean();this.last_hover_character=null;this.remove_range_highlight()}static get_markup_for_hover(e){let t=e.contents;if(typeof t==="string"){t=[t]}if(!Array.isArray(t)){return t}let n=t.map(ur);if(n.every((e=>e.kind=="plaintext"))){return{kind:"plaintext",value:n.map((e=>e.value)).join("\n")}}else{return{kind:"markdown",value:n.map((e=>e.value)).join("\n\n")}}}is_token_empty(e){return e.string.length===0}is_event_inside_visible(e){let t=e.target;return t.closest(".CodeMirror-sizer")!=null}is_useful_response(e){return e&&e.contents&&!(Array.isArray(e.contents)&&e.contents.length===0)}async _updateUnderlineAndTooltip(e){const t=e.target;if(t.classList.contains("CodeMirror-line")){this.remove_range_highlight();return false}const n=(0,F.nE)(e,this.modifierKey);let i=this.position_from_mouse(e);if(i==null){this.remove_range_highlight();return false}let r=this.virtual_editor.getTokenAt(i);let s=this.virtual_editor.document_at_root_position(i);if(this.is_token_empty(r)||s!==this.virtual_document||!this.is_event_inside_visible(e)){this.remove_range_highlight();return false}if(!this.last_hover_character||!u(i,this.last_hover_character)){let e=this.virtual_editor.root_position_to_virtual_position(i);this.virtual_position=e;this.last_hover_character=i;if(this._previousHoverRequest){await Promise.race([this._previousHoverRequest,new Promise((e=>setTimeout(e,1e3)))])}let t=this.restore_from_cache(s,e);if(t==null){const e=this.debounced_get_hover.invoke();this._previousHoverRequest=e;let n=await e;if(this._previousHoverRequest===e){this._previousHoverRequest=null}if(n&&this.is_useful_response(n)){let e=this.virtual_editor.get_editor_at_root_position(i);let o=this.virtual_editor.ce_editor_to_cm_editor.get(e);let a=this.get_editor_range(n,i,r,o);t={response:this.add_range_if_needed(n,a,e),document:s,editor_range:a,ce_editor:e};this.cache.store(t)}else{this.remove_range_highlight();return false}}return this.handleResponse(t,i,n)}else{return true}}remove(){this.cache.clean();this.remove_range_highlight();this.debounced_get_hover.dispose();super.remove()}get_editor_range(e,t,n,i){if(typeof e.range!=="undefined"){return this.range_to_editor_range(e.range,i)}let r={line:t.line,ch:n.start};let s={line:t.line,ch:n.end};return{start:this.virtual_editor.root_position_to_editor(r),end:this.virtual_editor.root_position_to_editor(s),editor:i}}add_range_if_needed(e,t,n){if(typeof e.range!=="undefined"){return e}return Object.assign(Object.assign({},e),{range:{start:z.cm_to_lsp(this.virtual_editor.root_position_to_virtual_position(this.virtual_editor.transform_from_editor_to_root(n,t.start))),end:z.cm_to_lsp(this.virtual_editor.root_position_to_virtual_position(this.virtual_editor.transform_from_editor_to_root(n,t.end)))}})}}class gr{constructor(e,t,n){this.tooltip=new ar(n)}}const pr=s+":hover";const _r={id:pr,requires:[o,y.ISettingRegistry,ot.IRenderMimeRegistry],autoStart:true,activate:(e,t,n,i)=>{const r=new ct(n,pr);const s=new gr(e,r,i);t.register({feature:{editorIntegrationFactory:new Map([["CodeMirrorEditor",hr]]),id:pr,name:"LSP Hover tooltip",labIntegration:s,settings:r,capabilities:{textDocument:{hover:{dynamicRegistration:true,contentFormat:["markdown","plaintext"]}}}}})}};const mr='<svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24">\n  <g class="jp-icon3 jp-icon-selectable" fill="#616161" shape-rendering="geometricPrecision">\n    <path d="M17 7h5v10h-5v2a1 1 0 001 1h2v2h-2.5c-.55 0-1.5-.45-1.5-1 0 .55-.95 1-1.5 1H12v-2h2a1 1 0 001-1V5a1 1 0 00-1-1h-2V2h2.5c.55 0 1.5.45 1.5 1 0-.55.95-1 1.5-1H20v2h-2a1 1 0 00-1 1v2M2 7h11v2H4v6h9v2H2V7m18 8V9h-3v6h3z"/>\n  </g>\n</svg>\n';const fr=new Ce.LabIcon({name:"lsp:rename",svgstr:mr});const vr=s+":rename";const Ar=e=>[{id:"rename-symbol",execute:async({editor:t,connection:n,virtual_position:i,document:r,features:s})=>{const o=s.get(vr);o.setTrans(e);let a=o.transform_virtual_position_to_root_position(i);let l=t.get_token_at(a).value;let c=n=>{let i="";if(s.has(qi)){let e=s.get(qi);i=wr.ux_workaround_for_rope_limitation(n,e,t,o)}if(!i){i=e.__(`Rename failed: %1`,n)}o.setStatus(i,7.5*1e3)};const d=await A.InputDialog.getText({title:e.__("Rename to"),text:l,okLabel:e.__("Rename"),cancelLabel:e.__("Cancel")});try{const t=d.value;if(d.button.accept!=true||t==null){return}o.setStatus(e.__("Renaming %1 to %2...",l,t),2*1e3);const s=await(n===null||n===void 0?void 0:n.rename(i,r.document_info,t,false));if(s){await o.handleRename(s,l,t)}else{c(new Error("no edit from server"))}}catch(u){c(u)}},is_enabled:({connection:e})=>e?e.provides("renameProvider"):false,label:e.__("Rename symbol"),icon:fr}];class wr extends wt{setTrans(e){this.trans=e}setStatus(e,t){return this.status_message.set(e,t)}async handleRename(e,t,n){let i;try{i=await this.apply_edit(e)}catch(r){this.status_message.set(this.trans.__("Rename failed: %1",r));return}try{let e;const r=this.trans.__("%1 to %2",t,n);if(i.appliedChanges===0){e=this.trans.__("Could not rename %1 - consult the language server documentation",r)}else if(i.wasGranular){e=this.trans._n("Renamed %2 in %3 place","Renamed %2 in %3 places",i.appliedChanges,r,i.appliedChanges)}else if(this.adapter.has_multiple_editors){e=this.trans._n("Renamed %2 in %3 cell","Renamed %2 in %3 cells",i.modifiedCells,r,i.modifiedCells)}else{e=this.trans.__("Renamed %1",r)}if(i.errors.length!==0){e+=this.trans.__(" with errors: %1",i.errors)}this.status_message.set(e,5*1e3)}catch(r){this.console.warn(r)}return i}static ux_workaround_for_rope_limitation(e,t,n,i){let r=false;try{r=e.message.includes("IndexError")}catch(a){return null}if(!r){return null}let s=(t.diagnostics_db.all||[]).filter((e=>e.diagnostic.message.includes("invalid syntax")||e.diagnostic.message.includes("SyntaxError")||e.diagnostic.message.includes("IndentationError")));if(s.length===0){return null}let o=[...new Set(s.map((e=>{let t=e.diagnostic.message;let r=e.range.start;if(i.adapter.has_multiple_editors){let{index:s}=n.find_editor(e.editor);let o=s+1;return i.trans.__("%1 in cell %2 at line %3",t,o,r.line)}else{return i.trans.__("%1 at line %2",t,r.line)}})))].join(", ");return i.trans.__("Syntax error(s) prevent rename: %1",o)}}const br={id:vr,requires:[o,y.ISettingRegistry,E.ITranslator],autoStart:true,activate:(e,t,n,i)=>{const r=(i||E.nullTranslator).load("jupyterlab_lsp");const s=new ct(n,vr);t.register({feature:{editorIntegrationFactory:new Map([["CodeMirrorEditor",wr]]),id:vr,name:"LSP Rename",settings:s,commands:Ar(r)}})}};const yr="signature";const Cr="lsp-signature-help";function Er(e){if(typeof e==="string"){return(0,F.ry)(e)}else{if(e.kind==="markdown"){return e.value}else{return(0,F.ry)(e.value)}}}function xr(e,t){const n=[];let i=false;for(const s of e.slice(0,t+1)){const e=s.trim()=="";if(e){i=true;break}n.push(s)}const r=n.join("\n");if(i&&r.search(/[\\*#[\]<>_]/g)===-1){return{lead:r,remainder:e.slice(n.length+1).join("\n")}}return null}function kr(e,t="",n,i,r,s=4){const o=typeof e.activeParameter!=="undefined"?e.activeParameter:r;let a;let l=e.label;if(e.parameters&&o!=null){if(o>e.parameters.length){i.error("LSP server returned wrong number for activeSignature for: ",e);a="```"+t+"\n"+l+"\n```"}else{const i=e.parameters[o];let r=typeof i.label==="string"?i.label:l.slice(i.label[0],i.label[1]);a=n(l,r,t)}}else{a="```"+t+"\n"+l+"\n```"}let c="";if(e.documentation){if(typeof e.documentation==="string"||e.documentation.kind==="plaintext"){const t=typeof e.documentation==="string"?e.documentation:e.documentation.value;for(let n of t.split("\n")){if(n.trim()===e.label.trim()){continue}c+=Er(n)+"\n"}}else{if(e.documentation.kind!=="markdown"){i.warn("Unknown MarkupContent kind:",e.documentation.kind)}c+=e.documentation.value}}else if(e.parameters){c+="\n\n"+e.parameters.filter((e=>e.documentation)).map((e=>"- "+Er(e.documentation))).join("\n")}if(c){const e=c.trim().split("\n");if(e.length>s){const t=xr(e,s);if(t){c=t.lead+"\n<details>\n"+t.remainder+"\n</details>"}else{c="<details>\n"+c+"\n</details>"}}a+="\n\n"+c}else{a+="\n"}return a}class jr extends wt{get settings(){return super.settings}get _closeCharacters(){if(!this.settings){return[]}return this.settings.composite.closeCharacters}register(){this.editor_handlers.set("cursorActivity",this.onCursorActivity.bind(this));this.editor_handlers.set("blur",this.onBlur.bind(this));this.editor_handlers.set("focus",this.onCursorActivity.bind(this));super.register()}onBlur(e,t){if(this.isSignatureShown()&&t.relatedTarget.closest("."+Cr)===null){this._hideTooltip()}}onCursorActivity(){var e;if(!this.isSignatureShown()){return}const t=this.virtual_editor.get_cursor_position();const n=this.lab_integration.tooltip.position;let i=this.virtual_editor.root_position_to_editor(t);if(i.line===n.line&&i.ch<n.ch){this._hideTooltip()}else{(e=this.requestSignature(t,n))===null||e===void 0?void 0:e.catch(this.console.warn)}}get lab_integration(){return super.lab_integration}get_markup_for_signature_help(e,t=""){let n=new Array;if(e.activeSignature!=null){if(e.activeSignature>=e.signatures.length){this.console.error("LSP server returned wrong number for activeSignature for: ",e)}else{const n=e.signatures[e.activeSignature];return{kind:"markdown",value:this.signatureToMarkdown(n,t,e.activeParameter)}}}e.signatures.forEach((e=>{let i=this.signatureToMarkdown(e,t);n.push(i)}));return{kind:"markdown",value:n.join("\n\n")}}highlightCode(e,t,n){const i=document.createElement("pre");const r=document.createElement("code");i.appendChild(r);r.className=`cm-s-jupyter language-${n}`;this.lab_integration.codeMirror.CodeMirror.runMode(e,n,((e,n)=>{let i;if(n){i=document.createElement("span");i.classList.add("cm-"+n);i.textContent=e}else{i=document.createTextNode(e)}if(n==="variable"&&e===t){const e=document.createElement("mark");e.appendChild(i);i=e}r.appendChild(i)}));return i.outerHTML}signatureToMarkdown(e,t,n){return kr(e,t,this.highlightCode.bind(this),this.console,n,this.settings.composite.maxLines)}_hideTooltip(){this.lab_integration.tooltip.remove()}handleSignature(e,t,n=null){this.console.log("Signature received",e);if(e||e===null){this._hideTooltip()}if(!this.signatureCharacter||!e||!e.signatures.length){this.console.debug("Ignoring signature response: cursor lost or response empty");return}let i=this.virtual_editor.get_cursor_position();if(t.line!=i.line||i.ch<t.ch){this.console.debug("Ignoring signature response: cursor has receded or changed line")}let r=this.get_cm_editor(i);if(!r.hasFocus()){this.console.debug("Ignoring signature response: the corresponding editor lost focus");return}let s=this.virtual_editor.root_position_to_editor(i);let o=this.get_language_at(s,r);let a=this.get_markup_for_signature_help(e,o);this.console.log("Signature will be shown",o,a,i,e);this.lab_integration.tooltip.create({markup:a,position:n===null?s:n,id:yr,ce_editor:this.virtual_editor.find_ce_editor(r),adapter:this.adapter,className:Cr,tooltip:{privilege:"forceAbove",alignment:"start",hideOnKeyPress:false}})}get signatureCharacters(){var e;if(!((e=this._signatureCharacters)===null||e===void 0?void 0:e.length)){this._signatureCharacters=this.connection.getLanguageSignatureCharacters()}return this._signatureCharacters}isSignatureShown(){return this.lab_integration.tooltip.isShown(yr)}afterChange(e,t){var n;let i=this.extract_last_character(e);const r=this.isSignatureShown();let s=null;if(r){s=this.lab_integration.tooltip.position;if(this._closeCharacters.includes(i)){this._hideTooltip()}}if(!(this.signatureCharacters.includes(i)||r)){return}(n=this.requestSignature(t,s))===null||n===void 0?void 0:n.catch(this.console.warn)}requestSignature(e,t){var n;if(!(this.connection.isReady&&((n=this.connection.serverCapabilities)===null||n===void 0?void 0:n.signatureHelpProvider))){return}this.signatureCharacter=e;let i=this.virtual_editor.root_position_to_virtual_position(e);return this.connection.clientRequests["textDocument/signatureHelp"].request({position:{line:i.line,character:i.ch},textDocument:{uri:this.virtual_document.document_info.uri}}).then((n=>this.handleSignature(n,e,t)))}}class Sr{constructor(e,t,n,i){this.codeMirror=i;this.tooltip=new ar(n)}}const Mr=s+":signature";const Ir={id:Mr,requires:[o,y.ISettingRegistry,ot.IRenderMimeRegistry,di.ICodeMirror],autoStart:true,activate:(e,t,n,i,r)=>{const s=new ct(n,Mr);const o=new Sr(e,s,i,r);t.register({feature:{editorIntegrationFactory:new Map([["CodeMirrorEditor",jr]]),id:Mr,name:"LSP Function signature",labIntegration:o,settings:s,capabilities:{textDocument:{signatureHelp:{dynamicRegistration:true,signatureInformation:{documentationFormat:["markdown","plaintext"]}}}}}})}};var Tr=n(36038);const Lr='<svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24">\n  <g class="jp-icon3 jp-icon-selectable" fill="#616161" shape-rendering="geometricPrecision">\n    <path d="M10.48 10.88l3.68-3.68-3.68-3.68L11.6 2.4l4.8 4.8-4.8 4.8-1.12-1.12m-4.16 0L2.64 7.2l3.68-3.68L5.2 2.4.4 7.2 5.2 12l1.12-1.12zM8.5 23.8l2.337-2.338-.025-.017a1.283 1.283 0 010-1.802l4.029-4.029 3.604 3.604-4.029 4.03a1.267 1.267 0 01-1.776.017l-.536.535H8.5m10.124-11.976a1.283 1.283 0 011.802 0l1.81 1.802a1.293 1.293 0 010 1.81l-2.805 2.796-3.604-3.604 2.797-2.805z"/>\n  </g>\n</svg>\n';const Br=new Ce.LabIcon({name:"lsp:syntax-highlighting",svgstr:Lr});const Rr=s+":syntax_highlighting";class Dr extends wt{constructor(e){super(e);this.virtual_document.changed.connect(this.update_mode.bind(this),this);this.editors_with_active_highlight=new Set}get lab_integration(){return super.lab_integration}get settings(){return super.settings}get_mode(e){let t=this.lab_integration.mimeTypeService.getMimeTypeByLanguage({name:e});if(!t||t=="text/plain"){return}return this.lab_integration.codeMirror.CodeMirror.findModeByMIME(t)}update_mode(){let e=this.virtual_document;let t=new Set;for(let n of e.foreign_document_maps){for(let[e,i]of n.entries()){let n=i.editor;let r=n.editor;let s=r.getValue("\n");let o=s.concat("").length;let a=n.getOffsetAt(e.end)-n.getOffsetAt(e.start);let l=a/o;let c=i.virtual_document.language;let d=this.get_mode(c);if(typeof d==="undefined"){continue}if(l>this.settings.composite.foreignCodeThreshold){t.add(n);let e=r.getOption("mode");if(e!=d.mime){r.setOption("mode",d.mime)}}}}if(t!=this.editors_with_active_highlight){for(let e of this.editors_with_active_highlight){if(!t.has(e)){e.editor.setOption("mode",e.model.mimeType)}}}this.editors_with_active_highlight=t}}class Pr{constructor(e,t){this.mimeTypeService=e;this.codeMirror=t}}const Or={id:Rr,requires:[o,Tr.IEditorServices,y.ISettingRegistry,di.ICodeMirror,E.ITranslator],autoStart:true,activate:(e,t,n,i,r,s)=>{const o=new ct(i,Rr);const a=s.load("jupyterlab_lsp");t.register({feature:{editorIntegrationFactory:new Map([["CodeMirrorEditor",Dr]]),commands:[],id:Rr,name:a.__("Syntax highlighting"),labIntegration:new Pr(n.mimeTypeService,r),settings:o}})}};var zr=n(77962);class $r{constructor(e){this._sessionsChanged=new S.Signal(this);this._sessions=new Map;this._specs=new Map;this._warningsEmitted=new Set;this._settings=e.settings||zr.ServerConnection.makeSettings();this._baseUrl=e.baseUrl||$.PageConfig.getBaseUrl();this._retries=e.retries||2;this._retriesInterval=e.retriesInterval||1e4;this._statusCode=-1;this._configuration={};this.console=e.console;this.fetchSessions().catch(console.warn)}get specs(){return this._specs}get statusUrl(){return $.URLExt.join(this._baseUrl,r.URL_NS,"status")}get sessionsChanged(){return this._sessionsChanged}get sessions(){return this._sessions}setConfiguration(e){this._configuration=e}warnOnce(e){if(!this._warningsEmitted.has(e)){this._warningsEmitted.add(e);this.console.warn(e)}}_comparePriorities(e,t){var n,i,r,s;const o=50;const a=(i=(n=this._configuration[e])===null||n===void 0?void 0:n.priority)!==null&&i!==void 0?i:o;const l=(s=(r=this._configuration[t])===null||r===void 0?void 0:r.priority)!==null&&s!==void 0?s:o;if(a==l){this.warnOnce(`Two matching servers: ${e} and ${t} have the same priority; choose which one to use by changing the priority in Advanced Settings Editor`);return e.localeCompare(t)}return l-a}isMatchingSpec(e,t){const n=e.language.toLocaleLowerCase();return t.languages.some((e=>e.toLocaleLowerCase()==n))}getMatchingServers(e){if(!e.language){this.console.error("Cannot match server by language: language not available; ensure that kernel and specs provide language and MIME type");return[]}const t=[];for(const[n,i]of this._sessions.entries()){if(this.isMatchingSpec(e,i.spec)){t.push(n)}}return t.sort(this._comparePriorities.bind(this))}getMatchingSpecs(e){const t=new Map;for(const[n,i]of this._specs.entries()){if(this.isMatchingSpec(e,i)){t.set(n,i)}}return t}get statusCode(){return this._statusCode}async fetchSessions(){let e=await zr.ServerConnection.makeRequest(this.statusUrl,{method:"GET"},this._settings);this._statusCode=e.status;if(!e.ok){console.error("Could not fetch sessions",e);if(this._retries>0){this._retries-=1;setTimeout(this.fetchSessions.bind(this),this._retriesInterval)}return}let t;try{const n=await e.json();t=n.sessions;try{this._version=n.version;this._specs=new Map(Object.entries(n.specs))}catch(i){console.warn(i)}}catch(i){console.warn(i);return}for(let r of Object.keys(t)){let e=r;if(this._sessions.has(e)){Object.assign(this._sessions.get(e),t[r])}else{this._sessions.set(e,t[r])}}const n=this._sessions.keys();for(const r in n){if(!t[r]){let e=r;this._sessions.delete(e)}}this._sessionsChanged.emit(void 0)}}class Fr{constructor(){this._overrides={}}get registry(){return this._overrides}register(e,t){if(!(t in this._overrides)){this._overrides[t]={cell:[],line:[]}}let n=this._overrides[t];switch(e.scope){case"cell":n.cell.push(e);break;case"line":n.line.push(e);break}}}const Ur={id:f.name,requires:[],activate:e=>new Fr,provides:f,autoStart:true};let Nr={python:[new m({language:"python",pattern:"^%%(python|python2|python3|pypy)( .*?)?\n([^]*)",foreign_capture_groups:[3],is_standalone:true,file_extension:"py"}),new m({language:"perl",pattern:"^%%(perl)( .*?)?\n([^]*)",foreign_capture_groups:[3],is_standalone:true,file_extension:"pl"}),new m({language:"ruby",pattern:"^%%(ruby)( .*?)?\n([^]*)",foreign_capture_groups:[3],is_standalone:true,file_extension:"rb"}),new m({language:"sh",pattern:"^%%(sh|bash)( .*?)?\n([^]*)",foreign_capture_groups:[3],is_standalone:true,file_extension:"sh"}),new m({language:"html",pattern:"^%%(html --isolated)( .*?)?\n([^]*)",foreign_capture_groups:[3],is_standalone:true,file_extension:"html"}),new m({language:"javascript",pattern:"^%%(js|javascript)( .*?)?\n([^]*)",foreign_capture_groups:[3],is_standalone:false,file_extension:"js"}),new m({language:"html",pattern:"^%%(?!html --isolated)(html)( .*?)?\n([^]*)",foreign_capture_groups:[3],is_standalone:false,file_extension:"html"}),new m({language:"latex",pattern:"^%%(latex)( .*?)?\n([^]*)",foreign_capture_groups:[3],is_standalone:false,file_extension:"tex"}),new m({language:"markdown",pattern:"^%%(markdown)( .*?)?\n([^]*)",foreign_capture_groups:[3],is_standalone:false,file_extension:"md"})]};function qr(e){return e.replace(/(["\\])/g,"\\$1")}function Wr(e){return e.replace(/\\([\\"])/g,"$1")}function Hr(e){if(!e){return""}else{return qr(e)}}const Vr="^(\\s*|\\s*\\S+\\s*=\\s*)";const Kr="([^?\\s'\"\\(\\)-\\+\\/#]+)";let Zr=[{pattern:Vr+"!([^=\\s]+)(.*)(\n)?",replacement:'$1get_ipython().getoutput("$2$3")$4',scope:"line",reverse:{pattern:'get_ipython\\(\\).getoutput\\("(.*?)"\\)(\n)?',replacement:"!$1$2",scope:"line"}},{pattern:"^(\\s*)"+"(\\?{1,2})"+Kr+"(\n)?$",replacement:(e,t,n,i,r)=>{const s=n=="?"?"pinfo":"pinfo2";r=r||"";return`${t}get_ipython().run_line_magic('${s}', '${i}')${r}`},scope:"line",reverse:{pattern:"get_ipython\\(\\).run_line_magic\\('(pinfo2?)', '(.*?)'\\)(\n)?",replacement:(e,t,n)=>{const i=t=="pinfo"?"?":"??";return`${i}${n}`},scope:"line"}},{pattern:"^(\\s*)"+Kr+"(\\?{1,2})(\n)?",replacement:(e,t,n,i,r)=>{const s=i=="?"?"pinfo":"pinfo2";r=r||"";return`${t}get_ipython().run_line_magic('${s}',  '${n}')${r}`},scope:"line",reverse:{pattern:"get_ipython\\(\\).run_line_magic\\('(pinfo2?)',  '(.*?)'\\)(\n)?",replacement:(e,t,n)=>{const i=t=="pinfo"?"?":"??";return`${n}${i}`},scope:"line"}},{pattern:Vr+"%(\\S+)(.*)(\n)?",replacement:(e,t,n,i,r)=>{i=Hr(i);r=r||"";return`${t}get_ipython().run_line_magic("${n}", "${i}")${r}`},scope:"line",reverse:{pattern:'get_ipython\\(\\).run_line_magic\\("(.*?)", "(.*?)"\\)(\n)?',replacement:(e,t,n)=>{n=Wr(n);return`%${t}${n}`},scope:"line"}},{pattern:"^%%(\\S+)(.*\n)([\\s\\S]*)",replacement:(e,t,n,i,r,s)=>{n=Hr(n);if(n){n=n.slice(0,-1)}i=i.replace(/"""/g,'\\"\\"\\"');return`get_ipython().run_cell_magic("${t}", "${n}", """${i}""")`},scope:"cell",reverse:{pattern:'^get_ipython\\(\\).run_cell_magic\\("(.*?)", "(.*?)", """([\\s\\S]*)"""\\)',replacement:(e,t,n,i)=>{i=i.replace(/\\"\\"\\"/g,'"""');n=Wr(n);return`%%${t}${n}\n${i}`},scope:"cell"}}];const Gr={id:s+":ipython",requires:[c,f],activate:(e,t,n)=>{for(let i of Object.keys(Nr)){for(let e of Nr[i]){t.register(e,i)}}for(let i of Zr){n.register(i,"python")}},autoStart:true};const Yr="(?:(?:.*?)://(?:.*))";const Jr=["--destination_table","--project","--use_bqstorage_api","--use_rest_api","--use_legacy_sql","--verbose","--params"];const Xr=["-l","--connections"];const Qr="(?:"+(Xr.join("|")+"|"+Jr.map((e=>e+" \\w+")).join("|"))+")";let es={python:[new m({language:"sql",pattern:`^%%bigquery(?: (?:${Yr}|${Qr}|(?:\\w+ << )|(?:\\w+@\\w+)))?\n?((?:.+\n)?(?:[^]*))`,foreign_capture_groups:[1],is_standalone:true,file_extension:"sql"})]};const ts={id:s+":ipython-bigquery",requires:[c],activate:(e,t)=>{for(let n of Object.keys(es)){for(let e of es[n]){t.register(e,n)}}},autoStart:true};const ns=10;function is(e,t){let n=[];let i=[];let r=[];for(let s=0;s<e.length;s=s+2){let t=e[s];let o=e[s+1];if(t==null){break}else if(t==="i"||t==="-input"){n.push(o)}else if(t==="o"||t==="-output"){i.push(o)}else{r.push("-"+t+" "+o)}}return{inputs:n,outputs:i,rest:e[e.length+t],others:r}}function rs(e,t){let{inputs:n,outputs:i,rest:r,others:s}=is(e,t);let o=n.join(", ");if(o){o=", "+o}let a=i.join(", ");if(a){a=a+" = "}return{content:r,others:s.join(" "),inputs:o,outputs:a}}function ss(e='"',t=false,n="R"){return"(\\S+)?"+"(?:, (\\S+))?".repeat(9)+"( = )?rpy2\\.ipython\\.rmagic\\.RMagics."+n+"\\("+e+(t?"([\\s\\S]*)":"(.*?)")+e+', "(.*?)"'+"(?:, (\\S+))?".repeat(10)+"\\)"}function os(e,...t){let n=[];for(let l=0;l<10;l++){if(t[l]==null){break}n.push(t[l])}let i=[];for(let l=13;l<23;l++){if(t[l]==null){break}i.push(t[l])}let r=i.join(" -i ");if(r){r=" -i "+r}let s=n.join(" -o ");if(s){s=" -o "+s}let o=t[11];let a=t[12];if(a){a=" "+a}return{input:r,output:s,other:a,contents:o}}function as(e){return"(?: -(\\S+) (\\S+))?".repeat(e)}function ls(e){function t(t,...n){let i=is(n,-3);let r;if(i.rest==null){r=""}else if(e){r=i.rest.startsWith(" ")?i.rest.slice(1):i.rest}else{r=i.rest}return r}return t}let cs=ls(false);function ds(e,...t){let n=is(t,-3);let i=n.inputs.map((e=>e+" <- data.frame();")).join(" ");let r=cs(e,...t);if(i!==""&&r){i+=" "}return i}let us={python:[new m({language:"r",pattern:"^%%R"+as(ns)+"\n([^]*)",foreign_capture_groups:[ns*2+1],foreign_replacer:cs,extract_arguments:ds,is_standalone:false,file_extension:"R"}),new m({language:"r",pattern:"(?:^|\n)%R"+as(ns)+"(?: (.*))?(?:\n|$)",foreign_capture_groups:[ns*2+1],foreign_replacer:ls(true),extract_arguments:ds,is_standalone:false,file_extension:"R"})]};let hs=[{pattern:Vr+"%R"+as(ns)+"( .*)?(\n|$)",replacement:(e,t,...n)=>{let i=rs(n,-4);return`${t}${i.outputs}rpy2.ipython.rmagic.RMagics.R("${i.content||""}", "${i.others}"${i.inputs})`},scope:"line",reverse:{pattern:ss(),replacement:(e,...t)=>{let n=os(e,...t);return"%R"+n.input+n.output+n.other+n.contents},scope:"line"}},{pattern:"^%%R"+as(ns)+"(\n)?([\\s\\S]*)",replacement:(e,...t)=>{let n=rs(t,-3);return`${n.outputs}rpy2.ipython.rmagic.RMagics.R("""${n.content}""", "${n.others}"${n.inputs})`},scope:"cell",reverse:{pattern:ss('"""',true),replacement:(e,...t)=>{let n=os(e,...t);return"%%R"+n.input+n.output+n.other+"\n"+n.contents},scope:"cell"}},{pattern:Vr+"%Rdevice( .*)?(\n|$)",replacement:(e,t,...n)=>`${t}rpy2.ipython.rmagic.RMagics.Rdevice("${n[0]}", "")`,scope:"line",reverse:{pattern:ss('"',false,"Rdevice"),replacement:(e,...t)=>{let n=os(e,...t);return"%Rdevice"+n.input+n.output+n.other+n.contents},scope:"line"}}];const gs={id:s+":ipython-rpy2",requires:[c,f],activate:(e,t,n)=>{for(let i of Object.keys(us)){for(let e of us[i]){t.register(e,i)}}for(let i of hs){n.register(i,"python")}},autoStart:true};const ps="(?:(?:.*?)://(?:.*))";const _s=["-x","--close","-c","--creator","-p","--persist","--append"];const ms=["-l","--connections"];const fs="(?:"+(ms.join("|")+"|"+_s.map((e=>e+" \\w+")).join("|"))+")";let vs={python:[new m({language:"sql",pattern:`^%%sql(?: (?:${ps}|${fs}|(?:\\w+ << )|(?:\\w+@\\w+)))?\n?((?:.+\n)?(?:[^]*))`,foreign_capture_groups:[1],is_standalone:true,file_extension:"sql"}),new m({language:"sql",pattern:`(?:^|\n)%sql (?:${ps}|${fs}|(.*))\n?`,foreign_capture_groups:[1],is_standalone:false,file_extension:"sql"})]};const As={id:s+":ipython-sql",requires:[c],activate:(e,t)=>{for(let n of Object.keys(vs)){for(let e of vs[n]){t.register(e,n)}}},autoStart:true};const ws=[gs,As,ts,Gr];class bs{constructor(e,t){this.virtual_editor=e;this.adapter=t}markText(e,t,n){let i=this.virtual_editor.virtual_document.get_editor_at_source_line(e);let r=this.virtual_editor.ce_editor_to_cm_editor.get(i);let s=this.virtual_editor;return r.getDoc().markText(s.transform_from_root_to_editor(e),s.transform_from_root_to_editor(t),n)}getCursor(e){let t=this.adapter.activeEditor;if(t==null){return undefined}let n=t.editor.getDoc().getCursor(e);return this.virtual_editor.transform_from_editor_to_root(t,n)}}class ys{constructor(e){this.editor_name="CodeMirrorEditor";this.isDisposed=false;this._event_wrappers=new Map;this.adapter=e.adapter;this.virtual_document=e.virtual_document;this.console=this.adapter.console;this.change=new S.Signal(this);this.block_added_handlers=[];this.block_removed_handlers=[];this.editor_to_source_line=new Map;this.cm_editor_to_ce_editor=new Map;this.ce_editor_to_cm_editor=new Map;this._proxy=new Proxy(this,{get:function(e,t,n){if(!(t in e)){console.warn(`Unimplemented method ${t.toString()} for CodeMirrorVirtualEditor`);return}else{return Reflect.get(e,t,n)}}});this.virtual_document.update_manager.update_began.connect(this.onEditorsUpdated,this);this.virtual_document.update_manager.block_added.connect(this.save_block_position,this);this.virtual_document.update_manager.update_finished.connect((()=>{this.editor_to_source_line=this.editor_to_source_line_new}),this);this.set_event_handlers();return this._proxy}dispose(){if(this.isDisposed){return}this.editor_to_source_line.clear();this.cm_editor_to_ce_editor.clear();this.ce_editor_to_cm_editor.clear();this.off("change",this.emit_change);for(let[[e],t]of this._event_wrappers.entries()){this.forEveryBlockEditor((n=>{n.off(e,t)}),false)}this._event_wrappers.clear();this.disconnectBlockMonitoring();this.virtual_document.dispose();this.virtual_document=null;this.code_extractors=null;this.isDisposed=true;this.forEveryBlockEditor=null;this._proxy=null}get_cursor_position(){return this.getDoc().getCursor("end")}onEditorsUpdated(e,t){this.cm_editor_to_ce_editor.clear();this.ce_editor_to_cm_editor.clear();this.editor_to_source_line_new=new Map;for(let n of t){let e=n.ce_editor;let t=e.editor;this.cm_editor_to_ce_editor.set(t,e);this.ce_editor_to_cm_editor.set(e,t)}}save_block_position(e,t){this.editor_to_source_line_new.set(t.block.ce_editor,t.virtual_document.last_source_line)}set_event_handlers(){this.on("change",this.emit_change.bind(this))}emit_change(e,t){this.change.emit(t)}window_coords_to_root_position(e){const t=this.coordsChar(e,"window");if(t.line===-1&&t.ch===-1){return null}return t}get_token_at(e){let t=this.getTokenAt(e);return{value:t.string,offset:t.start,type:t.type||""}}get_cm_editor(e){return this.get_editor_at_root_line(e)}transform_virtual_to_editor(e){return this.virtual_document.transform_virtual_to_editor(e)}document_at_root_position(e){let t=e;return this.virtual_document.root.document_at_source_position(t)}root_position_to_virtual_position(e){let t=e;return this.virtual_document.root.virtual_position_at_document(t)}get_editor_at_root_position(e){return this.virtual_document.root.get_editor_at_source_line(e)}root_position_to_editor(e){return this.virtual_document.root.transform_source_to_editor(e)}on(e,t,...n){let i=(e,...n)=>{try{return t(this,...n)}catch(i){this.console.warn("CodeMirrorVirtualEditor handler (which should accept a CodeMirror Editor instance) failed",{error:i,instance:e,args:n,this:this})}};this._event_wrappers.set([e,t],i);this.forEveryBlockEditor((t=>{t.on(e,i)}),true,(t=>{t.off(e,i)}))}off(e,t,...n){let i=this._event_wrappers.get([e,t]);this.forEveryBlockEditor((t=>{t.off(e,i)}))}find_ce_editor(e){return this.cm_editor_to_ce_editor.get(e)}transform_from_editor_to_root(e,t){if(!this.editor_to_source_line.has(e)){this.console.warn("Editor not found in editor_to_source_line map");return null}let n=this.editor_to_source_line.get(e);return Object.assign(Object.assign({},t),{line:t.line+n})}transform_from_root_to_editor(e){return this.virtual_document.transform_source_to_editor(e)}addKeyMap(e,t){return}addLineClass(e,t,n){return undefined}addLineWidget(e,t,n){return undefined}addOverlay(e,t){for(let n of this.adapter.editors){let i=n;i.editor.addOverlay(e,t)}}addPanel(e,t){return undefined}charCoords(e,t){try{let n=this.get_editor_at_root_line(e);return n.charCoords(e,t)}catch(n){console.log(n);return{bottom:0,left:0,right:0,top:0}}}coordsChar(e,t){let n=null;for(let i of this.adapter.editors){let r=i;let s=r.editor.coordsChar(e,t);if(s.outside===1){continue}n=this.transform_from_editor_to_root(i,s);break}if(n==null){return{line:-1,ch:-1}}return n}cursorCoords(e,t){if(typeof e!=="boolean"&&e!=null){let t=this.get_editor_at_root_line(e);return t.cursorCoords(this.transform_from_root_to_editor(e))}return{bottom:0,left:0,top:0}}get any_editor(){return this.adapter.editors[0].editor}defaultCharWidth(){return this.any_editor.defaultCharWidth()}defaultTextHeight(){return this.any_editor.defaultTextHeight()}endOperation(){for(let e of this.adapter.editors){let t=e;t.editor.endOperation()}}execCommand(e){for(let t of this.adapter.editors){let n=t;n.editor.execCommand(e)}}getDoc(){let e=new bs(this,this.adapter);return e}get_editor_at_root_line(e){let t=this.virtual_document.root.get_editor_at_source_line(e);return this.ce_editor_to_cm_editor.get(t)}getTokenAt(e,t){let n=this.get_editor_at_root_line(e);return n.getTokenAt(this.transform_from_root_to_editor(e))}getTokenTypeAt(e){let t=this.virtual_document.get_editor_at_source_line(e);let n=this.ce_editor_to_cm_editor.get(t);return n.getTokenTypeAt(this.transform_from_root_to_editor(e))}get_editor_value(e){let t=e;return t.model.value.text}getWrapperElement(){return this.adapter.wrapper_element}heightAtLine(e,t,n){return 0}isReadOnly(){return false}lineAtHeight(e,t){return 0}disconnectBlockMonitoring(){for(let e of this.block_added_handlers){this.adapter.editorAdded.disconnect(e)}this.block_added_handlers=[];for(let e of this.block_removed_handlers){this.adapter.editorRemoved.disconnect(e)}this.block_removed_handlers=[]}forEveryBlockEditor(e,t=true,n=null){const i=new Set;for(let r of this.adapter.editors){let t=r.editor;i.add(t);e(t)}if(t){const t=(t,n)=>{let{editor:r}=n;if(r==null){return}let s=r.editor;if(!i.has(s)){e(s)}};const r=(e,t)=>{if(n==null){return}let{editor:i}=t;if(i==null){return}let r=i.editor;n(r)};this.block_added_handlers.push(t);this.block_added_handlers.push(r);this.adapter.editorAdded.connect(t);this.adapter.editorRemoved.connect(r)}}find_editor(e){let t=this.cm_editor_to_ce_editor.get(e);return{index:this.adapter.get_editor_index(t),node:this.adapter.get_editor_wrapper(t)}}}const Cs={id:s+":CodeMirrorVirtualEditor",requires:[l],activate:(e,t)=>t.registerEditorType({implementation:ys,name:"CodeMirrorEditor",supports:di.CodeMirrorEditor}),autoStart:true};class Es{constructor(){this.editorTypes=[]}registerEditorType(e){this.editorTypes.push(e)}findBestImplementation(e){for(let t of this.editorTypes){if(e.every((e=>e instanceof t.supports))){return t}}console.warn("Cold not find a VirtualEditor suitable for the provided set of editors:",e);return null}}const xs={id:s+":ILSPVirtualEditorManager",requires:[],activate:e=>new Es,provides:l,autoStart:true};var ks=v.JupyterFrontEnd.IPaths;class js{constructor(){this.features=[];this.command_managers=[];this.command_manager_registered=new S.Signal(this)}_register(e){if(e.supersedes){for(let t of e.supersedes){this.features=this.features.filter((e=>e.id!=t))}}this.features.push(e.feature);if(e.feature.commands){for(let t of this.command_managers){t.add(e.feature.commands)}this.command_manager_registered.connect(((t,n)=>{if(e.feature.commands){n.add(e.feature.commands)}}))}}register(e){if(e.feature.settings&&e.feature.settings.ready){e.feature.settings.ready.then((()=>{var t,n;if(!((n=(t=e.feature)===null||t===void 0?void 0:t.settings)===null||n===void 0?void 0:n.composite.disable)){this._register(e)}else{console.log("Skipping ",e.feature.id,"as disabled")}})).catch(console.warn);return}else{this._register(e)}}registerCommandManager(e){this.command_managers.push(e);this.command_manager_registered.emit(e)}}class Ss{constructor(e,t,n,i,r,o,a,l,c,d,u,h,g){this.app=e;this.setting_registry=t;this.palette=n;this.editor_type_manager=a;this.code_extractors_manager=l;this.code_overrides_manager=c;this.console=d;this.translator=u;this.user_console=h;const p=(u||E.nullTranslator).load("jupyterlab_lsp");this.language_server_manager=new $r({console:this.console.scope("LanguageServerManager")});this.connection_manager=new U({language_server_manager:this.language_server_manager,console:this.console.scope("DocumentConnectionManager")});const _=new Xe({language_server_manager:this.language_server_manager,connection_manager:this.connection_manager,adapter_manager:o,translator_bundle:p});if(g!==null){g.registerStatusItem(s+":language-server-status",{item:_.createItem(),align:"left",rank:1,isActive:()=>o.isAnyActive()})}else{e.docRegistry.addWidgetExtension("Notebook",_)}this.feature_manager=new js;this.setting_registry.load(Ms.id).then((e=>{const t=e.composite;const n=t.language_servers||{};this.connection_manager.initial_configurations=n;this.connection_manager.updateConfiguration(n);this.connection_manager.updateLogging(t.logAllCommunication,t.setTrace);e.changed.connect((()=>{this.updateOptions(e)}))})).catch((e=>{d.error(e.message)}));o.registerExtension(this)}registerAdapterType(e,t){let n=new ye(Object.assign({adapter_manager:e,app:this.app,palette:this.palette,tracker:t.tracker,suffix:t.name,entry_point:t.entrypoint,console:this.console},t.context_menu));this.feature_manager.registerCommandManager(n)}get foreign_code_extractors(){return this.code_extractors_manager.registry}get code_overrides(){return this.code_overrides_manager.registry}updateOptions(e){const t=e.composite;const n=t.language_servers||{};this.connection_manager.initial_configurations=n;this.connection_manager.updateConfiguration(n);this.connection_manager.updateServerConfigurations(n);this.connection_manager.updateLogging(t.logAllCommunication,t.setTrace)}}const Ms={id:s+":plugin",requires:[y.ISettingRegistry,A.ICommandPalette,w.IDocumentManager,ks,a,l,c,f,d,E.ITranslator],optional:[b.ILoggerRegistry,C.IStatusBar],activate:(e,...t)=>{let n=new Ss(e,...t);return n.feature_manager},provides:o,autoStart:true};const Is=[wi,ai,Ir,_r,br,er,Hi,Or];const Ts=[ee,rt,P,Ae,_e,xs,Cs,x.COMPLETION_THEME_MANAGER,j.plugin,k.plugin,Ur,Ms,...ws,...Is];const Ls=Ts},76013:(e,t,n)=>{"use strict";n.d(t,{_v:()=>l,EU:()=>c,nE:()=>d,Gl:()=>u,Ei:()=>g,lj:()=>m,HY:()=>v,ry:()=>A});var i=n(49818);var r=n.n(i);var s=n(35286);var o=n.n(s);const a=/^file:\/\/([^\/]+|\/[a-zA-Z](?::|%3A))/;async function l(e){return new Promise((t=>{setTimeout((()=>{t()}),e)}))}function c(e,t=35,n=50,i=(e=>e)){return new Promise((async(r,s)=>{let o=0;while(e()!==true){o+=1;if(t!==-1&&o>t){s("Too many retrials");break}n=i(n);await l(n)}r(e)}))}function d(e,t){const n=e.key||null;let i=false;switch(t){case"Shift":i=e.shiftKey||n=="Shift";break;case"Alt":i=e.altKey||n=="Alt";break;case"AltGraph":i=n=="AltGraph";break;case"Control":i=e.ctrlKey||n=="Control";break;case"Meta":i=e.metaKey||n=="Meta";break;case"Accel":i=e.metaKey||n=="Meta"||e.ctrlKey||n=="Control";break}if(e.getModifierState!==undefined){return i||e.getModifierState(t)}return i}class u extends Map{constructor(e,t){super(t);this.default_factory=e}get(e){return this.get_or_create(e)}get_or_create(e,...t){if(this.has(e)){return super.get(e)}else{let n=this.default_factory(e,...t);this.set(e,n);return n}}}function h(){return i.PageConfig.getOption("rootUri")}function g(e,t){const n=p(e)&&p(t);if(n){e=_(e);t=_(t)}return e===t||decodeURI(e)===decodeURI(t)}function p(e){return e.match(a)}function _(e){return e.replace(a,(e=>e.replace("%3A",":").toLowerCase()))}function m(e,t){t=t||h();if(t==null){return null}if(e.startsWith(t)){return decodeURIComponent(e.replace(t,""))}return null}const f=(e,t)=>{const n={};let i=n;e.forEach(((n,r)=>{i[n]={};if(r===e.length-1){i[n]=t}else{i=i[n]}}));return n};const v=e=>{const t=[];for(let n in e){const i=f(n.split("."),e[n]);t.push(i)}return o()({},...t)};function A(e){e=e.replace(/([\\#*_[\]])/g,"\\$1");const t=document.createElement("span");t.textContent=e;return t.innerHTML.replace(/\n/g,"<br>").replace(/ {2}/g,"  ")}},72947:(e,t,n)=>{"use strict";n.d(t,{wo:()=>s,Uu:()=>a,OC:()=>l,kZ:()=>c});var i=n(91100);var r=n.n(i);const s="lsp-completer-theme-";var o;(function(e){e[e["Text"]=1]="Text";e[e["Method"]=2]="Method";e[e["Function"]=3]="Function";e[e["Constructor"]=4]="Constructor";e[e["Field"]=5]="Field";e[e["Variable"]=6]="Variable";e[e["Class"]=7]="Class";e[e["Interface"]=8]="Interface";e[e["Module"]=9]="Module";e[e["Property"]=10]="Property";e[e["Unit"]=11]="Unit";e[e["Value"]=12]="Value";e[e["Enum"]=13]="Enum";e[e["Keyword"]=14]="Keyword";e[e["Snippet"]=15]="Snippet";e[e["Color"]=16]="Color";e[e["File"]=17]="File";e[e["Reference"]=18]="Reference";e[e["Folder"]=19]="Folder";e[e["EnumMember"]=20]="EnumMember";e[e["Constant"]=21]="Constant";e[e["Struct"]=22]="Struct";e[e["Event"]=23]="Event";e[e["Operator"]=24]="Operator";e[e["TypeParameter"]=25]="TypeParameter"})(o||(o={}));const a="@krassowski/completion-manager";const l="Kernel";const c=new i.Token(a+":ILSPCompletionThemeManager")},36020:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var i=n(94015);var r=n.n(i);var s=n(23645);var o=n.n(s);var a=o()(r());a.push([e.id,".lsp-floating-console {\n  position: absolute;\n  width: 600px;\n  min-height: 350px;\n  height: 25%;\n  right: 0;\n  bottom: 0;\n  background: rgba(255, 255, 255, 0.8);\n  border: 3px solid rgba(204, 204, 204, 0.7);\n  font-size: 12px;\n  overflow-y: auto;\n  margin: 0;\n  list-style-type: none;\n  padding: 5px;\n  z-index: 100;\n}\n\n.lsp-code {\n  font-family: monospace;\n  background: #eee;\n  border-radius: 2px;\n  padding: 2px 5px;\n}\n\n.lsp-kind {\n  padding: 2px 5px;\n}\n","",{version:3,sources:["webpack://./node_modules/@krassowski/jupyterlab-lsp/style/console.css"],names:[],mappings:"AAAA;EACE,kBAAkB;EAClB,YAAY;EACZ,iBAAiB;EACjB,WAAW;EACX,QAAQ;EACR,SAAS;EACT,oCAAoC;EACpC,0CAA0C;EAC1C,eAAe;EACf,gBAAgB;EAChB,SAAS;EACT,qBAAqB;EACrB,YAAY;EACZ,YAAY;AACd;;AAEA;EACE,sBAAsB;EACtB,gBAAgB;EAChB,kBAAkB;EAClB,gBAAgB;AAClB;;AAEA;EACE,gBAAgB;AAClB",sourcesContent:[".lsp-floating-console {\n  position: absolute;\n  width: 600px;\n  min-height: 350px;\n  height: 25%;\n  right: 0;\n  bottom: 0;\n  background: rgba(255, 255, 255, 0.8);\n  border: 3px solid rgba(204, 204, 204, 0.7);\n  font-size: 12px;\n  overflow-y: auto;\n  margin: 0;\n  list-style-type: none;\n  padding: 5px;\n  z-index: 100;\n}\n\n.lsp-code {\n  font-family: monospace;\n  background: #eee;\n  border-radius: 2px;\n  padding: 2px 5px;\n}\n\n.lsp-kind {\n  padding: 2px 5px;\n}\n"],sourceRoot:""}]);const l=a},2660:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var i=n(94015);var r=n.n(i);var s=n(23645);var o=n.n(s);var a=o()(r());a.push([e.id,".lsp-diagnostics-panel-content {\n  overflow-y: auto;\n}\n\n.lsp-diagnostics-listing {\n  color: var(--jp-ui-font-color1);\n  background: var(--jp-layout-color1);\n  font-size: var(--jp-ui-font-size1);\n  border-spacing: 0;\n  /* required to preserve borders of `<th>` when using position:sticky */\n  border-collapse: separate;\n  width: 100%;\n}\n\n.lsp-diagnostics-listing thead {\n  box-shadow: var(--jp-toolbar-box-shadow);\n}\n\n.lsp-diagnostics-listing tbody {\n  overflow-y: auto;\n  overflow-x: hidden;\n}\n\n.lsp-diagnostics-listing th,\n.lsp-diagnostics-listing td {\n  padding: 4px 12px 2px 12px;\n  height: 18px;\n}\n\n.lsp-diagnostics-listing th {\n  font-weight: 500;\n  text-align: left;\n  border-bottom: var(--jp-border-width) solid var(--jp-border-color1);\n  background: var(--jp-layout-color1);\n  position: sticky;\n  top: 0;\n  z-index: 2;\n  white-space: nowrap;\n  user-select: none;\n}\n\n.lsp-diagnostics-listing th:not(:first-child) {\n  border-left: var(--jp-border-width) solid var(--jp-border-color2);\n}\n\n.lsp-diagnostics-listing th:hover {\n  background: var(--jp-layout-color2);\n}\n\n.lsp-diagnostics-listing tbody tr:hover {\n  background: var(--jp-layout-color2);\n}\n\n.lsp-diagnostics-listing thead th > div {\n  flex-direction: row;\n  display: flex;\n}\n\n.lsp-diagnostics-listing thead th > div > label {\n  flex: 1;\n  text-overflow: ellipsis;\n}\n\n.lsp-sort-icon {\n  flex: 0;\n  height: var(--jp-ui-font-size1);\n  width: var(--jp-ui-font-size1);\n}\n\n.lsp-sort-icon svg {\n  display: inline;\n  height: auto;\n}\n\n.lsp-diagnostics-listing thead th:not(.lsp-sorted-header) .lsp-sort-icon {\n  opacity: 0;\n}\n\n.lsp-diagnostics-listing thead th:not(.lsp-sorted-header):hover .lsp-sort-icon {\n  opacity: 0.5;\n}\n","",{version:3,sources:["webpack://./node_modules/@krassowski/jupyterlab-lsp/style/diagnostics_listing.css"],names:[],mappings:"AAAA;EACE,gBAAgB;AAClB;;AAEA;EACE,+BAA+B;EAC/B,mCAAmC;EACnC,kCAAkC;EAClC,iBAAiB;EACjB,sEAAsE;EACtE,yBAAyB;EACzB,WAAW;AACb;;AAEA;EACE,wCAAwC;AAC1C;;AAEA;EACE,gBAAgB;EAChB,kBAAkB;AACpB;;AAEA;;EAEE,0BAA0B;EAC1B,YAAY;AACd;;AAEA;EACE,gBAAgB;EAChB,gBAAgB;EAChB,mEAAmE;EACnE,mCAAmC;EACnC,gBAAgB;EAChB,MAAM;EACN,UAAU;EACV,mBAAmB;EACnB,iBAAiB;AACnB;;AAEA;EACE,iEAAiE;AACnE;;AAEA;EACE,mCAAmC;AACrC;;AAEA;EACE,mCAAmC;AACrC;;AAEA;EACE,mBAAmB;EACnB,aAAa;AACf;;AAEA;EACE,OAAO;EACP,uBAAuB;AACzB;;AAEA;EACE,OAAO;EACP,+BAA+B;EAC/B,8BAA8B;AAChC;;AAEA;EACE,eAAe;EACf,YAAY;AACd;;AAEA;EACE,UAAU;AACZ;;AAEA;EACE,YAAY;AACd",sourcesContent:[".lsp-diagnostics-panel-content {\n  overflow-y: auto;\n}\n\n.lsp-diagnostics-listing {\n  color: var(--jp-ui-font-color1);\n  background: var(--jp-layout-color1);\n  font-size: var(--jp-ui-font-size1);\n  border-spacing: 0;\n  /* required to preserve borders of `<th>` when using position:sticky */\n  border-collapse: separate;\n  width: 100%;\n}\n\n.lsp-diagnostics-listing thead {\n  box-shadow: var(--jp-toolbar-box-shadow);\n}\n\n.lsp-diagnostics-listing tbody {\n  overflow-y: auto;\n  overflow-x: hidden;\n}\n\n.lsp-diagnostics-listing th,\n.lsp-diagnostics-listing td {\n  padding: 4px 12px 2px 12px;\n  height: 18px;\n}\n\n.lsp-diagnostics-listing th {\n  font-weight: 500;\n  text-align: left;\n  border-bottom: var(--jp-border-width) solid var(--jp-border-color1);\n  background: var(--jp-layout-color1);\n  position: sticky;\n  top: 0;\n  z-index: 2;\n  white-space: nowrap;\n  user-select: none;\n}\n\n.lsp-diagnostics-listing th:not(:first-child) {\n  border-left: var(--jp-border-width) solid var(--jp-border-color2);\n}\n\n.lsp-diagnostics-listing th:hover {\n  background: var(--jp-layout-color2);\n}\n\n.lsp-diagnostics-listing tbody tr:hover {\n  background: var(--jp-layout-color2);\n}\n\n.lsp-diagnostics-listing thead th > div {\n  flex-direction: row;\n  display: flex;\n}\n\n.lsp-diagnostics-listing thead th > div > label {\n  flex: 1;\n  text-overflow: ellipsis;\n}\n\n.lsp-sort-icon {\n  flex: 0;\n  height: var(--jp-ui-font-size1);\n  width: var(--jp-ui-font-size1);\n}\n\n.lsp-sort-icon svg {\n  display: inline;\n  height: auto;\n}\n\n.lsp-diagnostics-listing thead th:not(.lsp-sorted-header) .lsp-sort-icon {\n  opacity: 0;\n}\n\n.lsp-diagnostics-listing thead th:not(.lsp-sorted-header):hover .lsp-sort-icon {\n  opacity: 0.5;\n}\n"],sourceRoot:""}]);const l=a},23311:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var i=n(94015);var r=n.n(i);var s=n(23645);var o=n.n(s);var a=n(51331);var l=n(12062);var c=n(66985);var d=n(8428);var u=o()(r());u.i(a.Z);u.i(l.Z);u.i(c.Z);u.i(d.Z);u.push([e.id,'.cm-lsp-diagnostic {\n  text-decoration-line: underline;\n  /* For Chrome */\n  text-decoration-skip-ink: none;\n}\n\n.cm-lsp-diagnostic-tag-Unnecessary {\n  /*\n   * LSP: "Clients are allowed to render diagnostics with this tag faded out instead of having an error squiggle."\n   */\n  filter: grayscale(1);\n  opacity: 0.7;\n  text-decoration: none !important;\n}\n\n.cm-lsp-diagnostic-tag-Deprecated {\n  /*\n   * LSP: "Clients are allowed to rendered diagnostics with this tag strike through."\n   */\n  text-decoration: line-through !important;\n}\n\n.cm-lsp-diagnostic-Error {\n  /*\n    "wavy" would be ideal, but there seems to be a bug in Chrome which makes it\n    fail to render the last character see:\n    https://stackoverflow.com/questions/57559588/how-to-make-the-wavy-underline-extend-cover-all-the-characters-in-chrome\n    an alternative would be to use background image trick to simulate the underline\n  */\n\n  text-decoration-style: var(\n    --jp-editor-mirror-lsp-diagnostic-decoration-style\n  );\n  text-decoration-color: var(\n    --jp-editor-mirror-lsp-diagnostic-error-decoration-color\n  );\n}\n\n.cm-lsp-diagnostic-Warning {\n  text-decoration-style: var(\n    --jp-editor-mirror-lsp-diagnostic-decoration-style\n  );\n  text-decoration-color: var(\n    --jp-editor-mirror-lsp-diagnostic-warning-decoration-color\n  );\n}\n\n.cm-lsp-diagnostic-Information {\n  text-decoration-style: var(\n    --jp-editor-mirror-lsp-diagnostic-decoration-style\n  );\n  text-decoration-color: var(\n    --jp-editor-mirror-lsp-diagnostic-information-decoration-color\n  );\n}\n\n.cm-lsp-diagnostic-Hint {\n  text-decoration-style: var(\n    --jp-editor-mirror-lsp-diagnostic-decoration-style\n  );\n  text-decoration-color: var(\n    --jp-editor-mirror-lsp-diagnostic-hint-decoration-color\n  );\n}\n\n/* hover */\n.cm-lsp-hover-available {\n  text-decoration: var(--jp-editor-mirror-lsp-hover-decoration-style);\n  text-decoration-color: var(--jp-editor-mirror-lsp-hover-decoration-color);\n  text-decoration-line: underline;\n  text-decoration-skip-ink: none;\n}\n\n/* highlight */\n.cm-lsp-highlight {\n  background-color: var(--jp-editor-mirror-lsp-highlight-background-color);\n}\n',"",{version:3,sources:["webpack://./node_modules/@krassowski/jupyterlab-lsp/style/highlight.css"],names:[],mappings:"AAKA;EACE,+BAA+B;EAC/B,eAAe;EACf,8BAA8B;AAChC;;AAEA;EACE;;IAEE;EACF,oBAAoB;EACpB,YAAY;EACZ,gCAAgC;AAClC;;AAEA;EACE;;IAEE;EACF,wCAAwC;AAC1C;;AAEA;EACE;;;;;GAKC;;EAED;;GAEC;EACD;;GAEC;AACH;;AAEA;EACE;;GAEC;EACD;;GAEC;AACH;;AAEA;EACE;;GAEC;EACD;;GAEC;AACH;;AAEA;EACE;;GAEC;EACD;;GAEC;AACH;;AAEA,UAAU;AACV;EACE,mEAAmE;EACnE,yEAAyE;EACzE,+BAA+B;EAC/B,8BAA8B;AAChC;;AAEA,cAAc;AACd;EACE,wEAAwE;AAC1E",sourcesContent:["@import url('./variables/base.css');\n@import url('./variables/cm-themes.css');\n@import url('./variables/jupyterlab-dark.css');\n@import url('./variables/jupyterlab-light.css');\n\n.cm-lsp-diagnostic {\n  text-decoration-line: underline;\n  /* For Chrome */\n  text-decoration-skip-ink: none;\n}\n\n.cm-lsp-diagnostic-tag-Unnecessary {\n  /*\n   * LSP: \"Clients are allowed to render diagnostics with this tag faded out instead of having an error squiggle.\"\n   */\n  filter: grayscale(1);\n  opacity: 0.7;\n  text-decoration: none !important;\n}\n\n.cm-lsp-diagnostic-tag-Deprecated {\n  /*\n   * LSP: \"Clients are allowed to rendered diagnostics with this tag strike through.\"\n   */\n  text-decoration: line-through !important;\n}\n\n.cm-lsp-diagnostic-Error {\n  /*\n    \"wavy\" would be ideal, but there seems to be a bug in Chrome which makes it\n    fail to render the last character see:\n    https://stackoverflow.com/questions/57559588/how-to-make-the-wavy-underline-extend-cover-all-the-characters-in-chrome\n    an alternative would be to use background image trick to simulate the underline\n  */\n\n  text-decoration-style: var(\n    --jp-editor-mirror-lsp-diagnostic-decoration-style\n  );\n  text-decoration-color: var(\n    --jp-editor-mirror-lsp-diagnostic-error-decoration-color\n  );\n}\n\n.cm-lsp-diagnostic-Warning {\n  text-decoration-style: var(\n    --jp-editor-mirror-lsp-diagnostic-decoration-style\n  );\n  text-decoration-color: var(\n    --jp-editor-mirror-lsp-diagnostic-warning-decoration-color\n  );\n}\n\n.cm-lsp-diagnostic-Information {\n  text-decoration-style: var(\n    --jp-editor-mirror-lsp-diagnostic-decoration-style\n  );\n  text-decoration-color: var(\n    --jp-editor-mirror-lsp-diagnostic-information-decoration-color\n  );\n}\n\n.cm-lsp-diagnostic-Hint {\n  text-decoration-style: var(\n    --jp-editor-mirror-lsp-diagnostic-decoration-style\n  );\n  text-decoration-color: var(\n    --jp-editor-mirror-lsp-diagnostic-hint-decoration-color\n  );\n}\n\n/* hover */\n.cm-lsp-hover-available {\n  text-decoration: var(--jp-editor-mirror-lsp-hover-decoration-style);\n  text-decoration-color: var(--jp-editor-mirror-lsp-hover-decoration-color);\n  text-decoration-line: underline;\n  text-decoration-skip-ink: none;\n}\n\n/* highlight */\n.cm-lsp-highlight {\n  background-color: var(--jp-editor-mirror-lsp-highlight-background-color);\n}\n"],sourceRoot:""}]);const h=u},90763:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var i=n(94015);var r=n.n(i);var s=n(23645);var o=n.n(s);var a=n(23311);var l=n(87002);var c=n(46966);var d=o()(r());d.i(a.Z);d.i(l.Z);d.i(c.Z);d.push([e.id,".lsp-document-locator:hover {\n  cursor: pointer;\n}\n\n.lsp-document-locator span:not(:last-child)::after {\n  content: ' > ';\n}\n\n.lsp-icon-flip-x {\n  transform: scaleX(-1);\n  transform-origin: center center;\n}\n\n.lsp-external-link {\n  color: var(--jp-content-link-color);\n}\n","",{version:3,sources:["webpack://./node_modules/@krassowski/jupyterlab-lsp/style/index.css"],names:[],mappings:"AAIA;EACE,eAAe;AACjB;;AAEA;EACE,cAAc;AAChB;;AAEA;EACE,qBAAqB;EACrB,+BAA+B;AACjC;;AAEA;EACE,mCAAmC;AACrC",sourcesContent:["@import url('./highlight.css');\n@import url('./tooltip.css');\n@import url('./signature.css');\n\n.lsp-document-locator:hover {\n  cursor: pointer;\n}\n\n.lsp-document-locator span:not(:last-child)::after {\n  content: ' > ';\n}\n\n.lsp-icon-flip-x {\n  transform: scaleX(-1);\n  transform-origin: center center;\n}\n\n.lsp-external-link {\n  color: var(--jp-content-link-color);\n}\n"],sourceRoot:""}]);const u=d},46966:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var i=n(94015);var r=n.n(i);var s=n(23645);var o=n.n(s);var a=o()(r());a.push([e.id,".lsp-signature-help pre code {\n  font-size: var(--jp-code-font-size);\n}\n","",{version:3,sources:["webpack://./node_modules/@krassowski/jupyterlab-lsp/style/signature.css"],names:[],mappings:"AAAA;EACE,mCAAmC;AACrC",sourcesContent:[".lsp-signature-help pre code {\n  font-size: var(--jp-code-font-size);\n}\n"],sourceRoot:""}]);const l=a},63636:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var i=n(94015);var r=n.n(i);var s=n(23645);var o=n.n(s);var a=o()(r());a.push([e.id,".lsp-popover {\n  /* jupyterlab Menu */\n  z-index: 10000;\n  padding: 4px 0px;\n  background: var(--jp-layout-color0);\n  color: var(--jp-ui-font-color1);\n  border: var(--jp-border-width) solid var(--jp-border-color1);\n  font-size: var(--jp-ui-font-size1);\n  box-shadow: var(--jp-elevation-z6);\n}\n\n.lsp-popover-content {\n  padding: 5px 10px;\n}\n\n.lsp-servers-title {\n  margin-bottom: 5px;\n}\n\n.lsp-servers-menu {\n  height: 350px;\n  overflow-y: auto;\n}\n\n.lsp-server-status,\n.lsp-missing-server,\n.lsp-documents-by-language {\n  margin-left: 20px;\n}\n\nh5 .lsp-language-server-name {\n  color: var(--jp-ui-font-color2);\n}\n\n.lsp-documents-by-language ul,\n.lsp-server-status ul {\n  margin: 0;\n  padding-left: 25px;\n}\n\n.lsp-servers-menu h5 {\n  font-weight: normal;\n  font-size: 100%;\n  white-space: nowrap;\n}\n\n.lsp-servers-lists {\n  margin-left: 5px;\n}\n\n.lsp-popover-status {\n  padding-top: 5px;\n  border-top: 1px solid var(--jp-border-color1);\n}\n\n.lsp-popover-status a {\n  color: var(--jp-content-link-color);\n}\n\n.lsp-servers-menu h3,\nh4,\nh5 {\n  margin: 0;\n}\n\n.lsp-documents-by-language li {\n  width: 100%;\n  display: flex;\n  justify-content: space-between;\n}\n\n.lsp-document-status {\n  float: right;\n  padding-left: 15px;\n}\n\n.lsp-document-status-icon {\n  margin-left: 5px;\n  position: relative;\n  top: 3px;\n}\n\n.lsp-collapsible-list h4 {\n  cursor: pointer;\n}\n\n.lsp-collapsible-list .lsp-caret-icon {\n  position: relative;\n  top: 3px;\n}\n\n.lsp-collapsible-list.lsp-collapsed div {\n  display: none;\n}\n\n.lsp-statusbar-item {\n  overflow: hidden;\n  white-space: nowrap;\n}\n\n.lsp-status-icon.ready svg g {\n  fill: var(--jp-success-color0);\n}\n\n.lsp-status-icon.preparing svg g {\n  fill: var(--jp-warn-color0);\n}\n\n.lsp-status-icon.error svg g {\n  fill: var(--jp-error-color0);\n}\n\n.lsp-status-icon.inactive svg g {\n  fill: var(--jp-layout-color3);\n}\n\n.lsp-status-message {\n  user-select: none;\n}\n\nbody[data-jp-theme-light='false'] .lsp-status-icon.ready svg g {\n  fill: var(--jp-success-color1);\n}\n\n.lsp-statusbar-item.jp-mod-selected .jp-icon-selectable[fill] {\n  fill: #fff;\n}\n\n.jp-ToolbarButton .lsp-status-icon svg {\n  top: 5px;\n}\n\n.lsp-help-button {\n  background: var(--jp-layout-color2);\n  border: 1px solid var(--jp-brand-color0);\n  float: right;\n}\n\n.lsp-help-button:hover {\n  background: var(--jp-layout-color3);\n}\n\n.lsp-server-links-list a {\n  color: var(--jp-content-link-color);\n}\n\n.lsp-troubleshoot-section {\n  white-space: pre-wrap;\n  margin: 10px 0;\n}\n","",{version:3,sources:["webpack://./node_modules/@krassowski/jupyterlab-lsp/style/statusbar.css"],names:[],mappings:"AAAA;EACE,oBAAoB;EACpB,cAAc;EACd,gBAAgB;EAChB,mCAAmC;EACnC,+BAA+B;EAC/B,4DAA4D;EAC5D,kCAAkC;EAClC,kCAAkC;AACpC;;AAEA;EACE,iBAAiB;AACnB;;AAEA;EACE,kBAAkB;AACpB;;AAEA;EACE,aAAa;EACb,gBAAgB;AAClB;;AAEA;;;EAGE,iBAAiB;AACnB;;AAEA;EACE,+BAA+B;AACjC;;AAEA;;EAEE,SAAS;EACT,kBAAkB;AACpB;;AAEA;EACE,mBAAmB;EACnB,eAAe;EACf,mBAAmB;AACrB;;AAEA;EACE,gBAAgB;AAClB;;AAEA;EACE,gBAAgB;EAChB,6CAA6C;AAC/C;;AAEA;EACE,mCAAmC;AACrC;;AAEA;;;EAGE,SAAS;AACX;;AAEA;EACE,WAAW;EACX,aAAa;EACb,8BAA8B;AAChC;;AAEA;EACE,YAAY;EACZ,kBAAkB;AACpB;;AAEA;EACE,gBAAgB;EAChB,kBAAkB;EAClB,QAAQ;AACV;;AAEA;EACE,eAAe;AACjB;;AAEA;EACE,kBAAkB;EAClB,QAAQ;AACV;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,gBAAgB;EAChB,mBAAmB;AACrB;;AAEA;EACE,8BAA8B;AAChC;;AAEA;EACE,2BAA2B;AAC7B;;AAEA;EACE,4BAA4B;AAC9B;;AAEA;EACE,6BAA6B;AAC/B;;AAEA;EACE,iBAAiB;AACnB;;AAEA;EACE,8BAA8B;AAChC;;AAEA;EACE,UAAU;AACZ;;AAEA;EACE,QAAQ;AACV;;AAEA;EACE,mCAAmC;EACnC,wCAAwC;EACxC,YAAY;AACd;;AAEA;EACE,mCAAmC;AACrC;;AAEA;EACE,mCAAmC;AACrC;;AAEA;EACE,qBAAqB;EACrB,cAAc;AAChB",sourcesContent:[".lsp-popover {\n  /* jupyterlab Menu */\n  z-index: 10000;\n  padding: 4px 0px;\n  background: var(--jp-layout-color0);\n  color: var(--jp-ui-font-color1);\n  border: var(--jp-border-width) solid var(--jp-border-color1);\n  font-size: var(--jp-ui-font-size1);\n  box-shadow: var(--jp-elevation-z6);\n}\n\n.lsp-popover-content {\n  padding: 5px 10px;\n}\n\n.lsp-servers-title {\n  margin-bottom: 5px;\n}\n\n.lsp-servers-menu {\n  height: 350px;\n  overflow-y: auto;\n}\n\n.lsp-server-status,\n.lsp-missing-server,\n.lsp-documents-by-language {\n  margin-left: 20px;\n}\n\nh5 .lsp-language-server-name {\n  color: var(--jp-ui-font-color2);\n}\n\n.lsp-documents-by-language ul,\n.lsp-server-status ul {\n  margin: 0;\n  padding-left: 25px;\n}\n\n.lsp-servers-menu h5 {\n  font-weight: normal;\n  font-size: 100%;\n  white-space: nowrap;\n}\n\n.lsp-servers-lists {\n  margin-left: 5px;\n}\n\n.lsp-popover-status {\n  padding-top: 5px;\n  border-top: 1px solid var(--jp-border-color1);\n}\n\n.lsp-popover-status a {\n  color: var(--jp-content-link-color);\n}\n\n.lsp-servers-menu h3,\nh4,\nh5 {\n  margin: 0;\n}\n\n.lsp-documents-by-language li {\n  width: 100%;\n  display: flex;\n  justify-content: space-between;\n}\n\n.lsp-document-status {\n  float: right;\n  padding-left: 15px;\n}\n\n.lsp-document-status-icon {\n  margin-left: 5px;\n  position: relative;\n  top: 3px;\n}\n\n.lsp-collapsible-list h4 {\n  cursor: pointer;\n}\n\n.lsp-collapsible-list .lsp-caret-icon {\n  position: relative;\n  top: 3px;\n}\n\n.lsp-collapsible-list.lsp-collapsed div {\n  display: none;\n}\n\n.lsp-statusbar-item {\n  overflow: hidden;\n  white-space: nowrap;\n}\n\n.lsp-status-icon.ready svg g {\n  fill: var(--jp-success-color0);\n}\n\n.lsp-status-icon.preparing svg g {\n  fill: var(--jp-warn-color0);\n}\n\n.lsp-status-icon.error svg g {\n  fill: var(--jp-error-color0);\n}\n\n.lsp-status-icon.inactive svg g {\n  fill: var(--jp-layout-color3);\n}\n\n.lsp-status-message {\n  user-select: none;\n}\n\nbody[data-jp-theme-light='false'] .lsp-status-icon.ready svg g {\n  fill: var(--jp-success-color1);\n}\n\n.lsp-statusbar-item.jp-mod-selected .jp-icon-selectable[fill] {\n  fill: #fff;\n}\n\n.jp-ToolbarButton .lsp-status-icon svg {\n  top: 5px;\n}\n\n.lsp-help-button {\n  background: var(--jp-layout-color2);\n  border: 1px solid var(--jp-brand-color0);\n  float: right;\n}\n\n.lsp-help-button:hover {\n  background: var(--jp-layout-color3);\n}\n\n.lsp-server-links-list a {\n  color: var(--jp-content-link-color);\n}\n\n.lsp-troubleshoot-section {\n  white-space: pre-wrap;\n  margin: 10px 0;\n}\n"],sourceRoot:""}]);const l=a},87002:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var i=n(94015);var r=n.n(i);var s=n(23645);var o=n.n(s);var a=o()(r());a.push([e.id,".lsp-tooltip .jp-RenderedHTMLCommon {\n  /* Reduce the default padding from 20px to 0px */\n  padding-right: 0px;\n}\n\n.lsp-tooltip .jp-RenderedHTMLCommon > *:last-child {\n  /* Reduce the default margin */\n  margin-bottom: 0;\n}\n","",{version:3,sources:["webpack://./node_modules/@krassowski/jupyterlab-lsp/style/tooltip.css"],names:[],mappings:"AAAA;EACE,gDAAgD;EAChD,kBAAkB;AACpB;;AAEA;EACE,8BAA8B;EAC9B,gBAAgB;AAClB",sourcesContent:[".lsp-tooltip .jp-RenderedHTMLCommon {\n  /* Reduce the default padding from 20px to 0px */\n  padding-right: 0px;\n}\n\n.lsp-tooltip .jp-RenderedHTMLCommon > *:last-child {\n  /* Reduce the default margin */\n  margin-bottom: 0;\n}\n"],sourceRoot:""}]);const l=a},51331:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var i=n(94015);var r=n.n(i);var s=n(23645);var o=n.n(s);var a=o()(r());a.push([e.id,":root {\n  /* highlight */\n  --jp-editor-mirror-lsp-highlight-background-color: var(--jp-layout-color2);\n  /* diagnostics */\n  --jp-editor-mirror-lsp-diagnostic-decoration-style: dashed;\n  --jp-editor-mirror-lsp-diagnostic-error-decoration-color: var(\n    --jp-error-color1\n  );\n  --jp-editor-mirror-lsp-diagnostic-warning-decoration-color: var(\n    --jp-warn-color1\n  );\n  --jp-editor-mirror-lsp-diagnostic-information-decoration-color: var(\n    --jp-info-color1\n  );\n  --jp-editor-mirror-lsp-diagnostic-hint-decoration-color: var(\n    --jp-success-color1\n  );\n  /* hover */\n  --jp-editor-mirror-lsp-hover-decoration-style: dotted;\n  --jp-editor-mirror-lsp-hover-decoration-color: var(--jp-brand-color1);\n}\n","",{version:3,sources:["webpack://./node_modules/@krassowski/jupyterlab-lsp/style/variables/base.css"],names:[],mappings:"AAAA;EACE,cAAc;EACd,0EAA0E;EAC1E,gBAAgB;EAChB,0DAA0D;EAC1D;;GAEC;EACD;;GAEC;EACD;;GAEC;EACD;;GAEC;EACD,UAAU;EACV,qDAAqD;EACrD,qEAAqE;AACvE",sourcesContent:[":root {\n  /* highlight */\n  --jp-editor-mirror-lsp-highlight-background-color: var(--jp-layout-color2);\n  /* diagnostics */\n  --jp-editor-mirror-lsp-diagnostic-decoration-style: dashed;\n  --jp-editor-mirror-lsp-diagnostic-error-decoration-color: var(\n    --jp-error-color1\n  );\n  --jp-editor-mirror-lsp-diagnostic-warning-decoration-color: var(\n    --jp-warn-color1\n  );\n  --jp-editor-mirror-lsp-diagnostic-information-decoration-color: var(\n    --jp-info-color1\n  );\n  --jp-editor-mirror-lsp-diagnostic-hint-decoration-color: var(\n    --jp-success-color1\n  );\n  /* hover */\n  --jp-editor-mirror-lsp-hover-decoration-style: dotted;\n  --jp-editor-mirror-lsp-hover-decoration-color: var(--jp-brand-color1);\n}\n"],sourceRoot:""}]);const l=a},12062:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var i=n(94015);var r=n.n(i);var s=n(23645);var o=n.n(s);var a=o()(r());a.push([e.id,".cm-s-abcdef {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(144, 199, 255, 0.2);\n}\n\n.cm-s-base16-dark {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.2);\n}\n\n.cm-s-base16-light {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(186, 192, 161, 0.1);\n}\n\n.cm-s-default {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 69, 255, 0.1);\n}\n\n.cm-s-hopscotch {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(207, 18, 255, 0.2);\n}\n\n.cm-s-material {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 255, 58, 0.2);\n}\n\n.cm-s-mbo {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.2);\n}\n\n.cm-s-material {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.2);\n}\n\n.cm-s-mdn-like {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 69, 255, 0.1);\n}\n\n.cm-s-seti {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.2);\n}\n\n.cm-s-solarized {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 69, 255, 0.1);\n}\n\n.cm-s-the-matrix {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.1);\n}\n\n.cm-s-xq-light {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 69, 255, 0.1);\n}\n\n.cm-s-zenburn {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.2);\n}\n","",{version:3,sources:["webpack://./node_modules/@krassowski/jupyterlab-lsp/style/variables/cm-themes.css"],names:[],mappings:"AAAA;EACE,2EAA2E;AAC7E;;AAEA;EACE,2EAA2E;AAC7E;;AAEA;EACE,2EAA2E;AAC7E;;AAEA;EACE,yEAAyE;AAC3E;;AAEA;EACE,0EAA0E;AAC5E;;AAEA;EACE,yEAAyE;AAC3E;;AAEA;EACE,2EAA2E;AAC7E;;AAEA;EACE,2EAA2E;AAC7E;;AAEA;EACE,yEAAyE;AAC3E;;AAEA;EACE,2EAA2E;AAC7E;;AAEA;EACE,yEAAyE;AAC3E;;AAEA;EACE,2EAA2E;AAC7E;;AAEA;EACE,yEAAyE;AAC3E;;AAEA;EACE,2EAA2E;AAC7E",sourcesContent:[".cm-s-abcdef {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(144, 199, 255, 0.2);\n}\n\n.cm-s-base16-dark {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.2);\n}\n\n.cm-s-base16-light {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(186, 192, 161, 0.1);\n}\n\n.cm-s-default {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 69, 255, 0.1);\n}\n\n.cm-s-hopscotch {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(207, 18, 255, 0.2);\n}\n\n.cm-s-material {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 255, 58, 0.2);\n}\n\n.cm-s-mbo {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.2);\n}\n\n.cm-s-material {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.2);\n}\n\n.cm-s-mdn-like {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 69, 255, 0.1);\n}\n\n.cm-s-seti {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.2);\n}\n\n.cm-s-solarized {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 69, 255, 0.1);\n}\n\n.cm-s-the-matrix {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.1);\n}\n\n.cm-s-xq-light {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 69, 255, 0.1);\n}\n\n.cm-s-zenburn {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.2);\n}\n"],sourceRoot:""}]);const l=a},66985:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var i=n(94015);var r=n.n(i);var s=n(23645);var o=n.n(s);var a=o()(r());a.push([e.id,"body[data-jp-theme-light='false'] .cm-s-jupyter {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(151, 173, 255, 0.3);\n}\n","",{version:3,sources:["webpack://./node_modules/@krassowski/jupyterlab-lsp/style/variables/jupyterlab-dark.css"],names:[],mappings:"AAAA;EACE,2EAA2E;AAC7E",sourcesContent:["body[data-jp-theme-light='false'] .cm-s-jupyter {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(151, 173, 255, 0.3);\n}\n"],sourceRoot:""}]);const l=a},8428:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var i=n(94015);var r=n.n(i);var s=n(23645);var o=n.n(s);var a=o()(r());a.push([e.id,"body[data-jp-theme-light='true'] .cm-s-jupyter {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 69, 255, 0.1);\n}\n","",{version:3,sources:["webpack://./node_modules/@krassowski/jupyterlab-lsp/style/variables/jupyterlab-light.css"],names:[],mappings:"AAAA;EACE,yEAAyE;AAC3E",sourcesContent:["body[data-jp-theme-light='true'] .cm-s-jupyter {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 69, 255, 0.1);\n}\n"],sourceRoot:""}]);const l=a}}]);
//# sourceMappingURL=1597.19f6e75c5b973b73cfe7.js.map?v=19f6e75c5b973b73cfe7