(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[8016],{96604:(e,t,i)=>{"use strict";i.r(t);i.d(t,{LSPConnection:()=>v,Method:()=>a,Provider:()=>d});var n=i(18987);var s=i(95555);function r(e,t){var i=JSON.parse(JSON.stringify(e));var n=t.method,s=t.registerOptions;var r=n.substring(13)+"Provider";if(r){if(!s){i[r]=true}else{i[r]=JSON.parse(JSON.stringify(s))}}else{console.warn("Could not register server capability.",t);return null}return i}function o(e,t){var i=JSON.parse(JSON.stringify(e));var n=t.method;var s=n.substring(13)+"Provider";delete i[s];return i}var c=i(76013);var a;(function(e){let t;(function(e){e["PUBLISH_DIAGNOSTICS"]="textDocument/publishDiagnostics";e["SHOW_MESSAGE"]="window/showMessage";e["LOG_TRACE"]="$/logTrace";e["LOG_MESSAGE"]="window/logMessage"})(t=e.ServerNotification||(e.ServerNotification={}));let i;(function(e){e["DID_CHANGE"]="textDocument/didChange";e["DID_CHANGE_CONFIGURATION"]="workspace/didChangeConfiguration";e["DID_OPEN"]="textDocument/didOpen";e["DID_SAVE"]="textDocument/didSave";e["INITIALIZED"]="initialized";e["SET_TRACE"]="$/setTrace"})(i=e.ClientNotification||(e.ClientNotification={}));let n;(function(e){e["REGISTER_CAPABILITY"]="client/registerCapability";e["SHOW_MESSAGE_REQUEST"]="window/showMessageRequest";e["UNREGISTER_CAPABILITY"]="client/unregisterCapability";e["WORKSPACE_CONFIGURATION"]="workspace/configuration"})(n=e.ServerRequest||(e.ServerRequest={}));let s;(function(e){e["COMPLETION"]="textDocument/completion";e["COMPLETION_ITEM_RESOLVE"]="completionItem/resolve";e["DEFINITION"]="textDocument/definition";e["DOCUMENT_HIGHLIGHT"]="textDocument/documentHighlight";e["DOCUMENT_SYMBOL"]="textDocument/documentSymbol";e["HOVER"]="textDocument/hover";e["IMPLEMENTATION"]="textDocument/implementation";e["INITIALIZE"]="initialize";e["REFERENCES"]="textDocument/references";e["RENAME"]="textDocument/rename";e["SIGNATURE_HELP"]="textDocument/signatureHelp";e["TYPE_DEFINITION"]="textDocument/typeDefinition"})(s=e.ClientRequest||(e.ClientRequest={}))})(a||(a={}));class l{constructor(e,t,i){this.connection=e;this.method=t;this.emitter=i}request(e){this.emitter.log(m.client_requested,{method:this.method,message:e});return this.connection.sendRequest(this.method,e).then((t=>{this.emitter.log(m.result_for_client,{method:this.method,message:e});return t}))}}class u{constructor(e,t,i){this.connection=e;this.method=t;this.emitter=i;this.connection.onRequest(t,this.handle.bind(this));this._handler=null}handle(e){this.emitter.log(m.server_requested,{method:this.method,message:e});if(!this._handler){return new Promise((()=>undefined))}return this._handler(e,this.emitter).then((e=>{this.emitter.log(m.response_for_server,{method:this.method,message:e});return e}))}setHandler(e){this._handler=e}clearHandler(){this._handler=null}}const d={TEXT_DOCUMENT_SYNC:"textDocumentSync",COMPLETION:"completionProvider",HOVER:"hoverProvider",SIGNATURE_HELP:"signatureHelpProvider",DECLARATION:"declarationProvider",DEFINITION:"definitionProvider",TYPE_DEFINITION:"typeDefinitionProvider",IMPLEMENTATION:"implementationProvider",REFERENCES:"referencesProvider",DOCUMENT_HIGHLIGHT:"documentHighlightProvider",DOCUMENT_SYMBOL:"documentSymbolProvider",CODE_ACTION:"codeActionProvider",CODE_LENS:"codeLensProvider",DOCUMENT_LINK:"documentLinkProvider",COLOR:"colorProvider",DOCUMENT_FORMATTING:"documentFormattingProvider",DOCUMENT_RANGE_FORMATTING:"documentRangeFormattingProvider",DOCUMENT_ON_TYPE_FORMATTING:"documentOnTypeFormattingProvider",RENAME:"renameProvider",FOLDING_RANGE:"foldingRangeProvider",EXECUTE_COMMAND:"executeCommandProvider",SELECTION_RANGE:"selectionRangeProvider",WORKSPACE_SYMBOL:"workspaceSymbolProvider",WORKSPACE:"workspace"};function h(e,t){const i={};for(let n of Object.values(e)){i[n]=t(n)}return i}var m;(function(e){e[e["client_notified_server"]=0]="client_notified_server";e[e["server_notified_client"]=1]="server_notified_client";e[e["server_requested"]=2]="server_requested";e[e["client_requested"]=3]="client_requested";e[e["result_for_client"]=4]="result_for_client";e[e["response_for_server"]=5]="response_for_server"})(m||(m={}));class v extends s.LspWsConnection{constructor(e){super(e);this.closing_manually=false;this._options=e;this.logAllCommunication=false;this.serverIdentifier=e.serverIdentifier;this.console=e.console.scope(this.serverIdentifier+" connection");this.documentsToOpen=[];this.clientNotifications=this.constructNotificationHandlers(a.ClientNotification);this.serverNotifications=this.constructNotificationHandlers(a.ServerNotification)}log(e,t){if(this.logAllCommunication){this.console.log(e,t)}}constructNotificationHandlers(e){return h(e,(()=>new n.Signal(this)))}constructClientRequestHandler(e){return h(e,(e=>new l(this.connection,e,this)))}constructServerRequestHandler(e){return h(e,(e=>new u(this.connection,e,this)))}initializeParams(){return Object.assign(Object.assign({},super.initializeParams()),{capabilities:this._options.capabilities,initializationOptions:null,processId:null,workspaceFolders:null})}sendOpenWhenReady(e){if(this.isReady){this.sendOpen(e)}else{this.documentsToOpen.push(e)}}onServerInitialized(e){this.afterInitialized();super.onServerInitialized(e);while(this.documentsToOpen.length){this.sendOpen(this.documentsToOpen.pop())}}afterInitialized(){for(const e of Object.values(a.ServerNotification)){const t=this.serverNotifications[e];this.connection.onNotification(e,(i=>{this.log(m.server_notified_client,{method:e,message:i});t.emit(i)}))}for(const e of Object.values(a.ClientNotification)){const t=this.clientNotifications[e];t.connect(((t,i)=>{this.log(m.client_notified_server,{method:e,message:i});this.connection.sendNotification(e,i)}))}this.clientRequests=this.constructClientRequestHandler(a.ClientRequest);this.serverRequests=this.constructServerRequestHandler(a.ServerRequest);this.serverRequests["client/registerCapability"].setHandler((async e=>{e.registrations.forEach((e=>{try{const t=r(this.serverCapabilities,e);if(t===null){this.console.error(`Failed to register server capability: ${e}`);return}this.serverCapabilities=t}catch(t){this.console.error(t)}}))}));this.serverRequests["client/unregisterCapability"].setHandler((async e=>{e.unregisterations.forEach((e=>{this.serverCapabilities=o(this.serverCapabilities,e)}))}));this.serverRequests["workspace/configuration"].setHandler((async e=>e.items.map((e=>null))))}sendSelectiveChange(e,t){this._sendChange([e],t)}sendFullTextChange(e,t){this._sendChange([{text:e}],t)}isRenameSupported(){return!!(this.serverCapabilities&&this.serverCapabilities.renameProvider)}provides(e){return!!(this.serverCapabilities&&this.serverCapabilities[e])}async rename(e,t,i,n=true){if(!this.isReady||!this.isRenameSupported()){return null}const s={textDocument:{uri:t.uri},position:{line:e.line,character:e.ch},newName:i};const r=await this.connection.sendRequest("textDocument/rename",s);if(n){this.emit("renamed",r)}return r}connect(e){super.connect(e);(0,c.EU)((()=>this.isConnected),-1).then((()=>{this.connection.onClose((()=>{this.isConnected=false;this.emit("close",this.closing_manually)}))})).catch((()=>{console.error("Could not connect onClose signal")}));return this}close(){try{this.closing_manually=true;super.close()}catch(e){this.closing_manually=false}}_sendChange(e,t){if(!this.isReady){return}if(!this.openedUris.get(t.uri)){this.sendOpen(t)}const i={textDocument:{uri:t.uri,version:t.version},contentChanges:e};this.connection.sendNotification("textDocument/didChange",i);t.version++}async getCompletionResolve(e){if(!this.isReady||!this.isCompletionResolveProvider()){return}return this.connection.sendRequest("completionItem/resolve",e)}isCompletionResolveProvider(){var e,t;return((t=(e=this.serverCapabilities)===null||e===void 0?void 0:e.completionProvider)===null||t===void 0?void 0:t.resolveProvider)||false}}}}]);
//# sourceMappingURL=jupyter-lsp-connection.e2b555e6b478867fd488.js.map?v=e2b555e6b478867fd488